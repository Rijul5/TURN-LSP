{"version":3,"sources":["webpack:///../node_modules/moment/locale sync ^\\.\\/.*$","webpack:///../sprotty/client/src/base/actions/action-dispatcher.ts","webpack:///../sprotty/client/src/base/actions/action-handler.ts","webpack:///../sprotty/client/src/base/actions/action.ts","webpack:///../sprotty/client/src/base/animations/animation-frame-syncer.ts","webpack:///../sprotty/client/src/base/animations/animation.ts","webpack:///../sprotty/client/src/base/animations/easing.ts","webpack:///../sprotty/client/src/base/commands/command-stack-options.ts","webpack:///../sprotty/client/src/base/commands/command-stack.ts","webpack:///../sprotty/client/src/base/commands/command.ts","webpack:///../sprotty/client/src/base/di.config.ts","webpack:///../sprotty/client/src/base/features/initialize-canvas.ts","webpack:///../sprotty/client/src/base/features/set-model.ts","webpack:///../sprotty/client/src/base/model/smodel-factory.ts","webpack:///../sprotty/client/src/base/model/smodel-storage.ts","webpack:///../sprotty/client/src/base/model/smodel-utils.ts","webpack:///../sprotty/client/src/base/model/smodel.ts","webpack:///../sprotty/client/src/base/types.ts","webpack:///../sprotty/client/src/base/views/dom-helper.ts","webpack:///../sprotty/client/src/base/views/id-decorator.ts","webpack:///../sprotty/client/src/base/views/key-tool.ts","webpack:///../sprotty/client/src/base/views/mouse-tool.ts","webpack:///../sprotty/client/src/base/views/thunk-view.ts","webpack:///../sprotty/client/src/base/views/view.tsx","webpack:///../sprotty/client/src/base/views/viewer-cache.ts","webpack:///../sprotty/client/src/base/views/viewer-options.ts","webpack:///../sprotty/client/src/base/views/viewer.tsx","webpack:///../sprotty/client/src/base/views/vnode-decorators.ts","webpack:///../sprotty/client/src/base/views/vnode-utils.ts","webpack:///../sprotty/client/src/features/bounds/abstract-layout.ts","webpack:///../sprotty/client/src/features/bounds/bounds-manipulation.ts","webpack:///../sprotty/client/src/features/bounds/di.config.ts","webpack:///../sprotty/client/src/features/bounds/hbox-layout.ts","webpack:///../sprotty/client/src/features/bounds/hidden-bounds-updater.ts","webpack:///../sprotty/client/src/features/bounds/layout.ts","webpack:///../sprotty/client/src/features/bounds/model.ts","webpack:///../sprotty/client/src/features/bounds/resize.ts","webpack:///../sprotty/client/src/features/bounds/stack-layout.ts","webpack:///../sprotty/client/src/features/bounds/vbox-layout.ts","webpack:///../sprotty/client/src/features/button/button-handler.ts","webpack:///../sprotty/client/src/features/button/di.config.ts","webpack:///../sprotty/client/src/features/button/model.ts","webpack:///../sprotty/client/src/features/edit/di.config.ts","webpack:///../sprotty/client/src/features/edit/edit-routing.ts","webpack:///../sprotty/client/src/features/edit/model.ts","webpack:///../sprotty/client/src/features/expand/di.config.ts","webpack:///../sprotty/client/src/features/expand/expand.ts","webpack:///../sprotty/client/src/features/expand/model.ts","webpack:///../sprotty/client/src/features/expand/views.tsx","webpack:///../sprotty/client/src/features/export/di.config.ts","webpack:///../sprotty/client/src/features/export/export.ts","webpack:///../sprotty/client/src/features/export/model.ts","webpack:///../sprotty/client/src/features/export/svg-exporter.ts","webpack:///../sprotty/client/src/features/fade/di.config.ts","webpack:///../sprotty/client/src/features/fade/fade.ts","webpack:///../sprotty/client/src/features/fade/model.ts","webpack:///../sprotty/client/src/features/hover/di.config.ts","webpack:///../sprotty/client/src/features/hover/hover.ts","webpack:///../sprotty/client/src/features/hover/initializer.ts","webpack:///../sprotty/client/src/features/hover/model.ts","webpack:///../sprotty/client/src/features/hover/popup-position-updater.ts","webpack:///../sprotty/client/src/features/move/di.config.ts","webpack:///../sprotty/client/src/features/move/model.ts","webpack:///../sprotty/client/src/features/move/move.ts","webpack:///../sprotty/client/src/features/open/di.config.ts","webpack:///../sprotty/client/src/features/open/model.ts","webpack:///../sprotty/client/src/features/open/open.ts","webpack:///../sprotty/client/src/features/select/di.config.ts","webpack:///../sprotty/client/src/features/select/model.ts","webpack:///../sprotty/client/src/features/select/select.ts","webpack:///../sprotty/client/src/features/undo-redo/di.config.ts","webpack:///../sprotty/client/src/features/undo-redo/undo-redo.ts","webpack:///../sprotty/client/src/features/update/model-matching.ts","webpack:///../sprotty/client/src/features/update/update-model.ts","webpack:///../sprotty/client/src/features/viewport/center-fit.ts","webpack:///../sprotty/client/src/features/viewport/di.config.ts","webpack:///../sprotty/client/src/features/viewport/model.ts","webpack:///../sprotty/client/src/features/viewport/scroll.ts","webpack:///../sprotty/client/src/features/viewport/viewport-root.ts","webpack:///../sprotty/client/src/features/viewport/viewport.ts","webpack:///../sprotty/client/src/features/viewport/zoom.ts","webpack:///../sprotty/client/src/graph/routing.ts","webpack:///../sprotty/client/src/graph/sgraph-factory.ts","webpack:///../sprotty/client/src/graph/sgraph.ts","webpack:///../sprotty/client/src/graph/views.tsx","webpack:///../sprotty/client/src/index.ts","webpack:///../sprotty/client/src/lib/generic-views.ts","webpack:///../sprotty/client/src/lib/html-views.tsx","webpack:///../sprotty/client/src/lib/model.ts","webpack:///../sprotty/client/src/lib/svg-views.tsx","webpack:///../sprotty/client/src/model-source/di.config.ts","webpack:///../sprotty/client/src/model-source/diagram-server.ts","webpack:///../sprotty/client/src/model-source/diagram-state.ts","webpack:///../sprotty/client/src/model-source/local-model-source.ts","webpack:///../sprotty/client/src/model-source/logging.ts","webpack:///../sprotty/client/src/model-source/model-source.ts","webpack:///../sprotty/client/src/model-source/websocket.ts","webpack:///../sprotty/client/src/utils/anchors.ts","webpack:///../sprotty/client/src/utils/async.ts","webpack:///../sprotty/client/src/utils/browser.ts","webpack:///../sprotty/client/src/utils/color.ts","webpack:///../sprotty/client/src/utils/geometry.ts","webpack:///../sprotty/client/src/utils/iterable.ts","webpack:///../sprotty/client/src/utils/keyboard.ts","webpack:///../sprotty/client/src/utils/logging.ts","webpack:///../sprotty/client/src/utils/registry.ts","webpack:///../theia-sprotty/src/sprotty/theia-diagram-server.ts","webpack:///../theia-sprotty/src/sprotty/theia-file-saver.ts","webpack:///../theia-sprotty/src/theia/diagram-commands.ts","webpack:///../theia-sprotty/src/theia/diagram-configuration.ts","webpack:///../theia-sprotty/src/theia/diagram-keybinding.ts","webpack:///../theia-sprotty/src/theia/diagram-manager.ts","webpack:///../theia-sprotty/src/theia/diagram-module.ts","webpack:///../theia-sprotty/src/theia/diagram-widget-registry.ts","webpack:///../theia-sprotty/src/theia/diagram-widget.ts"],"names":[],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A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","file":"17.bundle.js","sourcesContent":["var map = {\n\t\"./af\": \"../node_modules/moment/locale/af.js\",\n\t\"./af.js\": \"../node_modules/moment/locale/af.js\",\n\t\"./ar\": \"../node_modules/moment/locale/ar.js\",\n\t\"./ar-dz\": \"../node_modules/moment/locale/ar-dz.js\",\n\t\"./ar-dz.js\": \"../node_modules/moment/locale/ar-dz.js\",\n\t\"./ar-kw\": \"../node_modules/moment/locale/ar-kw.js\",\n\t\"./ar-kw.js\": \"../node_modules/moment/locale/ar-kw.js\",\n\t\"./ar-ly\": \"../node_modules/moment/locale/ar-ly.js\",\n\t\"./ar-ly.js\": \"../node_modules/moment/locale/ar-ly.js\",\n\t\"./ar-ma\": \"../node_modules/moment/locale/ar-ma.js\",\n\t\"./ar-ma.js\": \"../node_modules/moment/locale/ar-ma.js\",\n\t\"./ar-sa\": \"../node_modules/moment/locale/ar-sa.js\",\n\t\"./ar-sa.js\": \"../node_modules/moment/locale/ar-sa.js\",\n\t\"./ar-tn\": \"../node_modules/moment/locale/ar-tn.js\",\n\t\"./ar-tn.js\": \"../node_modules/moment/locale/ar-tn.js\",\n\t\"./ar.js\": \"../node_modules/moment/locale/ar.js\",\n\t\"./az\": \"../node_modules/moment/locale/az.js\",\n\t\"./az.js\": \"../node_modules/moment/locale/az.js\",\n\t\"./be\": \"../node_modules/moment/locale/be.js\",\n\t\"./be.js\": \"../node_modules/moment/locale/be.js\",\n\t\"./bg\": \"../node_modules/moment/locale/bg.js\",\n\t\"./bg.js\": \"../node_modules/moment/locale/bg.js\",\n\t\"./bm\": \"../node_modules/moment/locale/bm.js\",\n\t\"./bm.js\": \"../node_modules/moment/locale/bm.js\",\n\t\"./bn\": \"../node_modules/moment/locale/bn.js\",\n\t\"./bn.js\": \"../node_modules/moment/locale/bn.js\",\n\t\"./bo\": \"../node_modules/moment/locale/bo.js\",\n\t\"./bo.js\": \"../node_modules/moment/locale/bo.js\",\n\t\"./br\": \"../node_modules/moment/locale/br.js\",\n\t\"./br.js\": \"../node_modules/moment/locale/br.js\",\n\t\"./bs\": \"../node_modules/moment/locale/bs.js\",\n\t\"./bs.js\": \"../node_modules/moment/locale/bs.js\",\n\t\"./ca\": \"../node_modules/moment/locale/ca.js\",\n\t\"./ca.js\": \"../node_modules/moment/locale/ca.js\",\n\t\"./cs\": \"../node_modules/moment/locale/cs.js\",\n\t\"./cs.js\": \"../node_modules/moment/locale/cs.js\",\n\t\"./cv\": \"../node_modules/moment/locale/cv.js\",\n\t\"./cv.js\": \"../node_modules/moment/locale/cv.js\",\n\t\"./cy\": \"../node_modules/moment/locale/cy.js\",\n\t\"./cy.js\": \"../node_modules/moment/locale/cy.js\",\n\t\"./da\": \"../node_modules/moment/locale/da.js\",\n\t\"./da.js\": \"../node_modules/moment/locale/da.js\",\n\t\"./de\": \"../node_modules/moment/locale/de.js\",\n\t\"./de-at\": \"../node_modules/moment/locale/de-at.js\",\n\t\"./de-at.js\": \"../node_modules/moment/locale/de-at.js\",\n\t\"./de-ch\": \"../node_modules/moment/locale/de-ch.js\",\n\t\"./de-ch.js\": \"../node_modules/moment/locale/de-ch.js\",\n\t\"./de.js\": \"../node_modules/moment/locale/de.js\",\n\t\"./dv\": \"../node_modules/moment/locale/dv.js\",\n\t\"./dv.js\": \"../node_modules/moment/locale/dv.js\",\n\t\"./el\": \"../node_modules/moment/locale/el.js\",\n\t\"./el.js\": \"../node_modules/moment/locale/el.js\",\n\t\"./en-au\": \"../node_modules/moment/locale/en-au.js\",\n\t\"./en-au.js\": \"../node_modules/moment/locale/en-au.js\",\n\t\"./en-ca\": \"../node_modules/moment/locale/en-ca.js\",\n\t\"./en-ca.js\": \"../node_modules/moment/locale/en-ca.js\",\n\t\"./en-gb\": \"../node_modules/moment/locale/en-gb.js\",\n\t\"./en-gb.js\": \"../node_modules/moment/locale/en-gb.js\",\n\t\"./en-ie\": \"../node_modules/moment/locale/en-ie.js\",\n\t\"./en-ie.js\": \"../node_modules/moment/locale/en-ie.js\",\n\t\"./en-il\": \"../node_modules/moment/locale/en-il.js\",\n\t\"./en-il.js\": \"../node_modules/moment/locale/en-il.js\",\n\t\"./en-nz\": \"../node_modules/moment/locale/en-nz.js\",\n\t\"./en-nz.js\": \"../node_modules/moment/locale/en-nz.js\",\n\t\"./eo\": \"../node_modules/moment/locale/eo.js\",\n\t\"./eo.js\": \"../node_modules/moment/locale/eo.js\",\n\t\"./es\": \"../node_modules/moment/locale/es.js\",\n\t\"./es-do\": \"../node_modules/moment/locale/es-do.js\",\n\t\"./es-do.js\": \"../node_modules/moment/locale/es-do.js\",\n\t\"./es-us\": \"../node_modules/moment/locale/es-us.js\",\n\t\"./es-us.js\": \"../node_modules/moment/locale/es-us.js\",\n\t\"./es.js\": \"../node_modules/moment/locale/es.js\",\n\t\"./et\": \"../node_modules/moment/locale/et.js\",\n\t\"./et.js\": \"../node_modules/moment/locale/et.js\",\n\t\"./eu\": \"../node_modules/moment/locale/eu.js\",\n\t\"./eu.js\": \"../node_modules/moment/locale/eu.js\",\n\t\"./fa\": \"../node_modules/moment/locale/fa.js\",\n\t\"./fa.js\": \"../node_modules/moment/locale/fa.js\",\n\t\"./fi\": \"../node_modules/moment/locale/fi.js\",\n\t\"./fi.js\": \"../node_modules/moment/locale/fi.js\",\n\t\"./fo\": \"../node_modules/moment/locale/fo.js\",\n\t\"./fo.js\": \"../node_modules/moment/locale/fo.js\",\n\t\"./fr\": \"../node_modules/moment/locale/fr.js\",\n\t\"./fr-ca\": \"../node_modules/moment/locale/fr-ca.js\",\n\t\"./fr-ca.js\": \"../node_modules/moment/locale/fr-ca.js\",\n\t\"./fr-ch\": \"../node_modules/moment/locale/fr-ch.js\",\n\t\"./fr-ch.js\": \"../node_modules/moment/locale/fr-ch.js\",\n\t\"./fr.js\": \"../node_modules/moment/locale/fr.js\",\n\t\"./fy\": \"../node_modules/moment/locale/fy.js\",\n\t\"./fy.js\": \"../node_modules/moment/locale/fy.js\",\n\t\"./gd\": \"../node_modules/moment/locale/gd.js\",\n\t\"./gd.js\": \"../node_modules/moment/locale/gd.js\",\n\t\"./gl\": \"../node_modules/moment/locale/gl.js\",\n\t\"./gl.js\": \"../node_modules/moment/locale/gl.js\",\n\t\"./gom-latn\": \"../node_modules/moment/locale/gom-latn.js\",\n\t\"./gom-latn.js\": \"../node_modules/moment/locale/gom-latn.js\",\n\t\"./gu\": \"../node_modules/moment/locale/gu.js\",\n\t\"./gu.js\": \"../node_modules/moment/locale/gu.js\",\n\t\"./he\": \"../node_modules/moment/locale/he.js\",\n\t\"./he.js\": \"../node_modules/moment/locale/he.js\",\n\t\"./hi\": \"../node_modules/moment/locale/hi.js\",\n\t\"./hi.js\": \"../node_modules/moment/locale/hi.js\",\n\t\"./hr\": \"../node_modules/moment/locale/hr.js\",\n\t\"./hr.js\": \"../node_modules/moment/locale/hr.js\",\n\t\"./hu\": \"../node_modules/moment/locale/hu.js\",\n\t\"./hu.js\": \"../node_modules/moment/locale/hu.js\",\n\t\"./hy-am\": \"../node_modules/moment/locale/hy-am.js\",\n\t\"./hy-am.js\": \"../node_modules/moment/locale/hy-am.js\",\n\t\"./id\": \"../node_modules/moment/locale/id.js\",\n\t\"./id.js\": \"../node_modules/moment/locale/id.js\",\n\t\"./is\": \"../node_modules/moment/locale/is.js\",\n\t\"./is.js\": \"../node_modules/moment/locale/is.js\",\n\t\"./it\": \"../node_modules/moment/locale/it.js\",\n\t\"./it.js\": \"../node_modules/moment/locale/it.js\",\n\t\"./ja\": \"../node_modules/moment/locale/ja.js\",\n\t\"./ja.js\": \"../node_modules/moment/locale/ja.js\",\n\t\"./jv\": \"../node_modules/moment/locale/jv.js\",\n\t\"./jv.js\": \"../node_modules/moment/locale/jv.js\",\n\t\"./ka\": \"../node_modules/moment/locale/ka.js\",\n\t\"./ka.js\": \"../node_modules/moment/locale/ka.js\",\n\t\"./kk\": \"../node_modules/moment/locale/kk.js\",\n\t\"./kk.js\": \"../node_modules/moment/locale/kk.js\",\n\t\"./km\": \"../node_modules/moment/locale/km.js\",\n\t\"./km.js\": \"../node_modules/moment/locale/km.js\",\n\t\"./kn\": \"../node_modules/moment/locale/kn.js\",\n\t\"./kn.js\": \"../node_modules/moment/locale/kn.js\",\n\t\"./ko\": \"../node_modules/moment/locale/ko.js\",\n\t\"./ko.js\": \"../node_modules/moment/locale/ko.js\",\n\t\"./ky\": \"../node_modules/moment/locale/ky.js\",\n\t\"./ky.js\": \"../node_modules/moment/locale/ky.js\",\n\t\"./lb\": \"../node_modules/moment/locale/lb.js\",\n\t\"./lb.js\": \"../node_modules/moment/locale/lb.js\",\n\t\"./lo\": \"../node_modules/moment/locale/lo.js\",\n\t\"./lo.js\": \"../node_modules/moment/locale/lo.js\",\n\t\"./lt\": \"../node_modules/moment/locale/lt.js\",\n\t\"./lt.js\": \"../node_modules/moment/locale/lt.js\",\n\t\"./lv\": \"../node_modules/moment/locale/lv.js\",\n\t\"./lv.js\": \"../node_modules/moment/locale/lv.js\",\n\t\"./me\": \"../node_modules/moment/locale/me.js\",\n\t\"./me.js\": \"../node_modules/moment/locale/me.js\",\n\t\"./mi\": \"../node_modules/moment/locale/mi.js\",\n\t\"./mi.js\": \"../node_modules/moment/locale/mi.js\",\n\t\"./mk\": \"../node_modules/moment/locale/mk.js\",\n\t\"./mk.js\": \"../node_modules/moment/locale/mk.js\",\n\t\"./ml\": \"../node_modules/moment/locale/ml.js\",\n\t\"./ml.js\": \"../node_modules/moment/locale/ml.js\",\n\t\"./mn\": \"../node_modules/moment/locale/mn.js\",\n\t\"./mn.js\": \"../node_modules/moment/locale/mn.js\",\n\t\"./mr\": \"../node_modules/moment/locale/mr.js\",\n\t\"./mr.js\": \"../node_modules/moment/locale/mr.js\",\n\t\"./ms\": \"../node_modules/moment/locale/ms.js\",\n\t\"./ms-my\": \"../node_modules/moment/locale/ms-my.js\",\n\t\"./ms-my.js\": \"../node_modules/moment/locale/ms-my.js\",\n\t\"./ms.js\": \"../node_modules/moment/locale/ms.js\",\n\t\"./mt\": \"../node_modules/moment/locale/mt.js\",\n\t\"./mt.js\": \"../node_modules/moment/locale/mt.js\",\n\t\"./my\": \"../node_modules/moment/locale/my.js\",\n\t\"./my.js\": \"../node_modules/moment/locale/my.js\",\n\t\"./nb\": \"../node_modules/moment/locale/nb.js\",\n\t\"./nb.js\": \"../node_modules/moment/locale/nb.js\",\n\t\"./ne\": \"../node_modules/moment/locale/ne.js\",\n\t\"./ne.js\": \"../node_modules/moment/locale/ne.js\",\n\t\"./nl\": \"../node_modules/moment/locale/nl.js\",\n\t\"./nl-be\": \"../node_modules/moment/locale/nl-be.js\",\n\t\"./nl-be.js\": \"../node_modules/moment/locale/nl-be.js\",\n\t\"./nl.js\": \"../node_modules/moment/locale/nl.js\",\n\t\"./nn\": \"../node_modules/moment/locale/nn.js\",\n\t\"./nn.js\": \"../node_modules/moment/locale/nn.js\",\n\t\"./pa-in\": \"../node_modules/moment/locale/pa-in.js\",\n\t\"./pa-in.js\": \"../node_modules/moment/locale/pa-in.js\",\n\t\"./pl\": \"../node_modules/moment/locale/pl.js\",\n\t\"./pl.js\": \"../node_modules/moment/locale/pl.js\",\n\t\"./pt\": \"../node_modules/moment/locale/pt.js\",\n\t\"./pt-br\": \"../node_modules/moment/locale/pt-br.js\",\n\t\"./pt-br.js\": \"../node_modules/moment/locale/pt-br.js\",\n\t\"./pt.js\": \"../node_modules/moment/locale/pt.js\",\n\t\"./ro\": \"../node_modules/moment/locale/ro.js\",\n\t\"./ro.js\": \"../node_modules/moment/locale/ro.js\",\n\t\"./ru\": \"../node_modules/moment/locale/ru.js\",\n\t\"./ru.js\": \"../node_modules/moment/locale/ru.js\",\n\t\"./sd\": \"../node_modules/moment/locale/sd.js\",\n\t\"./sd.js\": \"../node_modules/moment/locale/sd.js\",\n\t\"./se\": \"../node_modules/moment/locale/se.js\",\n\t\"./se.js\": \"../node_modules/moment/locale/se.js\",\n\t\"./si\": \"../node_modules/moment/locale/si.js\",\n\t\"./si.js\": \"../node_modules/moment/locale/si.js\",\n\t\"./sk\": \"../node_modules/moment/locale/sk.js\",\n\t\"./sk.js\": \"../node_modules/moment/locale/sk.js\",\n\t\"./sl\": \"../node_modules/moment/locale/sl.js\",\n\t\"./sl.js\": \"../node_modules/moment/locale/sl.js\",\n\t\"./sq\": \"../node_modules/moment/locale/sq.js\",\n\t\"./sq.js\": \"../node_modules/moment/locale/sq.js\",\n\t\"./sr\": \"../node_modules/moment/locale/sr.js\",\n\t\"./sr-cyrl\": \"../node_modules/moment/locale/sr-cyrl.js\",\n\t\"./sr-cyrl.js\": \"../node_modules/moment/locale/sr-cyrl.js\",\n\t\"./sr.js\": \"../node_modules/moment/locale/sr.js\",\n\t\"./ss\": \"../node_modules/moment/locale/ss.js\",\n\t\"./ss.js\": \"../node_modules/moment/locale/ss.js\",\n\t\"./sv\": \"../node_modules/moment/locale/sv.js\",\n\t\"./sv.js\": \"../node_modules/moment/locale/sv.js\",\n\t\"./sw\": \"../node_modules/moment/locale/sw.js\",\n\t\"./sw.js\": \"../node_modules/moment/locale/sw.js\",\n\t\"./ta\": \"../node_modules/moment/locale/ta.js\",\n\t\"./ta.js\": \"../node_modules/moment/locale/ta.js\",\n\t\"./te\": \"../node_modules/moment/locale/te.js\",\n\t\"./te.js\": \"../node_modules/moment/locale/te.js\",\n\t\"./tet\": \"../node_modules/moment/locale/tet.js\",\n\t\"./tet.js\": \"../node_modules/moment/locale/tet.js\",\n\t\"./tg\": \"../node_modules/moment/locale/tg.js\",\n\t\"./tg.js\": \"../node_modules/moment/locale/tg.js\",\n\t\"./th\": \"../node_modules/moment/locale/th.js\",\n\t\"./th.js\": \"../node_modules/moment/locale/th.js\",\n\t\"./tl-ph\": \"../node_modules/moment/locale/tl-ph.js\",\n\t\"./tl-ph.js\": \"../node_modules/moment/locale/tl-ph.js\",\n\t\"./tlh\": \"../node_modules/moment/locale/tlh.js\",\n\t\"./tlh.js\": \"../node_modules/moment/locale/tlh.js\",\n\t\"./tr\": \"../node_modules/moment/locale/tr.js\",\n\t\"./tr.js\": \"../node_modules/moment/locale/tr.js\",\n\t\"./tzl\": \"../node_modules/moment/locale/tzl.js\",\n\t\"./tzl.js\": \"../node_modules/moment/locale/tzl.js\",\n\t\"./tzm\": \"../node_modules/moment/locale/tzm.js\",\n\t\"./tzm-latn\": \"../node_modules/moment/locale/tzm-latn.js\",\n\t\"./tzm-latn.js\": \"../node_modules/moment/locale/tzm-latn.js\",\n\t\"./tzm.js\": \"../node_modules/moment/locale/tzm.js\",\n\t\"./ug-cn\": \"../node_modules/moment/locale/ug-cn.js\",\n\t\"./ug-cn.js\": \"../node_modules/moment/locale/ug-cn.js\",\n\t\"./uk\": \"../node_modules/moment/locale/uk.js\",\n\t\"./uk.js\": \"../node_modules/moment/locale/uk.js\",\n\t\"./ur\": \"../node_modules/moment/locale/ur.js\",\n\t\"./ur.js\": \"../node_modules/moment/locale/ur.js\",\n\t\"./uz\": \"../node_modules/moment/locale/uz.js\",\n\t\"./uz-latn\": \"../node_modules/moment/locale/uz-latn.js\",\n\t\"./uz-latn.js\": \"../node_modules/moment/locale/uz-latn.js\",\n\t\"./uz.js\": \"../node_modules/moment/locale/uz.js\",\n\t\"./vi\": \"../node_modules/moment/locale/vi.js\",\n\t\"./vi.js\": \"../node_modules/moment/locale/vi.js\",\n\t\"./x-pseudo\": \"../node_modules/moment/locale/x-pseudo.js\",\n\t\"./x-pseudo.js\": \"../node_modules/moment/locale/x-pseudo.js\",\n\t\"./yo\": \"../node_modules/moment/locale/yo.js\",\n\t\"./yo.js\": \"../node_modules/moment/locale/yo.js\",\n\t\"./zh-cn\": \"../node_modules/moment/locale/zh-cn.js\",\n\t\"./zh-cn.js\": \"../node_modules/moment/locale/zh-cn.js\",\n\t\"./zh-hk\": \"../node_modules/moment/locale/zh-hk.js\",\n\t\"./zh-hk.js\": \"../node_modules/moment/locale/zh-hk.js\",\n\t\"./zh-tw\": \"../node_modules/moment/locale/zh-tw.js\",\n\t\"./zh-tw.js\": \"../node_modules/moment/locale/zh-tw.js\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"../node_modules/moment/locale sync recursive ^\\\\.\\\\/.*$\";","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable } from \"inversify\";\nimport { TYPES } from \"../types\";\nimport { ILogger } from \"../../utils/logging\";\nimport { EMPTY_ROOT } from '../model/smodel-factory';\nimport { ICommandStack } from \"../commands/command-stack\";\nimport { AnimationFrameSyncer } from \"../animations/animation-frame-syncer\";\nimport { SetModelAction, SetModelCommand } from '../features/set-model';\nimport { RedoAction, UndoAction } from \"../../features/undo-redo/undo-redo\";\nimport { Action, isAction } from \"./action\";\nimport { ActionHandlerRegistry } from \"./action-handler\";\n\nexport interface IActionDispatcher {\n    dispatch(action: Action): Promise<void>\n    dispatchAll(actions: Action[]): Promise<void>\n}\n\n/**\n * Collects actions, converts them to commands and dispatches them.\n * Also acts as the proxy to model sources such as diagram servers.\n */\n@injectable()\nexport class ActionDispatcher implements IActionDispatcher {\n\n    protected blockUntil?: (action: Action) => boolean;\n    protected postponedActions: PostponedAction[] = [];\n\n    constructor(@inject(TYPES.ActionHandlerRegistry) protected actionHandlerRegistry: ActionHandlerRegistry,\n                @inject(TYPES.ICommandStack) protected commandStack: ICommandStack,\n                @inject(TYPES.ILogger) protected logger: ILogger,\n                @inject(TYPES.AnimationFrameSyncer) protected syncer: AnimationFrameSyncer) {\n        this.postponedActions = [];\n        const initialCommand = new SetModelCommand(new SetModelAction(EMPTY_ROOT));\n        this.blockUntil = initialCommand.blockUntil;\n        this.commandStack.execute(initialCommand);\n    }\n\n    dispatchAll(actions: Action[]): Promise<void> {\n        return Promise.all(actions.map(action => this.dispatch(action))) as Promise<any>;\n    }\n\n    dispatch(action: Action): Promise<void> {\n        if (this.blockUntil !== undefined) {\n            return this.handleBlocked(action, this.blockUntil);\n        } else if (action.kind === UndoAction.KIND) {\n            return this.commandStack.undo().then(() => {});\n        } else if (action.kind === RedoAction.KIND) {\n            return this.commandStack.redo().then(() => {});\n        } else {\n            return this.handleAction(action);\n        }\n    }\n\n    protected handleAction(action: Action): Promise<void> {\n        this.logger.log(this, 'handle', action);\n        const handlers = this.actionHandlerRegistry.get(action.kind);\n        if (handlers.length > 0) {\n            const promises: Promise<any>[] = [];\n            for (const handler of handlers) {\n                const result = handler.handle(action);\n                if (isAction(result)) {\n                    promises.push(this.dispatch(result));\n                } else if (result !== undefined) {\n                    promises.push(this.commandStack.execute(result));\n                    this.blockUntil = result.blockUntil;\n                }\n            }\n            return Promise.all(promises) as Promise<any>;\n        } else {\n            this.logger.warn(this, 'Missing handler for action', action);\n            return Promise.reject(`Missing handler for action '${action.kind}'`);\n        }\n    }\n\n    protected handleBlocked(action: Action, predicate: (action: Action) => boolean): Promise<void> {\n        if (predicate(action)) {\n            this.blockUntil = undefined;\n            const result = this.handleAction(action);\n            const actions = this.postponedActions;\n            this.postponedActions = [];\n            for (const a of actions) {\n                this.dispatch(a.action).then(a.resolve, a.reject);\n            }\n            return result;\n        } else {\n            this.logger.log(this, 'Action is postponed due to block condition', action);\n            return new Promise((resolve, reject) => {\n                this.postponedActions.push({ action, resolve, reject });\n            });\n        }\n    }\n}\n\nexport interface PostponedAction {\n    action: Action\n    resolve: () => void\n    reject: (reason: any) => void\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable, multiInject, optional } from \"inversify\";\nimport { TYPES } from \"../types\";\nimport { MultiInstanceRegistry } from \"../../utils/registry\";\nimport { CommandActionHandler, ICommand, ICommandFactory } from \"../commands/command\";\nimport { Action } from \"./action\";\n\n/**\n * An action handler accepts an action and reacts to it by returning either a command to be\n * executed, or another action to be dispatched.\n */\nexport interface IActionHandler {\n    handle(action: Action): ICommand | Action | void\n}\n\n/**\n * Initializes and registers action handlers.\n */\nexport interface IActionHandlerInitializer {\n    initialize(registry: ActionHandlerRegistry): void\n}\n\n/**\n * The action handler registry maps actions to their handlers using the Action.kind property.\n */\n@injectable()\nexport class ActionHandlerRegistry extends MultiInstanceRegistry<IActionHandler> {\n\n    constructor(@multiInject(TYPES.IActionHandlerInitializer) @optional() initializers: (IActionHandlerInitializer)[]) {\n        super();\n\n        initializers.forEach(\n            initializer => this.initializeActionHandler(initializer)\n        );\n    }\n\n    registerCommand(commandType: ICommandFactory): void {\n        this.register(commandType.KIND, new CommandActionHandler(commandType));\n    }\n\n    initializeActionHandler(initializer: IActionHandlerInitializer): void {\n        initializer.initialize(this);\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/**\n * An action describes a change to the model declaratively.\n * It is a plain data structure, and as such transferable between server and client. An action must never contain actual\n * SModelElement instances, but either refer to them via their ids or contain serializable schema for model elements.\n */\nexport interface Action {\n    readonly kind: string\n}\n\nexport function isAction(object?: any): object is Action {\n    return object !== undefined && object.hasOwnProperty('kind') && typeof(object['kind']) === 'string';\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable } from \"inversify\";\n\n@injectable()\nexport class AnimationFrameSyncer {\n\n    tasks: ((x?: number) => void) [] = [];\n    endTasks: ((x?: number) => void) [] = [];\n    triggered: boolean = false;\n\n    isAvailable(): boolean {\n        return typeof requestAnimationFrame === \"function\";\n    }\n\n    onNextFrame(task: (x?: number) => void) {\n        this.tasks.push(task);\n        this.trigger();\n    }\n\n    onEndOfNextFrame(task: (x?: number) => void) {\n        this.endTasks.push(task);\n        this.trigger();\n    }\n\n    protected trigger() {\n        if (!this.triggered) {\n            this.triggered = true;\n            if (this.isAvailable())\n                requestAnimationFrame((time: number) => this.run(time));\n            else\n                setTimeout((time: number) => this.run(time));\n        }\n    }\n\n    protected run(time: number) {\n        const tasks = this.tasks;\n        const endTasks = this.endTasks;\n        this.triggered = false;\n        this.tasks = [];\n        this.endTasks = [];\n        tasks.forEach(task => task.call(undefined, time));\n        endTasks.forEach(task => task.call(undefined, time));\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { CommandExecutionContext } from \"../commands/command\";\nimport { SModelRoot } from \"../model/smodel\";\nimport { easeInOut } from \"./easing\";\n\n/**\n * An animation uses the rendering loop of the browser to smoothly\n * calculate a transition between two states of a model element.\n */\nexport abstract class Animation {\n\n    constructor(protected context: CommandExecutionContext, protected ease: (x: number) => number = easeInOut) {\n    }\n\n    start(): Promise<SModelRoot> {\n        return new Promise<SModelRoot>(\n            (resolve: (model: SModelRoot) => void, reject: (model: SModelRoot) => void) => {\n                let start: number | undefined = undefined;\n                let frames = 0;\n                const lambda = (time: number) => {\n                    frames++;\n                    let dtime: number;\n                    if (start === undefined) {\n                        start = time;\n                        dtime = 0;\n                    } else {\n                        dtime = time - start;\n                    }\n                    const t = Math.min(1, dtime / this.context.duration);\n                    const current = this.tween(this.ease(t), this.context);\n                    this.context.modelChanged.update(current);\n                    if (t === 1) {\n                        this.context.logger.log(this, (frames * 1000 / this.context.duration) + ' fps');\n                        resolve(current);\n                    } else {\n                        this.context.syncer.onNextFrame(lambda);\n                    }\n                };\n                if (this.context.syncer.isAvailable()) {\n                    this.context.syncer.onNextFrame(lambda);\n                } else {\n                    const finalModel = this.tween(1, this.context);\n                    resolve(finalModel);\n                }\n            });\n    }\n\n    /**\n     * This method called by the animation at each rendering pass until\n     * the duration is reached. Implement it to interpolate the state.\n     *\n     * @param t varies between 0 (start of animation) and 1 (end of animation)\n     * @param context\n     */\n    abstract tween(t: number, context: CommandExecutionContext): SModelRoot;\n}\n\nexport class CompoundAnimation extends Animation {\n\n    constructor(protected model: SModelRoot,\n                protected context: CommandExecutionContext,\n                public components: Animation[] = [],\n                protected ease: (x: number) => number = easeInOut) {\n        super(context, ease);\n    }\n\n    include(animation: Animation): this {\n        this.components.push(animation);\n        return this;\n    }\n\n    tween(t: number, context: CommandExecutionContext): SModelRoot {\n        for (const a of this.components) {\n            a.tween(t, context);\n        }\n        return this.model;\n    }\n\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/**\n * Slows down animations towards the begin and the end.\n *\n * @param x the value between 0 (start of animation) and 1 (end of\n *     animation) linearly interpolated in time.\n * @returns {number} the eased value between 0 and 1\n */\nexport function easeInOut(x: number): number {\n    if (x < 0.5)\n        return x * x * 2;\n    else\n        return 1 - (1 - x) * (1 - x) * 2;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Container } from \"inversify\";\nimport { TYPES } from '../types';\n\n/**\n * Options for the command execution\n */\nexport interface CommandStackOptions {\n    /**\n     * The default duration of an animated command in milliseconds\n     */\n    defaultDuration: number\n\n    /**\n     * The maximum number of commands that can be undone. Once the undo stack\n     * reaches this number, any additional command that is pushed will remove\n     * one from the bottom of the stack.\n     *\n     * If negative, there is no limit, which results in a memory leak.\n     */\n    undoHistoryLimit: number\n}\n\nexport function overrideCommandStackOptions(container: Container, options: Partial<CommandStackOptions>): CommandStackOptions {\n    const defaultOptions = container.get<CommandStackOptions>(TYPES.CommandStackOptions);\n    for (const p in options) {\n        if (options.hasOwnProperty(p))\n            (defaultOptions as any)[p] = (options as any)[p];\n    }\n    return defaultOptions;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable } from \"inversify\";\nimport { TYPES } from \"../types\";\nimport { ILogger } from \"../../utils/logging\";\nimport { EMPTY_ROOT, IModelFactory } from \"../model/smodel-factory\";\nimport { SModelRoot } from \"../model/smodel\";\nimport { AnimationFrameSyncer } from \"../animations/animation-frame-syncer\";\nimport { IViewer, IViewerProvider } from \"../views/viewer\";\nimport { CommandStackOptions } from './command-stack-options';\nimport {\n    HiddenCommand, ICommand, CommandExecutionContext, CommandResult, SystemCommand, MergeableCommand, PopupCommand\n} from './command';\n\n/**\n * The component that holds the current model and applies the commands\n * to change it.\n *\n * The command stack is called by the ActionDispatcher and forwards the\n * changed model to the Viewer that renders it.\n */\nexport interface ICommandStack {\n    /**\n     * Executes the given command on the current model and returns a\n     * Promise for the new result.\n     *\n     * Unless it is a special command, it is pushed to the undo stack\n     * such that it can be rolled back later and the redo stack is\n     * cleared.\n     */\n    execute(command: ICommand): Promise<SModelRoot>\n\n    /**\n     * Executes all of the given commands. As opposed to calling\n     * execute() multiple times, the Viewer is only updated once after\n     * the last command has been executed.\n     */\n    executeAll(commands: ICommand[]): Promise<SModelRoot>\n\n    /**\n     * Takes the topmost command from the undo stack, undoes its\n     * changes and pushes it ot the redo stack. Returns a Promise for\n     * the changed model.\n     */\n    undo(): Promise<SModelRoot>\n\n    /**\n     * Takes the topmost command from the redo stack, redoes its\n     * changes and pushes it ot the undo stack. Returns a Promise for\n     * the changed model.\n     */\n    redo(): Promise<SModelRoot>\n}\n\n/**\n * As part of the event cylce, the ICommandStack should be injected\n * using a provider to avoid cyclic injection dependencies.\n */\nexport type CommandStackProvider = () => Promise<ICommandStack>;\n\n/**\n * The implementation of the ICommandStack. Clients should not use this\n * class directly.\n *\n * The command stack holds the current model as the result of the current\n * promise. When a new command is executed/undone/redone, its execution is\n * chained using <code>Promise#then()</code> to the current Promise. This\n * way we can handle long running commands without blocking the current\n * thread.\n *\n * The command stack also does the special handling for special commands:\n *\n * System commands should be transparent to the user and as such be\n * automatically undone/redone with the next plain command. Additional care\n * must be taken that system commands that are executed after undo don't\n * break the correspondence between the topmost commands on the undo and\n * redo stacks.\n *\n * Hidden commands only tell the viewer to render a hidden model such that\n * its bounds can be extracted from the DOM and forwarded as separate actions.\n * Hidden commands should not leave any trace on the undo/redo/off stacks.\n *\n * Mergeable commands should be merged with their predecessor if possible,\n * such that e.g. multiple subsequent moves of the smae element can be undone\n * in one single step.\n */\n@injectable()\nexport class CommandStack implements ICommandStack {\n\n    protected currentPromise: Promise<CommandStackState>;\n\n    protected viewer?: IViewer;\n\n    protected undoStack: ICommand[] = [];\n    protected redoStack: ICommand[] = [];\n\n    /**\n     * System commands should be transparent to the user in undo/redo\n     * operations. When a system command is executed when the redo\n     * stack is not empty, it is pushed to offStack instead.\n     *\n     * On redo, all commands form this stack are undone such that the\n     * redo operation gets the exact same model as when it was executed\n     * first.\n     *\n     * On undo, all commands form this stack are undone as well as\n     * system ommands should be transparent to the user.\n     */\n    protected offStack: SystemCommand[] = [];\n\n    constructor(@inject(TYPES.IModelFactory) protected modelFactory: IModelFactory,\n                @inject(TYPES.IViewerProvider) protected viewerProvider: IViewerProvider,\n                @inject(TYPES.ILogger) protected logger: ILogger,\n                @inject(TYPES.AnimationFrameSyncer) protected syncer: AnimationFrameSyncer,\n                @inject(TYPES.CommandStackOptions) protected options: CommandStackOptions) {\n        this.currentPromise = Promise.resolve({\n            root: modelFactory.createRoot(EMPTY_ROOT),\n            hiddenRoot: undefined,\n            popupRoot: undefined,\n            rootChanged: false,\n            hiddenRootChanged: false,\n            popupChanged: false\n        });\n    }\n\n    protected get currentModel(): Promise<SModelRoot> {\n        return this.currentPromise.then(\n            state => state.root\n        );\n    }\n\n    executeAll(commands: ICommand[]): Promise<SModelRoot> {\n        commands.forEach(\n            command => {\n                this.logger.log(this, 'Executing', command);\n                this.handleCommand(command, command.execute, this.mergeOrPush);\n            }\n        );\n        return this.thenUpdate();\n    }\n\n    execute(command: ICommand): Promise<SModelRoot> {\n        this.logger.log(this, 'Executing', command);\n        this.handleCommand(command, command.execute, this.mergeOrPush);\n        return this.thenUpdate();\n    }\n\n    undo(): Promise<SModelRoot> {\n        this.undoOffStackSystemCommands();\n        this.undoPreceedingSystemCommands();\n        const command = this.undoStack.pop();\n        if (command !== undefined) {\n            this.logger.log(this, 'Undoing', command);\n            this.handleCommand(command, command.undo, (c: ICommand, context: CommandExecutionContext) => {\n                this.redoStack.push(c);\n            });\n        }\n        return this.thenUpdate();\n    }\n\n    redo(): Promise<SModelRoot> {\n        this.undoOffStackSystemCommands();\n        const command = this.redoStack.pop();\n        if (command !== undefined) {\n            this.logger.log(this, 'Redoing', command);\n            this.handleCommand(command, command.redo, (c: ICommand, context: CommandExecutionContext) => {\n                this.pushToUndoStack(c);\n            });\n        }\n        this.redoFollowingSystemCommands();\n        return this.thenUpdate();\n    }\n\n    /**\n     * Chains the current promise with another Promise that performs the\n     * given operation on the given command.\n     *\n     * @param beforeResolve a function that is called directly before\n     * resolving the Promise to return the new model. Usually puts the\n     * command on the appropriate stack.\n     */\n    protected handleCommand(command: ICommand,\n                            operation: (context: CommandExecutionContext) => CommandResult,\n                            beforeResolve: (command: ICommand, context: CommandExecutionContext) => void) {\n        this.currentPromise = this.currentPromise.then(state =>\n            new Promise((resolve: (result: CommandStackState) => void, reject: (reason?: any) => void) => {\n                const context = this.createContext(state.root);\n\n                let newResult: CommandResult;\n                try {\n                    newResult = operation.call(command, context);\n                } catch (error) {\n                    this.logger.error(this, \"Failed to execute command:\", error);\n                    newResult = state.root;\n                }\n\n                if (command instanceof HiddenCommand) {\n                    resolve({\n                        ...state, ...{\n                            hiddenRoot: newResult as SModelRoot,\n                            hiddenRootChanged: true\n                        }\n                    });\n                } else if (command instanceof PopupCommand) {\n                    resolve({\n                        ...state, ...{\n                            popupRoot: newResult as SModelRoot,\n                            popupChanged: true\n                        }\n                    });\n                } else if (newResult instanceof Promise) {\n                    newResult.then(\n                        (newModel: SModelRoot) => {\n                            beforeResolve.call(this, command, context);\n                            resolve({\n                                ...state, ...{\n                                    root: newModel,\n                                    rootChanged: true\n                                }\n                            });\n                        }\n                    );\n                } else {\n                    beforeResolve.call(this, command, context);\n                    resolve({\n                        ...state, ...{\n                            root: newResult,\n                            rootChanged: true\n                        }\n                    });\n                }\n            })\n        );\n    }\n\n    protected pushToUndoStack(command: ICommand) {\n        this.undoStack.push(command);\n        if (this.options.undoHistoryLimit >= 0 && this.undoStack.length > this.options.undoHistoryLimit)\n            this.undoStack.splice(0, this.undoStack.length - this.options.undoHistoryLimit);\n    }\n\n    /**\n     * Notifies the Viewer to render the new model and/or the new hidden model\n     * and returns a Promise for the new model.\n     */\n    protected thenUpdate(): Promise<SModelRoot> {\n        this.currentPromise = this.currentPromise.then(async state => {\n            if (state.hiddenRootChanged && state.hiddenRoot !== undefined)\n                await this.updateHidden(state.hiddenRoot);\n            if (state.rootChanged)\n                await this.update(state.root);\n            if (state.popupChanged && state.popupRoot !== undefined)\n                await this.updatePopup(state.popupRoot);\n            return {\n                root: state.root,\n                hiddenRoot: undefined,\n                popupRoot: undefined,\n                rootChanged: false,\n                hiddenRootChanged: false,\n                popupChanged: false\n            };\n        });\n        return this.currentModel;\n    }\n\n    /**\n     * Notify the <code>Viewer</code> that the model has changed.\n     */\n    async update(model: SModelRoot): Promise<void> {\n        if (this.viewer === undefined)\n            this.viewer = await this.viewerProvider();\n        this.viewer.update(model);\n    }\n\n    /**\n     * Notify the <code>Viewer</code> that the hidden model has changed.\n     */\n    async updateHidden(model: SModelRoot): Promise<void> {\n        if (this.viewer === undefined)\n            this.viewer = await this.viewerProvider();\n        this.viewer.updateHidden(model);\n    }\n\n    /**\n     * Notify the <code>Viewer</code> that the model has changed.\n     */\n    async updatePopup(model: SModelRoot): Promise<void> {\n        if (this.viewer === undefined)\n            this.viewer = await this.viewerProvider();\n        this.viewer.updatePopup(model);\n    }\n\n    /**\n     * Handling of commands after their execution.\n     *\n     * Hidden commands are not pushed to any stack.\n     *\n     * System commands are pushed to the <code>offStack</code> when the redo\n     * stack is not empty, allowing to undo the before a redo to keep the chain\n     * of commands consistent.\n     *\n     * Mergable commands are merged if possible.\n     */\n    protected mergeOrPush(command: ICommand, context: CommandExecutionContext): void {\n        if (command instanceof HiddenCommand)\n            return;\n        if (command instanceof SystemCommand && this.redoStack.length > 0) {\n            this.offStack.push(command);\n        } else {\n            this.offStack.forEach(c => this.undoStack.push(c));\n            this.offStack = [];\n            this.redoStack = [];\n            if (this.undoStack.length > 0) {\n                const lastCommand = this.undoStack[this.undoStack.length - 1];\n                if (lastCommand instanceof MergeableCommand && lastCommand.merge(command, context))\n                    return;\n            }\n            this.pushToUndoStack(command);\n        }\n    }\n\n    /**\n     * Reverts all system commands on the offStack.\n     */\n    protected undoOffStackSystemCommands(): void {\n        let command = this.offStack.pop();\n        while (command !== undefined) {\n            this.logger.log(this, 'Undoing off-stack', command);\n            this.handleCommand(command, command.undo, () => {});\n            command = this.offStack.pop();\n        }\n    }\n\n    /**\n     * System commands should be transparent to the user, so this method\n     * is called from <code>undo()</code> to revert all system commands\n     * at the top of the undoStack.\n     */\n    protected undoPreceedingSystemCommands(): void {\n        let command = this.undoStack[this.undoStack.length - 1];\n        while (command !== undefined && command instanceof SystemCommand) {\n            this.undoStack.pop();\n            this.logger.log(this, 'Undoing', command);\n            this.handleCommand(command, command.undo, (c: ICommand, context: CommandExecutionContext) => {\n                this.redoStack.push(c);\n            });\n            command = this.undoStack[this.undoStack.length - 1];\n        }\n    }\n\n    /**\n     * System commands should be transparent to the user, so this method\n     * is called from <code>redo()</code> to re-execute all system commands\n     * at the top of the redoStack.\n     */\n    protected redoFollowingSystemCommands(): void {\n        let command = this.redoStack[this.redoStack.length - 1];\n        while (command !== undefined && command instanceof SystemCommand) {\n            this.redoStack.pop();\n            this.logger.log(this, 'Redoing ', command);\n            this.handleCommand(command, command.redo, (c: ICommand, context: CommandExecutionContext) => {\n                this.pushToUndoStack(c);\n            });\n            command = this.redoStack[this.redoStack.length - 1];\n        }\n    }\n\n    /**\n     * Assembles the context object that is passed to the commands execution method.\n     */\n    protected createContext(currentModel: SModelRoot): CommandExecutionContext {\n        return {\n            root: currentModel,\n            modelChanged: this,\n            modelFactory: this.modelFactory,\n            duration: this.options.defaultDuration,\n            logger: this.logger,\n            syncer: this.syncer\n        };\n    }\n}\n\n/**\n * Internal type to pass the results between the <code>Promises</code> in the\n * <code>ICommandStack</code>.\n */\nexport interface CommandStackState {\n    root: SModelRoot\n    hiddenRoot: SModelRoot | undefined\n    popupRoot: SModelRoot | undefined\n    rootChanged: boolean\n    hiddenRootChanged: boolean\n    popupChanged: boolean\n}\n\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ILogger } from \"../../utils/logging\";\nimport { SModelRoot } from \"../model/smodel\";\nimport { IModelFactory } from \"../model/smodel-factory\";\nimport { IViewer } from \"../views/viewer\";\nimport { AnimationFrameSyncer } from \"../animations/animation-frame-syncer\";\nimport { Action } from \"../actions/action\";\nimport { ActionHandlerRegistry, IActionHandler, IActionHandlerInitializer } from \"../actions/action-handler\";\nimport { injectable, multiInject, optional } from \"inversify\";\nimport { TYPES } from \"../types\";\n\n/**\n * A command holds the behaviour of an action.\n * It is executed on a command stack and can be undone / redone.\n *\n * A command should store all information it needs to undo itself at a\n * later stage. It typically resolves the model elements it is going\n * to manipulate as a first step in the execute method.\n *\n * Each command should define a static string property KIND that\n * matches the associated action. This is used as a key in the\n * ActionHandlerRegistry.\n *\n * Clients should not implement the ICommand interface directly but\n * rather inherit from one of its abstract implementators.\n */\nexport interface ICommand {\n    /**\n     * If this property is present, all following actions are blocked\n     * until the function returns `true`.\n     */\n    readonly blockUntil?: (action: Action) => boolean;\n\n    execute(context: CommandExecutionContext): CommandResult\n\n    undo(context: CommandExecutionContext): CommandResult\n\n    redo(context: CommandExecutionContext): CommandResult\n}\n\n/**\n * Commands return the changed model or a Promise for it. The latter\n * serves animating commands to render some intermediate states before\n * finishing. The CommandStack is in charge of chaining these promises,\n * such that they run sequentially only one at a time. Due to that\n * chaining, it is essential that a command does not make any assumption\n * on the state of the model before execute() is called.\n */\nexport type CommandResult = SModelRoot | Promise<SModelRoot>;\n\nexport interface ICommandFactory {\n    KIND: string\n    new (a: Action): ICommand\n}\n\n/**\n * Base class for all commands.\n */\nexport abstract class Command implements ICommand {\n\n    abstract execute(context: CommandExecutionContext): CommandResult;\n\n    abstract undo(context: CommandExecutionContext): CommandResult;\n\n    abstract redo(context: CommandExecutionContext): CommandResult;\n}\n\n/**\n * A mergeable command can accumulate subsequent commands of the same kind.\n *\n * For example, multiple subsequent move commands can be merged to yield a\n * single command, such that undo will roll them back altogether. Otherwise\n * the user would have to push CTRL-Z for each mouse move element that\n * resuted in a command.\n */\nexport abstract class MergeableCommand extends Command {\n    /**\n     * Tries to merge the given command with this.\n     *\n     * @param command\n     * @param context\n     */\n    merge(command: ICommand, context: CommandExecutionContext): boolean {\n        return false;\n    }\n}\n\n\n/**\n * A hidden command is used to trigger the rendering of a model on a\n * hidden canvas.\n *\n * Some graphical elements are styled using CSS, others have bounds that\n * require to layout their children before being computed. In such cases\n * we cannot tell about the size of elements without acutally rendering\n * the DOM. We render them to an invisible canvas. This can be achieved\n * using hidden commands.\n *\n * Hidden commands do not change the model directly, and are as such\n * neither undoable nor redoable. The command stack does not push them on\n * any stack and forwards the resulting model to the invisible viewer.\n */\nexport abstract class HiddenCommand extends Command {\n    abstract execute(context: CommandExecutionContext): SModelRoot;\n\n    undo(context: CommandExecutionContext): CommandResult {\n        context.logger.error(this, 'Cannot undo a hidden command');\n        return context.root;\n    }\n\n    redo(context: CommandExecutionContext): CommandResult {\n        context.logger.error(this, 'Cannot redo a hidden command');\n        return context.root;\n    }\n}\n\nexport abstract class PopupCommand extends Command {\n}\n\n/**\n * A system command is triggered by the system, e.g. in order to update bounds\n * in the model with data fetched from the DOM.\n *\n * As it is automatically triggered it should not count as a single command in\n * undo/redo operations. Into the bargain, such an automatic command could occur\n * after an undo and as such make the next redo command invalid because it is\n * based on a model state that has changed. The command stack handles system\n * commands in a special way to overcome these issues.\n */\nexport abstract class SystemCommand extends Command {\n}\n\n/**\n * The data that is passed into the execution methods of a command to give it\n * access to the context.\n */\nexport interface CommandExecutionContext {\n    /** the current sprotty model */\n    root: SModelRoot\n\n    /**\n     * used ot turn sprotty schema elements (e.g. from the action)\n     * into model elements*/\n    modelFactory: IModelFactory\n\n    /** allows to give some feedback to the console */\n    logger: ILogger\n\n    /** Used for anmiations to trigger the rendering of a new frame */\n    modelChanged: IViewer\n\n    /** duration of an anmiation */\n    duration: number\n\n    /** provides the ticks for animations */\n    syncer: AnimationFrameSyncer\n}\n\nexport class CommandActionHandler implements IActionHandler {\n    constructor(private commandType: ICommandFactory) {\n    }\n\n    handle(action: Action): ICommand {\n        return new this.commandType(action);\n    }\n}\n\n@injectable()\nexport class CommandActionHandlerInitializer implements IActionHandlerInitializer {\n\n    constructor(@multiInject(TYPES.ICommand) @optional() protected commandCtrs: (ICommandFactory)[]) {\n\n    }\n\n    initialize(registry: ActionHandlerRegistry): void {\n        this.commandCtrs.forEach(\n            commandCtr => registry.registerCommand(commandCtr)\n        );\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule, interfaces } from \"inversify\";\nimport { SModelStorage } from './model/smodel-storage';\nimport { TYPES } from \"./types\";\nimport { CanvasBoundsInitializer, InitializeCanvasBoundsCommand } from './features/initialize-canvas';\nimport { LogLevel, NullLogger } from \"../utils/logging\";\nimport { ActionDispatcher, IActionDispatcher } from \"./actions/action-dispatcher\";\nimport { ActionHandlerRegistry } from \"./actions/action-handler\";\nimport { CommandStack, ICommandStack } from \"./commands/command-stack\";\nimport { CommandStackOptions } from \"./commands/command-stack-options\";\nimport { SModelFactory, SModelRegistry } from './model/smodel-factory';\nimport { AnimationFrameSyncer } from \"./animations/animation-frame-syncer\";\nimport { IViewer, Viewer, ModelRenderer } from \"./views/viewer\";\nimport { ViewerOptions, defaultViewerOptions } from \"./views/viewer-options\";\nimport { MouseTool, PopupMouseTool } from \"./views/mouse-tool\";\nimport { KeyTool } from \"./views/key-tool\";\nimport { FocusFixDecorator, IVNodeDecorator } from \"./views/vnode-decorators\";\nimport { ViewRegistry } from \"./views/view\";\nimport { ViewerCache } from \"./views/viewer-cache\";\nimport { DOMHelper } from \"./views/dom-helper\";\nimport { IdDecorator } from \"./views/id-decorator\";\nimport { CommandActionHandlerInitializer } from \"./commands/command\";\n\nconst defaultContainerModule = new ContainerModule(bind => {\n    // Logging ---------------------------------------------\n    bind(TYPES.ILogger).to(NullLogger).inSingletonScope();\n    bind(TYPES.LogLevel).toConstantValue(LogLevel.warn);\n\n    // Registries ---------------------------------------------\n    bind(TYPES.SModelRegistry).to(SModelRegistry).inSingletonScope();\n    bind(TYPES.ActionHandlerRegistry).to(ActionHandlerRegistry).inSingletonScope();\n    bind(TYPES.ViewRegistry).to(ViewRegistry).inSingletonScope();\n\n    // Model Creation ---------------------------------------------\n    bind(TYPES.IModelFactory).to(SModelFactory).inSingletonScope();\n\n    // Action Dispatcher ---------------------------------------------\n    bind(TYPES.IActionDispatcher).to(ActionDispatcher).inSingletonScope();\n    bind(TYPES.IActionDispatcherProvider).toProvider<IActionDispatcher>((context) => {\n        return () => {\n            return new Promise<IActionDispatcher>((resolve) => {\n                resolve(context.container.get<IActionDispatcher>(TYPES.IActionDispatcher));\n            });\n        };\n    });\n\n    // Action handler\n    bind(TYPES.IActionHandlerInitializer).to(CommandActionHandlerInitializer);\n\n    // Command Stack ---------------------------------------------\n    bind(TYPES.ICommandStack).to(CommandStack).inSingletonScope();\n    bind(TYPES.ICommandStackProvider).toProvider<ICommandStack>((context) => {\n        return () => {\n            return new Promise<ICommandStack>((resolve) => {\n                resolve(context.container.get<ICommandStack>(TYPES.ICommandStack));\n            });\n        };\n    });\n    bind<CommandStackOptions>(TYPES.CommandStackOptions).toConstantValue({\n        defaultDuration: 250,\n        undoHistoryLimit: 50\n    });\n\n    // Viewer ---------------------------------------------\n    bind(Viewer).toSelf().inSingletonScope();\n    bind(TYPES.IViewer).toDynamicValue(context =>\n        context.container.get(Viewer)).inSingletonScope().whenTargetNamed('delegate');\n    bind(ViewerCache).toSelf().inSingletonScope();\n    bind(TYPES.IViewer).toDynamicValue(context =>\n        context.container.get(ViewerCache)).inSingletonScope().whenTargetIsDefault();\n    bind(TYPES.IViewerProvider).toProvider<IViewer>((context) => {\n        return () => {\n            return new Promise<IViewer>((resolve) => {\n                resolve(context.container.get<IViewer>(TYPES.IViewer));\n            });\n        };\n    });\n    bind<ViewerOptions>(TYPES.ViewerOptions).toConstantValue(defaultViewerOptions());\n    bind(TYPES.DOMHelper).to(DOMHelper).inSingletonScope();\n    bind(TYPES.ModelRendererFactory).toFactory<ModelRenderer>((context: interfaces.Context) => {\n        return (decorators: IVNodeDecorator[]) => {\n            const viewRegistry = context.container.get<ViewRegistry>(TYPES.ViewRegistry);\n            return new ModelRenderer(viewRegistry, decorators);\n        };\n    });\n\n    // Tools & Decorators --------------------------------------\n    bind(IdDecorator).toSelf().inSingletonScope();\n    bind(TYPES.IVNodeDecorator).toDynamicValue(context =>\n        context.container.get(IdDecorator)).inSingletonScope();\n    bind(MouseTool).toSelf().inSingletonScope();\n    bind(TYPES.IVNodeDecorator).toDynamicValue(context =>\n        context.container.get(MouseTool)).inSingletonScope();\n    bind(KeyTool).toSelf().inSingletonScope();\n    bind(TYPES.IVNodeDecorator).toDynamicValue(context =>\n        context.container.get(KeyTool)).inSingletonScope();\n    bind(FocusFixDecorator).toSelf().inSingletonScope();\n    bind(TYPES.IVNodeDecorator).toDynamicValue(context =>\n        context.container.get(FocusFixDecorator)).inSingletonScope();\n    bind(TYPES.PopupVNodeDecorator).toDynamicValue(context =>\n        context.container.get(IdDecorator)).inSingletonScope();\n    bind(PopupMouseTool).toSelf().inSingletonScope();\n    bind(TYPES.PopupVNodeDecorator).toDynamicValue(context =>\n        context.container.get(PopupMouseTool)).inSingletonScope();\n    bind(TYPES.HiddenVNodeDecorator).toDynamicValue(context =>\n        context.container.get(IdDecorator)).inSingletonScope();\n\n    // Animation Frame Sync ------------------------------------------\n    bind(TYPES.AnimationFrameSyncer).to(AnimationFrameSyncer).inSingletonScope();\n\n    // Canvas Initialization ---------------------------------------------\n    bind(TYPES.ICommand).toConstructor(InitializeCanvasBoundsCommand);\n    bind(CanvasBoundsInitializer).toSelf().inSingletonScope();\n    bind(TYPES.IVNodeDecorator).toDynamicValue(context =>\n        context.container.get(CanvasBoundsInitializer)).inSingletonScope();\n    bind(TYPES.SModelStorage).to(SModelStorage).inSingletonScope();\n\n});\n\nexport default defaultContainerModule;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable, inject } from \"inversify\";\nimport { VNode } from \"snabbdom/vnode\";\nimport { TYPES } from \"../types\";\nimport { almostEquals, Bounds, isValidDimension, ORIGIN_POINT } from '../../utils/geometry';\nimport { Action } from '../actions/action';\nimport { IActionDispatcher } from '../actions/action-dispatcher';\nimport { IVNodeDecorator } from \"../views/vnode-decorators\";\nimport { SModelElement, SModelRoot } from \"../model/smodel\";\nimport { SystemCommand, CommandExecutionContext } from '../commands/command';\n\n/**\n * Grabs the bounds from the root element in page coordinates and fires a\n * InitializeCanvasBoundsAction. This size is needed for other actions such\n * as FitToScreenAction.\n */\n@injectable()\nexport class CanvasBoundsInitializer implements IVNodeDecorator {\n\n    protected rootAndVnode: [SModelRoot, VNode] | undefined;\n\n    constructor(@inject(TYPES.IActionDispatcher) protected actionDispatcher: IActionDispatcher) {}\n\n    decorate(vnode: VNode, element: SModelElement): VNode {\n        if (element instanceof SModelRoot && !isValidDimension(element.canvasBounds)) {\n            this.rootAndVnode = [element, vnode];\n        }\n        return vnode;\n    }\n\n    postUpdate() {\n        if (this.rootAndVnode !== undefined) {\n            const domElement = this.rootAndVnode[1].elm;\n            const oldBounds = this.rootAndVnode[0].canvasBounds;\n            if (domElement !== undefined) {\n                const newBounds = this.getBoundsInPage(domElement as Element);\n                if (!(almostEquals(newBounds.x, oldBounds.x)\n                        && almostEquals(newBounds.y, oldBounds.y)\n                        && almostEquals(newBounds.width, oldBounds.width)\n                        && almostEquals(newBounds.height, oldBounds.width)))\n                    this.actionDispatcher.dispatch(new InitializeCanvasBoundsAction(newBounds));\n\n            }\n            this.rootAndVnode = undefined;\n        }\n    }\n\n    protected getBoundsInPage(element: Element) {\n        const bounds = element.getBoundingClientRect();\n        const scroll = typeof window !== 'undefined' ? { x: window.scrollX, y: window.scrollY } : ORIGIN_POINT;\n        return {\n            x: bounds.left + scroll.x,\n            y: bounds.top + scroll.y,\n            width: bounds.width,\n            height: bounds.height\n        };\n    }\n}\n\nexport class InitializeCanvasBoundsAction implements Action {\n    readonly kind = InitializeCanvasBoundsCommand.KIND;\n\n    constructor(public readonly newCanvasBounds: Bounds) {\n    }\n}\n\nexport class InitializeCanvasBoundsCommand extends SystemCommand {\n    static readonly KIND: string  = 'initializeCanvasBounds';\n\n    private newCanvasBounds: Bounds;\n\n    constructor(protected action: InitializeCanvasBoundsAction) {\n        super();\n    }\n\n    execute(context: CommandExecutionContext) {\n        this.newCanvasBounds = this.action.newCanvasBounds;\n        context.root.canvasBounds = this.newCanvasBounds;\n        return context.root;\n    }\n\n    undo(context: CommandExecutionContext) {\n        return context.root;\n    }\n\n    redo(context: CommandExecutionContext) {\n        return context.root;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable } from \"inversify\";\nimport { Action } from \"../actions/action\";\nimport { SModelRoot, SModelRootSchema } from \"../model/smodel\";\nimport { Command, CommandExecutionContext } from \"../commands/command\";\nimport { InitializeCanvasBoundsCommand } from './initialize-canvas';\n\n/**\n * Sent from the client to the model source (e.g. a DiagramServer) in order to request a model. Usually this\n * is the first message that is sent to the source, so it is also used to initiate the communication.\n * The response is a SetModelAction or an UpdateModelAction.\n */\nexport class RequestModelAction implements Action {\n    static readonly KIND = 'requestModel';\n    readonly kind = RequestModelAction.KIND;\n\n    constructor(public readonly options?: { [key: string]: string }) {\n    }\n}\n\n/**\n * Sent from the model source to the client in order to set the model. If a model is already present, it is replaced.\n */\nexport class SetModelAction implements Action {\n    readonly kind = SetModelCommand.KIND;\n\n    constructor(public readonly newRoot: SModelRootSchema) {\n    }\n}\n\n@injectable()\nexport class SetModelCommand extends Command {\n    static readonly KIND = 'setModel';\n\n    oldRoot: SModelRoot;\n    newRoot: SModelRoot;\n\n    constructor(public action: SetModelAction) {\n        super();\n    }\n\n    execute(context: CommandExecutionContext): SModelRoot {\n        this.oldRoot = context.modelFactory.createRoot(context.root);\n        this.newRoot = context.modelFactory.createRoot(this.action.newRoot);\n        return this.newRoot;\n    }\n\n    undo(context: CommandExecutionContext): SModelRoot {\n        return this.oldRoot;\n    }\n\n    redo(context: CommandExecutionContext): SModelRoot {\n        return this.newRoot;\n    }\n\n    get blockUntil(): (action: Action) => boolean {\n        return action => action.kind === InitializeCanvasBoundsCommand.KIND;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable, multiInject, optional, inject } from 'inversify';\nimport { TYPES } from \"../types\";\nimport { ProviderRegistry } from '../../utils/registry';\nimport {\n    SChildElement, SModelElement, SModelElementSchema, SModelRoot, SModelRootSchema, SParentElement, isParent\n} from './smodel';\n\n/**\n * A model factory transforms a serializable model schema into the model representation that is used\n * internally by sprotty.\n */\nexport interface IModelFactory {\n    createElement(schema: SModelElementSchema | SModelElement, parent?: SParentElement): SChildElement\n\n    createRoot(schema: SModelRootSchema | SModelRoot): SModelRoot\n\n    createSchema(element: SModelElement): SModelElementSchema\n}\n\n/**\n * The default model factory creates SModelRoot for the root element and SChildElement for all other\n * model elements.\n */\n@injectable()\nexport class SModelFactory implements IModelFactory {\n\n    constructor(@inject(TYPES.SModelRegistry) protected readonly registry: SModelRegistry) {\n    }\n\n    createElement(schema: SModelElementSchema | SModelElement, parent?: SParentElement): SChildElement {\n        let child: SChildElement;\n        if (this.registry.hasKey(schema.type)) {\n            const regElement = this.registry.get(schema.type, undefined);\n            if (!(regElement instanceof SChildElement))\n                throw new Error(`Element with type ${schema.type} was expected to be an SChildElement.`);\n            child = regElement;\n        } else {\n            child = new SChildElement();\n        }\n        return this.initializeChild(child, schema, parent);\n    }\n\n    createRoot(schema: SModelRootSchema | SModelRoot): SModelRoot {\n        let root: SModelRoot;\n        if (this.registry.hasKey(schema.type)) {\n            const regElement = this.registry.get(schema.type, undefined);\n            if (!(regElement instanceof SModelRoot))\n                throw new Error(`Element with type ${schema.type} was expected to be an SModelRoot.`);\n            root = regElement;\n        } else {\n            root = new SModelRoot();\n        }\n        return this.initializeRoot(root, schema);\n    }\n\n    createSchema(element: SModelElement): SModelElementSchema {\n        const schema = {};\n        for (const key in element) {\n             if (!this.isReserved(element, key)) {\n                const value: any = (element as any)[key];\n                if (typeof value !== 'function')\n                    (schema as any)[key] = value;\n            }\n        }\n        if (element instanceof SParentElement)\n            (schema as any)['children'] = element.children.map(child => this.createSchema(child));\n        return schema as SModelElementSchema;\n    }\n\n    protected initializeElement(element: SModelElement, schema: SModelElementSchema | SModelElement): SModelElement {\n        for (const key in schema) {\n            if (!this.isReserved(element, key)) {\n                const value: any = (schema as any)[key];\n                if (typeof value !== 'function')\n                    (element as any)[key] = value;\n            }\n        }\n        return element;\n    }\n\n    protected isReserved(element: SModelElement, propertyName: string) {\n        if (['children', 'parent', 'index'].indexOf(propertyName) >= 0)\n            return true;\n        let obj = element;\n        do {\n            const descriptor = Object.getOwnPropertyDescriptor(obj, propertyName);\n            if (descriptor !== undefined)\n                return descriptor.get !== undefined;\n            obj = Object.getPrototypeOf(obj);\n        } while (obj);\n        return false;\n    }\n\n    protected initializeParent(parent: SParentElement, schema: SModelElementSchema | SParentElement): SParentElement {\n        this.initializeElement(parent, schema);\n        if (isParent(schema)) {\n            (parent as any).children = schema.children.map(childSchema => this.createElement(childSchema, parent));\n        }\n        return parent;\n    }\n\n    protected initializeChild(child: SChildElement, schema: SModelElementSchema, parent?: SParentElement): SChildElement {\n        this.initializeParent(child, schema);\n        if (parent !== undefined) {\n            (child as any).parent = parent;\n        }\n        return child;\n    }\n\n    protected initializeRoot(root: SModelRoot, schema: SModelRootSchema | SModelRoot): SModelRoot {\n        this.initializeParent(root, schema);\n        root.index.add(root);\n        return root;\n    }\n}\n\nexport const EMPTY_ROOT: Readonly<SModelRootSchema> = Object.freeze({\n    type: 'NONE',\n    id: 'EMPTY'\n});\n\n/**\n * Used to bind a model element type to a class constructor in the SModelRegistry.\n */\nexport interface SModelElementRegistration {\n    type: string\n    constr: new () => SModelElement\n}\n\n/**\n * Model element classes registered here are considered automatically when constructring a model from its schema.\n */\n@injectable()\nexport class SModelRegistry extends ProviderRegistry<SModelElement, void> {\n    constructor(@multiInject(TYPES.SModelElementRegistration) @optional() registrations: SModelElementRegistration[]) {\n        super();\n\n        registrations.forEach(\n            registration => this.register(registration.type, registration.constr)\n        );\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable } from \"inversify\";\nimport { TYPES } from '../types';\nimport { ViewerOptions } from \"../views/viewer-options\";\nimport { SModelRootSchema } from './smodel';\nimport { EMPTY_ROOT } from './smodel-factory';\n\n@injectable()\nexport class SModelStorage {\n\n    @inject(TYPES.ViewerOptions) protected viewerOptions: ViewerOptions;\n\n    protected localCache: Map<string, string> = new Map;\n\n    store(root: SModelRootSchema) {\n        if (this.isLocalStorageAvailable())\n            localStorage.setItem(this.key, JSON.stringify(root));\n        else\n            this.localCache.set(this.key, JSON.stringify(root));\n    }\n\n    load(): SModelRootSchema  {\n        const schema = (this.isLocalStorageAvailable())\n            ? localStorage.getItem(this.key)\n            : this.localCache.get(this.key);\n        if (schema)\n            return JSON.parse(schema) as SModelRootSchema;\n        else\n            return EMPTY_ROOT;\n    }\n\n    protected isLocalStorageAvailable(): boolean {\n        try {\n            return typeof localStorage === 'object' && localStorage !== null;\n        } catch (e) {\n            return false;\n        }\n    }\n\n    protected get key(): string {\n        return this.viewerOptions.baseDiv;\n    }\n}\n\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { SChildElement, SModelElement, SModelElementSchema } from \"./smodel\";\nimport { Point } from \"../../utils/geometry\";\n\n/**\n * Model element types can include a colon to separate the basic type and a sub-type. This function\n * extracts the basic type of a model element.\n */\nexport function getBasicType(schema: SModelElementSchema | SModelElement): string {\n    if (!schema.type)\n        return '';\n    const colonIndex = schema.type.indexOf(':');\n    if (colonIndex >= 0)\n        return schema.type.substring(0, colonIndex);\n    else\n        return schema.type;\n}\n\n/**\n * Model element types can include a colon to separate the basic type and a sub-type. This function\n * extracts the sub-type of a model element.\n */\nexport function getSubType(schema: SModelElementSchema | SModelElement): string {\n    if (!schema.type)\n        return '';\n    const colonIndex = schema.type.indexOf(':');\n    if (colonIndex >= 0)\n        return schema.type.substring(colonIndex + 1);\n    else\n        return schema.type;\n}\n\n/**\n * Find the element with the given identifier. If you need to find multiple elements, using an\n * SModelIndex might be more effective.\n */\nexport function findElement(parent: SModelElementSchema, elementId: string): SModelElementSchema | undefined {\n    if (parent.id === elementId)\n        return parent;\n    if (parent.children !== undefined) {\n        for (const child of parent.children) {\n            const result = findElement(child, elementId);\n            if (result !== undefined)\n                return result;\n        }\n    }\n    return undefined;\n}\n\n/**\n * Find a parent element that satisfies the given predicate.\n */\nexport function findParent(element: SModelElement, predicate: (e: SModelElement) => boolean): SModelElement | undefined {\n    let current: SModelElement | undefined = element;\n    while (current !== undefined) {\n        if (predicate(current))\n            return current;\n        else if (current instanceof SChildElement)\n            current = current.parent;\n        else\n            current = undefined;\n    }\n    return current;\n}\n\n/**\n * Find a parent element that implements the feature identified with the given predicate.\n */\nexport function findParentByFeature<T>(element: SModelElement, predicate: (t: SModelElement) => t is SModelElement & T): SModelElement & T | undefined {\n    let current: SModelElement | undefined = element;\n    while (current !== undefined) {\n        if (predicate(current))\n            return current;\n        else if (current instanceof SChildElement)\n            current = current.parent;\n        else\n            current = undefined;\n    }\n    return current;\n}\n\n/**\n * Translate a point from the coordinate system of the source element to the coordinate system\n * of the target element.\n */\nexport function translatePoint(point: Point, source: SModelElement, target: SModelElement): Point {\n    if (source !== target) {\n        // Translate from the source to the root element\n        while (source instanceof SChildElement) {\n            point = source.localToParent(point);\n            source = source.parent;\n            if (source === target)\n                return point;\n        }\n        // Translate from the root to the target element\n        const targetTrace = [];\n        while (target instanceof SChildElement) {\n            targetTrace.push(target);\n            target = target.parent;\n        }\n        if (source !== target)\n            throw new Error(\"Incompatible source and target: \" + source.id + \", \" + target.id);\n        for (let i = targetTrace.length - 1; i >= 0; i--) {\n            point = targetTrace[i].parentToLocal(point);\n        }\n    }\n    return point;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Bounds, EMPTY_BOUNDS, Point, isBounds } from \"../../utils/geometry\";\nimport { mapIterable, FluentIterable } from \"../../utils/iterable\";\n\n/**\n * The schema of an SModelElement describes its serializable form. The actual model is created from\n * its schema with an IModelFactory.\n * Each model element must have a unique ID and a type that is used to look up its view.\n */\nexport interface SModelElementSchema {\n    type: string\n    id: string\n    children?: SModelElementSchema[]\n}\n\n/**\n * Serializable schema for the root element of the model tree.\n */\nexport interface SModelRootSchema extends SModelElementSchema {\n    canvasBounds?: Bounds\n    revision?: number\n}\n\n/**\n * Base class for all elements of the diagram model.\n * Each model element must have a unique ID and a type that is used to look up its view.\n */\nexport class SModelElement {\n    type: string;\n    id: string;\n\n    get root(): SModelRoot {\n        let current: SModelElement | undefined = this;\n        while (current) {\n            if (current instanceof SModelRoot)\n                return current;\n            else if (current instanceof SChildElement)\n                current = current.parent;\n            else\n                current = undefined;\n        }\n        throw new Error(\"Element has no root\");\n    }\n\n    get index(): SModelIndex<SModelElement> {\n        return this.root.index;\n    }\n\n    /**\n     * A feature is a symbol identifying some functionality that can be enabled or disabled for\n     * a model element. The base implementation always returns false, so it disables all features.\n     */\n    hasFeature(feature: symbol): boolean {\n        return false;\n    }\n}\n\nexport function isParent(element: SModelElementSchema | SModelElement):\n        element is SModelElementSchema & { children: SModelElementSchema[] } {\n    const children = (element as any).children;\n    return children !== undefined && children.constructor === Array;\n}\n\n/**\n * A parent element may contain child elements, thus the diagram model forms a tree.\n */\nexport class SParentElement extends SModelElement {\n    readonly children: ReadonlyArray<SChildElement> = [];\n\n    add(child: SChildElement, i?: number) {\n        const children = this.children as SChildElement[];\n        if (i === undefined) {\n            children.push(child);\n        } else {\n            if (i < 0 || i > this.children.length) {\n                throw new Error(`Child index ${i} out of bounds (0..${children.length})`);\n            }\n            children.splice(i, 0, child);\n        }\n        (child as {parent: SParentElement}).parent = this;\n        this.index.add(child);\n    }\n\n    remove(child: SChildElement) {\n        const children = this.children as SChildElement[];\n        const i = children.indexOf(child);\n        if (i < 0) {\n            throw new Error(`No such child ${child.id}`);\n        }\n        children.splice(i, 1);\n        delete (child as {parent: SParentElement}).parent;\n        this.index.remove(child);\n    }\n\n    removeAll(filter?: (e: SChildElement) => boolean) {\n        const children = this.children as SChildElement[];\n        if (filter !== undefined) {\n            for (let i = children.length - 1; i >= 0; i--) {\n                if (filter(children[i])) {\n                    const child = children.splice(i, 1)[0];\n                    delete (child as {parent: SParentElement}).parent;\n                    this.index.remove(child);\n                }\n            }\n        } else {\n            children.forEach(child => {\n                delete (child as {parent: SParentElement}).parent;\n                this.index.remove(child);\n            });\n            children.splice(0, children.length);\n        }\n    }\n\n    move(child: SChildElement, newIndex: number) {\n        const children = this.children as SChildElement[];\n        const i = children.indexOf(child);\n        if (i === -1) {\n            throw new Error(`No such child ${child.id}`);\n        } else {\n            if (newIndex < 0 || newIndex > children.length - 1) {\n                throw new Error(`Child index ${newIndex} out of bounds (0..${children.length})`);\n            }\n            children.splice(i, 1);\n            children.splice(newIndex, 0, child);\n        }\n    }\n\n    /**\n     * Transform the given bounds from the local coordinate system of this element to the coordinate\n     * system of its parent. This function should consider any transformation that is applied to the\n     * view of this element and its contents.\n     * The base implementation assumes that this element does not define a local coordinate system,\n     * so it leaves the bounds unchanged.\n     */\n    localToParent(point: Point | Bounds): Bounds {\n        return isBounds(point) ? point : { x: point.x, y: point.y, width: -1, height: -1 };\n    }\n\n    /**\n     * Transform the given bounds from the coordinate system of this element's parent to its local\n     * coordinate system. This function should consider any transformation that is applied to the\n     * view of this element and its contents.\n     * The base implementation assumes that this element does not define a local coordinate system,\n     * so it leaves the bounds unchanged.\n     */\n    parentToLocal(point: Point | Bounds): Bounds {\n        return isBounds(point) ? point : { x: point.x, y: point.y, width: -1, height: -1 };\n    }\n}\n\n/**\n * A child element is contained in a parent element. All elements except the model root are child\n * elements. In order to keep the model class hierarchy simple, every child element is also a\n * parent element, although for many elements the array of children is empty (i.e. they are\n * leafs in the model element tree).\n */\nexport class SChildElement extends SParentElement {\n    readonly parent: SParentElement;\n}\n\n/**\n * Base class for the root element of the diagram model tree.\n */\nexport class SModelRoot extends SParentElement {\n    readonly index: SModelIndex<SModelElement>;\n    revision?: number;\n\n    canvasBounds: Bounds = EMPTY_BOUNDS;\n\n    constructor(index = new SModelIndex<SModelElement>()) {\n        super();\n        // Override the index property from SModelElement, which has a getter, with a data property\n        Object.defineProperty(this, 'index', {\n            value: index,\n            writable: false\n        });\n    }\n}\n\nconst ID_CHARS = \"0123456789abcdefghijklmnopqrstuvwxyz\";\nexport function createRandomId(length: number = 8): string {\n    let id = \"\";\n    for (let i = 0; i < length; i++) {\n        id += ID_CHARS.charAt(Math.floor(Math.random() * ID_CHARS.length));\n    }\n    return id;\n}\n\n/**\n * Used to speed up model element lookup by id.\n */\nexport class SModelIndex<E extends SModelElementSchema> {\n\n    private id2element: Map<string, E> = new Map;\n\n    add(element: E): void {\n        if (!element.id) {\n            do {\n                element.id = createRandomId();\n            } while (this.contains(element));\n        } else if (this.contains(element)) {\n            throw new Error(\"Duplicate ID in model: \" + element.id);\n        }\n        this.id2element.set(element.id, element);\n        if (element.children !== undefined && element.children.constructor === Array) {\n            for (const child of element.children) {\n                this.add(child as any);\n            }\n        }\n    }\n\n    remove(element: E): void {\n        this.id2element.delete(element.id);\n        if (element.children !== undefined && element.children.constructor === Array) {\n            for (const child of element.children) {\n                this.remove(child as any);\n            }\n        }\n    }\n\n    contains(element: E): boolean {\n        return this.id2element.has(element.id);\n    }\n\n    getById(id: string): E | undefined {\n        return this.id2element.get(id);\n    }\n\n    getAttachedElements(element: E): FluentIterable<E> {\n        return [];\n    }\n\n    all(): FluentIterable<E> {\n        return mapIterable(this.id2element, ([key, value]: [string, E]) => value);\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nexport const TYPES = {\n    IActionDispatcher: Symbol('IActionDispatcher'),\n    IActionDispatcherProvider: Symbol('IActionDispatcherProvider'),\n    IActionHandlerInitializer: Symbol('IActionHandlerInitializer'),\n    ActionHandlerRegistry: Symbol('ActionHandlerRegistry'),\n    AnimationFrameSyncer: Symbol('AnimationFrameSyncer'),\n    CommandStackOptions: Symbol('CommandStackOptions'),\n    IButtonHandler: Symbol('IButtonHandler'),\n    ICommand: Symbol('ICommand'),\n    ICommandStack: Symbol('ICommandStack'),\n    ICommandStackProvider: Symbol('ICommandStackProvider'),\n    DOMHelper: Symbol('DOMHelper'),\n    HiddenVNodeDecorator: Symbol('HiddenVNodeDecorator'),\n    HoverState: Symbol('HoverState'),\n    KeyListener: Symbol('KeyListener'),\n    Layouter: Symbol('Layouter'),\n    LayoutRegistry: Symbol('LayoutRegistry'),\n    ILogger: Symbol('ILogger'),\n    LogLevel: Symbol('LogLevel'),\n    IModelFactory: Symbol('IModelFactory'),\n    IModelLayoutEngine: Symbol('IModelLayoutEngine'),\n    ModelRendererFactory: Symbol('ModelRendererFactory'),\n    ModelSource: Symbol('ModelSource'),\n    ModelSourceProvider: Symbol('ModelSourceProvider'),\n    MouseListener: Symbol('MouseListener'),\n    /**\n     * @deprecated Use IPopupModelProvider instead.\n     */\n    PopupModelFactory: Symbol('PopupModelFactory'),\n    IPopupModelProvider: Symbol('IPopupModelProvider'),\n    PopupMouseListener: Symbol('PopupMouseListener'),\n    PopupVNodeDecorator: Symbol('PopupVNodeDecorator'),\n    SModelElementRegistration: Symbol('SModelElementRegistration'),\n    SModelRegistry: Symbol('SModelRegistry'),\n    SModelStorage: Symbol('SModelStorage'),\n    StateAwareModelProvider: Symbol('StateAwareModelProvider'),\n    SvgExporter: Symbol('SvgExporter'),\n    IViewer: Symbol('IViewer'),\n    ViewerOptions: Symbol('ViewerOptions'),\n    IViewerProvider: Symbol('IViewerProvider'),\n    ViewRegistration: Symbol('ViewRegistration'),\n    ViewRegistry: Symbol('ViewRegistry'),\n    IVNodeDecorator: Symbol('IVNodeDecorator')\n};\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable } from \"inversify\";\nimport { ViewerOptions } from \"./viewer-options\";\nimport { TYPES } from \"../types\";\nimport { SModelElement } from \"../model/smodel\";\n\n@injectable()\nexport class DOMHelper {\n\n    constructor(@inject(TYPES.ViewerOptions) private viewerOptions: ViewerOptions) {\n\n    }\n\n    private getPrefix() {\n        const prefix = this.viewerOptions !== undefined && this.viewerOptions.baseDiv !== undefined ?\n            this.viewerOptions.baseDiv + \"_\" : \"\";\n        return prefix;\n    }\n\n    createUniqueDOMElementId(element: SModelElement): string {\n        return this.getPrefix() + element.id;\n    }\n\n    findSModelIdByDOMElement(element: Element): string {\n        return element.id.replace(this.getPrefix(), '');\n    }\n\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable } from \"inversify\";\nimport { VNode } from \"snabbdom/vnode\";\nimport { TYPES } from \"../types\";\nimport { ILogger } from \"../../utils/logging\";\nimport { SModelElement } from \"../model/smodel\";\nimport { IVNodeDecorator } from \"./vnode-decorators\";\nimport { DOMHelper } from \"./dom-helper\";\nimport { getAttrs } from \"./vnode-utils\";\n\n@injectable()\nexport class IdDecorator implements IVNodeDecorator {\n\n    constructor(@inject(TYPES.ILogger) protected logger: ILogger,\n                @inject(TYPES.DOMHelper) protected domHelper: DOMHelper) {\n    }\n\n    decorate(vnode: VNode, element: SModelElement): VNode {\n        const attrs = getAttrs(vnode);\n        if (attrs.id !== undefined)\n            this.logger.warn(vnode, 'Overriding id of vnode (' + attrs.id + '). Make sure not to set it manually in view.');\n        attrs.id = this.domHelper.createUniqueDOMElementId(element);\n        if (!vnode.key)\n            vnode.key = element.id;\n        return vnode;\n    }\n\n    postUpdate(): void {\n    }\n\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable, multiInject, optional } from \"inversify\";\nimport { VNode } from \"snabbdom/vnode\";\nimport { TYPES } from \"../types\";\nimport { IActionDispatcher } from \"../actions/action-dispatcher\";\nimport { SModelElement, SModelRoot } from \"../model/smodel\";\nimport { Action } from \"../actions/action\";\nimport { IVNodeDecorator } from \"./vnode-decorators\";\nimport { on } from \"./vnode-utils\";\n\n@injectable()\nexport class KeyTool implements IVNodeDecorator {\n\n    constructor(@inject(TYPES.IActionDispatcher) protected actionDispatcher: IActionDispatcher,\n                @multiInject(TYPES.KeyListener)@optional() protected keyListeners: KeyListener[] = []) {}\n\n    register(keyListener: KeyListener) {\n        this.keyListeners.push(keyListener);\n    }\n\n    deregister(keyListener: KeyListener) {\n        const index = this.keyListeners.indexOf(keyListener);\n        if (index >= 0)\n            this.keyListeners.splice(index, 1);\n    }\n\n    protected handleEvent<K extends keyof KeyListener>(methodName: K, model: SModelRoot, event: KeyboardEvent) {\n        const actions = this.keyListeners\n            .map(listener => listener[methodName].apply(listener, [model, event]))\n            .reduce((a, b) => a.concat(b));\n        if (actions.length > 0) {\n            event.preventDefault();\n            this.actionDispatcher.dispatchAll(actions);\n        }\n    }\n\n    keyDown(element: SModelRoot, event: KeyboardEvent): void {\n        this.handleEvent('keyDown', element, event);\n    }\n\n    focus() {}\n\n    decorate(vnode: VNode, element: SModelElement): VNode {\n        if (element instanceof SModelRoot) {\n            on(vnode, 'focus', this.focus.bind(this), element);\n            on(vnode, 'keydown', this.keyDown.bind(this), element);\n        }\n        return vnode;\n    }\n\n    postUpdate() {\n    }\n}\n\n@injectable()\nexport class KeyListener {\n    keyDown(element: SModelElement, event: KeyboardEvent): Action[] {\n        return [];\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable, multiInject, optional } from \"inversify\";\nimport { VNode } from \"snabbdom/vnode\";\nimport { TYPES } from \"../types\";\nimport { IActionDispatcher } from \"../actions/action-dispatcher\";\nimport { SModelElement, SModelRoot } from \"../model/smodel\";\nimport { Action, isAction } from \"../actions/action\";\nimport { IVNodeDecorator } from \"./vnode-decorators\";\nimport { on } from \"./vnode-utils\";\nimport { DOMHelper } from \"./dom-helper\";\n\n@injectable()\nexport class MouseTool implements IVNodeDecorator {\n\n    constructor(@inject(TYPES.IActionDispatcher) protected actionDispatcher: IActionDispatcher,\n                @inject(TYPES.DOMHelper) protected domHelper: DOMHelper,\n                @multiInject(TYPES.MouseListener)@optional() protected mouseListeners: MouseListener[] = []) {}\n\n    register(mouseListener: MouseListener) {\n        this.mouseListeners.push(mouseListener);\n    }\n\n    deregister(mouseListener: MouseListener) {\n        const index = this.mouseListeners.indexOf(mouseListener);\n        if (index >= 0)\n            this.mouseListeners.splice(index, 1);\n    }\n\n    protected getTargetElement(model: SModelRoot, event: MouseEvent): SModelElement |undefined {\n        let target = event.target as Element;\n        const index = model.index;\n        while (target) {\n            if (target.id) {\n                const element = index.getById(this.domHelper.findSModelIdByDOMElement(target));\n                if (element !== undefined)\n                    return element;\n            }\n            target = target.parentNode as Element;\n        }\n        return undefined;\n    }\n\n    protected handleEvent<K extends keyof MouseListener>(methodName: K, model: SModelRoot, event: MouseEvent) {\n        this.focusOnMouseEvent(methodName, model);\n        const element = this.getTargetElement(model, event);\n        if (!element)\n            return;\n        const actions = this.mouseListeners\n            .map(listener => listener[methodName].apply(listener, [element, event]))\n            .reduce((a, b) => a.concat(b));\n        if (actions.length > 0) {\n            event.preventDefault();\n            for (const actionOrPromise of actions) {\n                if (isAction(actionOrPromise)) {\n                    this.actionDispatcher.dispatch(actionOrPromise);\n                } else {\n                    actionOrPromise.then((action: Action) => {\n                        this.actionDispatcher.dispatch(action);\n                    });\n                }\n            }\n        }\n    }\n\n    protected focusOnMouseEvent<K extends keyof MouseListener>(methodName: K, model: SModelRoot) {\n        if (document) {\n            const domElement = document.getElementById(this.domHelper.createUniqueDOMElementId(model));\n            if (methodName === 'mouseDown' && domElement !== null && typeof domElement.focus === 'function')\n                domElement.focus();\n        }\n    }\n\n    mouseOver(model: SModelRoot, event: MouseEvent) {\n        this.handleEvent('mouseOver', model, event);\n    }\n\n    mouseOut(model: SModelRoot, event: MouseEvent) {\n        this.handleEvent('mouseOut', model, event);\n    }\n\n    mouseEnter(model: SModelRoot, event: MouseEvent) {\n        this.handleEvent('mouseEnter', model, event);\n    }\n\n    mouseLeave(model: SModelRoot, event: MouseEvent) {\n        this.handleEvent('mouseLeave', model, event);\n    }\n\n    mouseDown(model: SModelRoot, event: MouseEvent) {\n        this.handleEvent('mouseDown', model, event);\n    }\n\n    mouseMove(model: SModelRoot, event: MouseEvent) {\n        this.handleEvent('mouseMove', model, event);\n    }\n\n    mouseUp(model: SModelRoot, event: MouseEvent) {\n        this.handleEvent('mouseUp', model, event);\n    }\n\n    wheel(model: SModelRoot, event: WheelEvent) {\n        this.handleEvent('wheel', model, event);\n    }\n\n    doubleClick(model: SModelRoot, event: WheelEvent) {\n        this.handleEvent('doubleClick', model, event);\n    }\n\n    decorate(vnode: VNode, element: SModelElement) {\n        if (element instanceof SModelRoot) {\n            on(vnode, 'mouseover', this.mouseOver.bind(this), element);\n            on(vnode, 'mouseout', this.mouseOut.bind(this), element);\n            on(vnode, 'mouseenter', this.mouseEnter.bind(this), element);\n            on(vnode, 'mouseleave', this.mouseLeave.bind(this), element);\n            on(vnode, 'mousedown', this.mouseDown.bind(this), element);\n            on(vnode, 'mouseup', this.mouseUp.bind(this), element);\n            on(vnode, 'mousemove', this.mouseMove.bind(this), element);\n            on(vnode, 'wheel', this.wheel.bind(this), element);\n            on(vnode, 'contextmenu', (target: SModelElement, event: any) => {\n                event.preventDefault();\n            }, element);\n            on(vnode, 'dblclick', this.doubleClick.bind(this), element);\n        }\n        vnode = this.mouseListeners.reduce(\n            (n: VNode, listener: MouseListener) => listener.decorate(n, element),\n            vnode);\n        return vnode;\n    }\n\n    postUpdate() {\n    }\n}\n\n@injectable()\nexport class PopupMouseTool extends MouseTool {\n    constructor(@inject(TYPES.IActionDispatcher) protected actionDispatcher: IActionDispatcher,\n                @inject(TYPES.DOMHelper) protected domHelper: DOMHelper,\n                @multiInject(TYPES.PopupMouseListener)@optional() protected mouseListeners: MouseListener[] = []) {\n        super(actionDispatcher, domHelper, mouseListeners);\n    }\n}\n\n@injectable()\nexport class MouseListener {\n\n    mouseOver(target: SModelElement, event: MouseEvent): (Action | Promise<Action>)[] {\n        return [];\n    }\n\n    mouseOut(target: SModelElement, event: MouseEvent): (Action | Promise<Action>)[] {\n        return [];\n    }\n\n    mouseEnter(target: SModelElement, event: MouseEvent): (Action | Promise<Action>)[] {\n        return [];\n    }\n\n    mouseLeave(target: SModelElement, event: MouseEvent): (Action | Promise<Action>)[] {\n        return [];\n    }\n\n    mouseDown(target: SModelElement, event: MouseEvent): (Action | Promise<Action>)[] {\n        return [];\n    }\n\n    mouseMove(target: SModelElement, event: MouseEvent): (Action | Promise<Action>)[] {\n        return [];\n    }\n\n    mouseUp(target: SModelElement, event: MouseEvent): (Action | Promise<Action>)[] {\n        return [];\n    }\n\n    wheel(target: SModelElement, event: WheelEvent): (Action | Promise<Action>)[] {\n        return [];\n    }\n\n    doubleClick(target: SModelElement, event: WheelEvent): (Action | Promise<Action>)[] {\n        return [];\n    }\n\n    decorate(vnode: VNode, element: SModelElement): VNode {\n        return vnode;\n    }\n}\n\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { h } from \"snabbdom\";\nimport { VNode, VNodeData } from \"snabbdom/vnode\";\nimport { SModelElement } from \"../model/smodel\";\nimport { RenderingContext, IView } from \"./view\";\n\n/**\n * An view that avoids calculation and patching of VNodes unless some model properties have changed.\n * Based on snabbdom's thunks.\n */\nexport abstract class ThunkView implements IView {\n\n    /**\n     * Returns the array of values that are watched for changes.\n     * If they haven't change since the last rendering, the VNode is neither recalculated nor patched.\n     */\n    abstract watchedArgs(model: SModelElement): any[];\n\n    /**\n     * Returns the selector of the VNode root, i.e. it's element type.\n     */\n    abstract selector(model: SModelElement): string;\n\n    /**\n     * Calculate the VNode from the input data. Only called if the watched properties change.\n     */\n    abstract doRender(model: SModelElement, context: RenderingContext): VNode;\n\n    render(model: SModelElement, context: RenderingContext): VNode {\n        return h(this.selector(model), {\n            key: model.id,\n            hook: {\n                init: this.init.bind(this),\n                prepatch: this.prepatch.bind(this)},\n            fn: () => this.renderAndDecorate(model, context),\n            args: this.watchedArgs(model),\n            thunk: true\n        });\n    }\n\n    protected renderAndDecorate(model: SModelElement, context: RenderingContext): VNode {\n        const vnode = this.doRender(model, context);\n        context.decorate(vnode, model);\n        return vnode;\n    }\n\n    protected copyToThunk(vnode: VNode, thunk: VNode): void {\n        thunk.elm = vnode.elm;\n        (vnode.data as VNodeData).fn = (thunk.data as VNodeData).fn;\n        (vnode.data as VNodeData).args = (thunk.data as VNodeData).args;\n        thunk.data = vnode.data;\n        thunk.children = vnode.children;\n        thunk.text = vnode.text;\n        thunk.elm = vnode.elm;\n    }\n\n    protected init(thunk: VNode): void {\n        const cur = thunk.data as VNodeData;\n        const vnode = (cur.fn as any).apply(undefined, cur.args);\n        this.copyToThunk(vnode, thunk);\n    }\n\n    protected prepatch(oldVnode: VNode, thunk: VNode): void {\n        const old = oldVnode.data as VNodeData, cur = thunk.data as VNodeData;\n        if (!this.equals(old.args as any[], cur.args as any[]))\n            this.copyToThunk((cur.fn as any).apply(undefined, cur.args), thunk);\n        else\n            this.copyToThunk(oldVnode, thunk);\n    }\n\n    protected equals(oldArg: any, newArg: any) {\n        if (Array.isArray(oldArg) && Array.isArray(newArg)) {\n            if (oldArg.length !== newArg.length)\n                return false;\n            for (let i = 0; i < newArg.length; ++i) {\n                if (!this.equals(oldArg[i], newArg[i]))\n                    return false;\n            }\n        } else if (typeof oldArg === 'object' && typeof newArg === 'object') {\n            if (Object.keys(oldArg).length !== Object.keys(newArg).length)\n                return false;\n            for (const key in oldArg) {\n                if (key !== 'parent' && key !== 'root' && (!(key in newArg) || !this.equals(oldArg[key], newArg[key])))\n                    return false;\n            }\n        } else if (oldArg !== newArg) {\n            return false;\n        }\n        return true;\n    }\n}\n\nexport interface ThunkVNode extends VNode {\n    thunk: boolean\n}\n\nexport function isThunk(vnode: VNode): vnode is ThunkVNode {\n    return 'thunk' in vnode;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/** @jsx svg */\nimport { svg } from 'snabbdom-jsx';\n\nimport { injectable, multiInject, optional, interfaces } from \"inversify\";\nimport { VNode } from \"snabbdom/vnode\";\nimport { TYPES } from \"../types\";\nimport { SModelElement, SModelRoot, SParentElement } from \"../model/smodel\";\nimport { EMPTY_ROOT, SModelElementRegistration } from \"../model/smodel-factory\";\nimport { ProviderRegistry } from \"../../utils/registry\";\nimport { Point, ORIGIN_POINT } from \"../../utils/geometry\";\n\n/**\n * Base interface for the components that turn GModelElements into virtual DOM elements.\n */\nexport interface IView {\n    render(model: Readonly<SModelElement>, context: RenderingContext, args?: object): VNode\n}\n\n/**\n * Bundles additional data that is passed to views for VNode creation.\n */\nexport interface RenderingContext {\n    viewRegistry: ViewRegistry\n\n    decorate(vnode: VNode, element: Readonly<SModelElement>): VNode\n\n    renderElement(element: Readonly<SModelElement>, args?: object): VNode\n\n    renderChildren(element: Readonly<SParentElement>, args?: object): VNode[]\n}\n\n/**\n * Used to bind a model element type to a view constructor in the ViewRegistry.\n */\nexport interface ViewRegistration {\n    type: string\n    constr: new () => IView\n}\n\n/**\n * Allows to look up the IView for a given SModelElement based on its type.\n */\n@injectable()\nexport class ViewRegistry extends ProviderRegistry<IView, void> {\n    constructor(@multiInject(TYPES.ViewRegistration) @optional() registrations: ViewRegistration[]) {\n        super();\n\n        this.registerDefaults();\n        registrations.forEach(\n            registration => this.register(registration.type, registration.constr)\n        );\n    }\n\n    protected registerDefaults() {\n        this.register(EMPTY_ROOT.type, EmptyView);\n    }\n\n    missing(key: string): IView {\n        return new MissingView();\n    }\n}\n\n/**\n * Utility function to register model and view constructors for a model element type.\n */\nexport function configureModelElement(context: { bind: interfaces.Bind }, type: string,\n        modelConstr: new () => SModelElement, viewConstr: new () => IView): void {\n    context.bind<SModelElementRegistration>(TYPES.SModelElementRegistration).toConstantValue({\n        type,\n        constr: modelConstr\n    });\n    context.bind<ViewRegistration>(TYPES.ViewRegistration).toConstantValue({\n        type,\n        constr: viewConstr\n    });\n}\n\n/**\n * This view is used when the model is the EMPTY_ROOT.\n */\nexport class EmptyView implements IView {\n    render(model: SModelRoot, context: RenderingContext): VNode {\n        return <svg class-sprotty-empty={true} />;\n    }\n}\n\n/**\n * This view is used when no view has been registered for a model element type.\n */\nexport class MissingView implements IView {\n    render(model: Readonly<SModelElement>, context: RenderingContext): VNode {\n        const position: Point = (model as any).position || ORIGIN_POINT;\n        return <text class-sprotty-missing={true} x={position.x} y={position.y}>?{model.id}?</text>;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable, named } from \"inversify\";\nimport { SModelRoot } from \"../model/smodel\";\nimport { TYPES } from \"../types\";\nimport { AnimationFrameSyncer } from \"../animations/animation-frame-syncer\";\nimport { IViewer } from \"./viewer\";\n\n/**\n * Updating the view is rather expensive, and it doesn't make sense to calculate\n * more then one update per animation (rendering) frame. So this class batches\n * all incoming model changes and only renders the last one when the next animation\n * frame comes.\n */\n@injectable()\nexport class ViewerCache implements IViewer {\n    constructor(@inject(TYPES.IViewer) @named('delegate') protected delegate: IViewer,\n                @inject(TYPES.AnimationFrameSyncer) protected syncer: AnimationFrameSyncer) {\n    }\n\n    cachedModelRoot: SModelRoot | undefined;\n    cachedHiddenModelRoot: SModelRoot | undefined;\n    cachedPopup: SModelRoot | undefined;\n\n    protected isCacheEmpty(): boolean {\n        return this.cachedModelRoot === undefined && this.cachedHiddenModelRoot === undefined &&\n            this.cachedPopup === undefined;\n    }\n\n    updatePopup(model: SModelRoot): void {\n        const isCacheEmpty = this.isCacheEmpty();\n        this.cachedPopup = model;\n        if (isCacheEmpty)\n            this.scheduleUpdate();\n    }\n\n    update(model: SModelRoot): void {\n        const isCacheEmpty = this.isCacheEmpty();\n        this.cachedModelRoot = model;\n        if (isCacheEmpty)\n            this.scheduleUpdate();\n    }\n\n    updateHidden(hiddenModel: SModelRoot): void {\n        const isCacheEmpty = this.isCacheEmpty();\n        this.cachedHiddenModelRoot = hiddenModel;\n        if (isCacheEmpty)\n            this.scheduleUpdate();\n    }\n\n    protected scheduleUpdate() {\n        this.syncer.onEndOfNextFrame(() => {\n            if (this.cachedHiddenModelRoot) {\n                const nextHiddenModelRoot = this.cachedHiddenModelRoot;\n                this.delegate.updateHidden(nextHiddenModelRoot);\n                this.cachedHiddenModelRoot = undefined;\n            }\n            if (this.cachedModelRoot) {\n                const nextModelRoot = this.cachedModelRoot;\n                this.delegate.update(nextModelRoot);\n                this.cachedModelRoot = undefined;\n            }\n            if (this.cachedPopup) {\n                const nextModelRoot = this.cachedPopup;\n                this.delegate.updatePopup(nextModelRoot);\n                this.cachedPopup = undefined;\n            }\n        });\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Container, interfaces } from \"inversify\";\nimport { TYPES } from \"../types\";\n\nexport interface ViewerOptions {\n    baseDiv: string\n    baseClass: string\n    hiddenDiv: string\n    hiddenClass: string\n    popupDiv: string\n    popupClass: string\n    popupClosedClass: string\n    needsClientLayout: boolean\n    needsServerLayout: boolean\n    popupOpenDelay: number\n    popupCloseDelay: number\n}\n\nexport const defaultViewerOptions = () => (<ViewerOptions>{\n    baseDiv: 'sprotty',\n    baseClass: 'sprotty',\n    hiddenDiv: 'sprotty-hidden',\n    hiddenClass: 'sprotty-hidden',\n    popupDiv: 'sprotty-popup',\n    popupClass: 'sprotty-popup',\n    popupClosedClass: 'sprotty-popup-closed',\n    needsClientLayout: true,\n    needsServerLayout: false,\n    popupOpenDelay: 1000,\n    popupCloseDelay: 300\n});\n\n/**\n * Utility function to partially set viewer options. Default values (from `defaultViewerOptions`) are used for\n * options that are not specified.\n */\nexport function configureViewerOptions(context: { bind: interfaces.Bind, isBound: interfaces.IsBound, rebind: interfaces.Rebind },\n        options: Partial<ViewerOptions>): void {\n    const opt: ViewerOptions = {\n        ...defaultViewerOptions(),\n        ...options\n    };\n    if (context.isBound(TYPES.ViewerOptions))\n        context.rebind(TYPES.ViewerOptions).toConstantValue(opt);\n    else\n        context.bind(TYPES.ViewerOptions).toConstantValue(opt);\n}\n\n/**\n * Utility function to partially override the currently configured viewer options in a DI container.\n */\nexport function overrideViewerOptions(container: Container, options: Partial<ViewerOptions>): ViewerOptions {\n    const opt = container.get<ViewerOptions>(TYPES.ViewerOptions);\n    for (const p in options) {\n        if (options.hasOwnProperty(p))\n            (opt as any)[p] = (options as any)[p];\n    }\n    return opt;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/** @jsx html */\nimport { html } from 'snabbdom-jsx'; // must be html here, as we're creating a div\n\nimport { init } from \"snabbdom\";\nimport { VNode } from \"snabbdom/vnode\";\nimport { Module } from \"snabbdom/modules/module\";\nimport { propsModule } from \"snabbdom/modules/props\";\nimport { attributesModule } from \"snabbdom/modules/attributes\";\nimport { styleModule } from \"snabbdom/modules/style\";\nimport { eventListenersModule } from \"snabbdom/modules/eventlisteners\";\nimport { classModule } from \"snabbdom/modules/class\";\nimport { inject, injectable, multiInject, optional } from \"inversify\";\nimport { TYPES } from \"../types\";\nimport { ILogger } from \"../../utils/logging\";\nimport { ORIGIN_POINT } from \"../../utils/geometry\";\nimport { SModelElement, SModelRoot, SParentElement } from \"../model/smodel\";\nimport { IActionDispatcher } from \"../actions/action-dispatcher\";\nimport { InitializeCanvasBoundsAction } from \"../features/initialize-canvas\";\nimport { IVNodeDecorator } from \"./vnode-decorators\";\nimport { RenderingContext, ViewRegistry } from \"./view\";\nimport { setClass, setAttr, copyClassesFromElement, copyClassesFromVNode } from \"./vnode-utils\";\nimport { ViewerOptions } from \"./viewer-options\";\nimport { isThunk } from \"./thunk-view\";\nimport { EMPTY_ROOT } from \"../model/smodel-factory\";\n\nexport interface IViewer {\n    update(model: SModelRoot): void\n    updateHidden(hiddenModel: SModelRoot): void\n    updatePopup(popupModel: SModelRoot): void\n}\n\nexport class ModelRenderer implements RenderingContext {\n\n    constructor(public viewRegistry: ViewRegistry,\n                private decorators: IVNodeDecorator[]) {\n    }\n\n    decorate(vnode: VNode, element: Readonly<SModelElement>): VNode {\n        if (isThunk(vnode))\n            return vnode;\n        return this.decorators.reduce(\n            (n: VNode, decorator: IVNodeDecorator) => decorator.decorate(n, element),\n            vnode);\n    }\n\n    renderElement(element: Readonly<SModelElement>, args?: object): VNode {\n        const vNode = this.viewRegistry.get(element.type, undefined).render(element, this, args);\n        return this.decorate(vNode, element);\n    }\n\n    renderChildren(element: Readonly<SParentElement>, args?: object): VNode[] {\n        return element.children.map((child) => this.renderElement(child, args));\n    }\n\n    postUpdate() {\n        this.decorators.forEach(decorator => decorator.postUpdate());\n    }\n}\n\nexport type ModelRendererFactory = (decorators: IVNodeDecorator[]) => ModelRenderer;\n\n/**\n * The component that turns the model into an SVG DOM.\n * Uses a VDOM based on snabbdom.js for performance.\n */\n@injectable()\nexport class Viewer implements IViewer {\n\n    protected renderer: ModelRenderer;\n    protected hiddenRenderer: ModelRenderer;\n    protected popupRenderer: ModelRenderer;\n\n    protected readonly patcher: Patcher;\n\n    protected lastVDOM: VNode;\n    protected lastHiddenVDOM: VNode;\n    protected lastPopupVDOM: VNode;\n\n    constructor(@inject(TYPES.ModelRendererFactory) modelRendererFactory: ModelRendererFactory,\n                @multiInject(TYPES.IVNodeDecorator) @optional() protected decorators: IVNodeDecorator[],\n                @multiInject(TYPES.HiddenVNodeDecorator) @optional() protected hiddenDecorators: IVNodeDecorator[],\n                @multiInject(TYPES.PopupVNodeDecorator) @optional() protected popupDecorators: IVNodeDecorator[],\n                @inject(TYPES.ViewerOptions) protected options: ViewerOptions,\n                @inject(TYPES.ILogger) protected logger: ILogger,\n                @inject(TYPES.IActionDispatcher) protected actiondispatcher: IActionDispatcher) {\n        this.patcher = this.createPatcher();\n        this.renderer = modelRendererFactory(decorators);\n        this.hiddenRenderer = modelRendererFactory(hiddenDecorators);\n        this.popupRenderer = modelRendererFactory(popupDecorators);\n    }\n\n    protected createModules(): Module[] {\n        return [\n            propsModule,\n            attributesModule,\n            classModule,\n            styleModule,\n            eventListenersModule\n        ];\n    }\n\n    protected createPatcher() {\n        return init(this.createModules());\n    }\n\n    protected onWindowResize = (vdom: VNode): void => {\n        const baseDiv = document.getElementById(this.options.baseDiv);\n        if (baseDiv !== null) {\n            const newBounds = this.getBoundsInPage(baseDiv as Element);\n            this.actiondispatcher.dispatch(new InitializeCanvasBoundsAction(newBounds));\n        }\n    }\n\n    protected getBoundsInPage(element: Element) {\n        const bounds = element.getBoundingClientRect();\n        const scroll = typeof window !== 'undefined' ? {x: window.scrollX, y: window.scrollY} : ORIGIN_POINT;\n        return {\n            x: bounds.left + scroll.x,\n            y: bounds.top + scroll.y,\n            width: bounds.width,\n            height: bounds.height\n        };\n    }\n\n    update(model: Readonly<SModelRoot>): void {\n        this.logger.log(this, 'rendering', model);\n        const newVDOM = <div id={this.options.baseDiv}>\n            {this.renderer.renderElement(model)}\n        </div>;\n        if (this.lastVDOM !== undefined) {\n            const hadFocus = this.hasFocus();\n            copyClassesFromVNode(this.lastVDOM, newVDOM);\n            this.lastVDOM = this.patcher.call(this, this.lastVDOM, newVDOM);\n            this.restoreFocus(hadFocus);\n        } else if (typeof document !== 'undefined') {\n            const placeholder = document.getElementById(this.options.baseDiv);\n            if (placeholder !== null) {\n                if (typeof window !== 'undefined') {\n                    window.addEventListener('resize', () => {\n                        this.onWindowResize(newVDOM);\n                    });\n                }\n                copyClassesFromElement(placeholder, newVDOM);\n                setClass(newVDOM, this.options.baseClass, true);\n                this.lastVDOM = this.patcher.call(this, placeholder, newVDOM);\n            } else {\n                this.logger.error(this, 'element not in DOM:', this.options.baseDiv);\n            }\n        }\n        this.renderer.postUpdate();\n    }\n\n    protected hasFocus(): boolean {\n        if (typeof document !== 'undefined' && document.activeElement && this.lastVDOM.children && this.lastVDOM.children.length > 0) {\n            const lastRootVNode = this.lastVDOM.children[0];\n            if (typeof lastRootVNode === 'object') {\n                const lastElement = (lastRootVNode as VNode).elm;\n                return document.activeElement === lastElement;\n            }\n        }\n        return false;\n    }\n\n    protected restoreFocus(focus: boolean) {\n        if (focus && this.lastVDOM.children && this.lastVDOM.children.length > 0) {\n            const lastRootVNode = this.lastVDOM.children[0];\n            if (typeof lastRootVNode === 'object') {\n                const lastElement = (lastRootVNode as VNode).elm;\n                if (lastElement && typeof (lastElement as any).focus === 'function')\n                    (lastElement as any).focus();\n            }\n        }\n    }\n\n    updateHidden(hiddenModel: Readonly<SModelRoot>): void {\n        this.logger.log(this, 'rendering hidden');\n\n        let newVDOM: VNode;\n        if (hiddenModel.type === EMPTY_ROOT.type) {\n            newVDOM = <div id={this.options.hiddenDiv}></div>;\n        } else {\n            const hiddenVNode = this.hiddenRenderer.renderElement(hiddenModel);\n            setAttr(hiddenVNode, 'opacity', 0);\n            newVDOM = <div id={this.options.hiddenDiv}>\n                {hiddenVNode}\n            </div>;\n        }\n\n        if (this.lastHiddenVDOM !== undefined) {\n            copyClassesFromVNode(this.lastHiddenVDOM, newVDOM);\n            this.lastHiddenVDOM = this.patcher.call(this, this.lastHiddenVDOM, newVDOM);\n        } else {\n            let placeholder = document.getElementById(this.options.hiddenDiv);\n            if (placeholder === null) {\n                placeholder = document.createElement(\"div\");\n                document.body.appendChild(placeholder);\n            } else {\n                copyClassesFromElement(placeholder, newVDOM);\n            }\n            setClass(newVDOM, this.options.baseClass, true);\n            setClass(newVDOM, this.options.hiddenClass, true);\n            this.lastHiddenVDOM = this.patcher.call(this, placeholder, newVDOM);\n        }\n        this.hiddenRenderer.postUpdate();\n    }\n\n    updatePopup(model: Readonly<SModelRoot>): void {\n        this.logger.log(this, 'rendering popup', model);\n\n        const popupClosed = model.type === EMPTY_ROOT.type;\n        let newVDOM: VNode;\n        if (popupClosed) {\n            newVDOM = <div id={this.options.popupDiv}></div>;\n        } else {\n            const position = model.canvasBounds;\n            const inlineStyle = {\n                top: position.y + 'px',\n                left: position.x + 'px'\n            };\n            newVDOM = <div id={this.options.popupDiv} style={inlineStyle}>\n                {this.popupRenderer.renderElement(model)}\n            </div>;\n        }\n\n        if (this.lastPopupVDOM !== undefined) {\n            copyClassesFromVNode(this.lastPopupVDOM, newVDOM);\n            setClass(newVDOM, this.options.popupClosedClass, popupClosed);\n            this.lastPopupVDOM = this.patcher.call(this, this.lastPopupVDOM, newVDOM);\n        } else if (typeof document !== 'undefined') {\n            let placeholder = document.getElementById(this.options.popupDiv);\n            if (placeholder === null) {\n                placeholder = document.createElement(\"div\");\n                document.body.appendChild(placeholder);\n            } else {\n                copyClassesFromElement(placeholder, newVDOM);\n            }\n            setClass(newVDOM, this.options.popupClass, true);\n            setClass(newVDOM, this.options.popupClosedClass, popupClosed);\n            this.lastPopupVDOM = this.patcher.call(this, placeholder, newVDOM);\n        }\n        this.popupRenderer.postUpdate();\n    }\n}\n\nexport type Patcher = (oldRoot: VNode | Element, newRoot: VNode) => VNode;\n\nexport type IViewerProvider = () => Promise<Viewer>;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable } from \"inversify\";\nimport { VNode } from \"snabbdom/vnode\";\nimport { SModelElement } from \"../model/smodel\";\nimport { setAttr } from \"./vnode-utils\";\n\n/**\n * Manipulates a created VNode after it has been created.\n * Used to register listeners and add animations.\n */\nexport interface IVNodeDecorator {\n    decorate(vnode: VNode, element: SModelElement): VNode\n\n    postUpdate(): void\n}\n\n@injectable()\nexport class FocusFixDecorator implements IVNodeDecorator {\n\n    static tabIndex: number = 1000;\n\n    decorate(vnode: VNode, element: SModelElement): VNode {\n        if (vnode.sel && vnode.sel.startsWith('svg'))\n            // allows to set focus in Firefox\n            setAttr(vnode, 'tabindex', ++FocusFixDecorator.tabIndex);\n        return vnode;\n    }\n\n    postUpdate(): void {\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { VNode } from \"snabbdom/vnode\";\nimport { SModelElement } from \"../model/smodel\";\n\nexport function setAttr(vnode: VNode, name: string, value: any) {\n    getAttrs(vnode)[name] = value;\n}\n\nexport function setClass(vnode: VNode, name: string, value: boolean) {\n    getClass(vnode)[name] = value;\n}\n\nexport function copyClassesFromVNode(source: VNode, target: VNode) {\n    const classList = getClass(source);\n    for (const c in classList) {\n        if (classList.hasOwnProperty(c))\n            setClass(target, c, true);\n    }\n}\n\nexport function copyClassesFromElement(element: HTMLElement, target: VNode) {\n    const classList = element.classList;\n    for (let i = 0; i < classList.length; i++) {\n        const item = classList.item(i);\n        if (item)\n            setClass(target, item, true);\n    }\n}\n\nexport function mergeStyle(vnode: VNode, style: any) {\n    getData(vnode).style = {...(getData(vnode).style || {}), ...style};\n}\n\nexport function on(vnode: VNode, event: string, listener: (model: SModelElement, event: Event) => void, element: SModelElement) {\n    const val = getOn(vnode);\n    if (val[event]) {\n        throw new Error('EventListener for ' + event + ' already registered on VNode');\n    }\n    (val as any)[event] = [listener, element];\n}\n\nexport function getAttrs(vnode: VNode) {\n    const data = getData(vnode);\n    if (!data.attrs)\n        data.attrs = {};\n    return data.attrs;\n}\n\nfunction getData(vnode: VNode) {\n    if (!vnode.data)\n        vnode.data = {};\n    return vnode.data;\n}\n\nfunction getClass(vnode: VNode) {\n    const data = getData(vnode);\n    if (!data.class)\n        data.class = {};\n    return data.class;\n}\n\nfunction getOn(vnode: VNode) {\n    const data = getData(vnode);\n    if (!data.on)\n        data.on = {};\n    return data.on;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Bounds, EMPTY_BOUNDS, isValidDimension, Dimension, Point } from \"../../utils/geometry\";\nimport { SParentElement, SModelElement, SChildElement } from \"../../base/model/smodel\";\nimport { isLayoutContainer, isLayoutableChild, LayoutContainer, isBoundsAware } from \"./model\";\nimport { ILayout, StatefulLayouter } from './layout';\nimport { AbstractLayoutOptions, HAlignment, VAlignment } from './layout-options';\nimport { BoundsData } from './hidden-bounds-updater';\n\nexport abstract class AbstractLayout<T extends AbstractLayoutOptions & Object> implements ILayout {\n\n    layout(container: SParentElement & LayoutContainer,\n           layouter: StatefulLayouter) {\n        const boundsData = layouter.getBoundsData(container);\n        const options = this.getLayoutOptions(container);\n        const childrenSize = this.getChildrenSize(container, options, layouter);\n        const maxWidth = options.paddingFactor * (\n            options.resizeContainer\n            ? childrenSize.width\n            : Math.max(0, this.getFixedContainerBounds(container, options, layouter).width) - options.paddingLeft - options.paddingRight);\n        const maxHeight =  options.paddingFactor * (\n            options.resizeContainer\n            ? childrenSize.height\n            : Math.max(0, this.getFixedContainerBounds(container, options, layouter).height) - options.paddingTop - options.paddingBottom);\n        if (maxWidth > 0 && maxHeight > 0) {\n            const offset = this.layoutChildren(container, layouter, options, maxWidth, maxHeight);\n            boundsData.bounds = this.getFinalContainerBounds(container, offset, options, maxWidth, maxHeight);\n            boundsData.boundsChanged = true;\n        }\n    }\n    protected abstract layoutChild(child: SChildElement,\n                                boundsData: BoundsData, bounds: Bounds,\n                                childOptions: T, containerOptions: T,\n                                currentOffset: Point,\n                                maxWidth: number, maxHeight: number): Point;\n\n    protected getFinalContainerBounds(container: SParentElement & LayoutContainer,\n                                    lastOffset: Point,\n                                    options: T,\n                                    maxWidth: number,\n                                    maxHeight: number): Bounds {\n        return {\n            x: container.bounds.x,\n            y: container.bounds.y,\n            width: maxWidth + options.paddingLeft + options.paddingRight,\n            height: maxHeight + options.paddingTop + options.paddingBottom\n        };\n    }\n\n    protected getFixedContainerBounds(\n            container: SModelElement,\n            layoutOptions: any,\n            layouter: StatefulLayouter): Bounds {\n        let currentContainer = container;\n        while (true) {\n            if (isBoundsAware(currentContainer)) {\n                const bounds = currentContainer.bounds;\n                if (isLayoutContainer(currentContainer) && layoutOptions.resizeContainer)\n                    layouter.log.error(currentContainer, 'Resizable container found while detecting fixed bounds');\n                if (isValidDimension(bounds))\n                    return bounds;\n            }\n            if (currentContainer instanceof SChildElement) {\n                currentContainer = currentContainer.parent;\n            } else {\n                layouter.log.error(currentContainer, 'Cannot detect fixed bounds');\n                return EMPTY_BOUNDS;\n            }\n        }\n    }\n\n    protected abstract getChildrenSize(container: SParentElement & LayoutContainer,\n                               containerOptions: T,\n                               layouter: StatefulLayouter): Dimension;\n\n    protected layoutChildren(container: SParentElement & LayoutContainer,\n                            layouter: StatefulLayouter,\n                            containerOptions: T,\n                            maxWidth: number,\n                            maxHeight: number): Point {\n        let currentOffset: Point = {\n            x: containerOptions.paddingLeft + 0.5 * (maxWidth - (maxWidth / containerOptions.paddingFactor)),\n            y: containerOptions.paddingTop + 0.5 * (maxHeight - (maxHeight / containerOptions.paddingFactor))};\n        container.children.forEach(\n            child => {\n                if (isLayoutableChild(child)) {\n                    const boundsData = layouter.getBoundsData(child);\n                    const bounds = boundsData.bounds;\n                    const childOptions = this.getChildLayoutOptions(child, containerOptions);\n                    if (bounds !== undefined && isValidDimension(bounds)) {\n                        currentOffset = this.layoutChild(child, boundsData, bounds,\n                            childOptions, containerOptions, currentOffset,\n                            maxWidth, maxHeight);\n                    }\n                }\n            }\n        );\n        return currentOffset;\n    }\n\n    protected getDx(hAlign: HAlignment, bounds: Bounds, maxWidth: number): number {\n        switch (hAlign) {\n            case 'left':\n                return 0;\n            case 'center':\n                return 0.5 * (maxWidth - bounds.width);\n            case 'right':\n                return maxWidth - bounds.width;\n        }\n    }\n\n    protected getDy(vAlign: VAlignment, bounds: Bounds, maxHeight: number): number {\n        switch (vAlign) {\n            case 'top':\n                return 0;\n            case 'center':\n                return 0.5 * (maxHeight - bounds.height);\n            case 'bottom':\n                return maxHeight - bounds.height;\n        }\n    }\n\n    protected getChildLayoutOptions(child: SChildElement, containerOptions: T): T {\n        const layoutOptions = (child as any).layoutOptions;\n        if (layoutOptions === undefined)\n            return containerOptions;\n        else\n            return this.spread(containerOptions, layoutOptions);\n    }\n\n    protected getLayoutOptions(element: SModelElement): T {\n        let current = element;\n        const allOptions: T[] = [];\n        while (current !== undefined) {\n            const layoutOptions = (current as any).layoutOptions;\n            if (layoutOptions !== undefined)\n                allOptions.push(layoutOptions);\n            if (current instanceof SChildElement)\n                current = current.parent;\n            else\n                break;\n        }\n        return allOptions.reverse().reduce(\n            (a, b) => { return this.spread(a, b); }, this.getDefaultLayoutOptions());\n    }\n\n    protected abstract getDefaultLayoutOptions(): T;\n\n    protected abstract spread(a: T, b: T): T;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Bounds, Point } from \"../../utils/geometry\";\nimport { SModelElement, SModelRoot, SModelRootSchema } from \"../../base/model/smodel\";\nimport { Action } from \"../../base/actions/action\";\nimport { CommandExecutionContext, HiddenCommand, SystemCommand } from \"../../base/commands/command\";\nimport { BoundsAware, isBoundsAware, Alignable } from './model';\n\n/**\n * Sent from the model source (e.g. a DiagramServer) to the client to update the bounds of some\n * (or all) model elements.\n */\nexport class SetBoundsAction implements Action {\n    readonly kind = SetBoundsCommand.KIND;\n\n    constructor(public readonly bounds: ElementAndBounds[]) {\n    }\n}\n\n/**\n * Sent from the model source to the client to request bounds for the given model. The model is\n * rendered invisibly so the bounds can derived from the DOM. The response is a ComputedBoundsAction.\n * This hidden rendering round-trip is necessary if the client is responsible for parts of the layout\n * (see `needsClientLayout` viewer option).\n */\nexport class RequestBoundsAction implements Action {\n    readonly kind = RequestBoundsCommand.KIND;\n\n    constructor(public readonly newRoot: SModelRootSchema) {\n    }\n}\n\n/**\n * Sent from the client to the model source (e.g. a DiagramServer) to transmit the result of bounds\n * computation as a response to a RequestBoundsAction. If the server is responsible for parts of\n * the layout (see `needsServerLayout` viewer option), it can do so after applying the computed bounds\n * received with this action. Otherwise there is no need to send the computed bounds to the server,\n * so they can be processed locally by the client.\n */\nexport class ComputedBoundsAction implements Action {\n    static readonly KIND = 'computedBounds';\n\n    readonly kind = ComputedBoundsAction.KIND;\n\n    constructor(public readonly bounds: ElementAndBounds[],\n                public readonly revision?: number,\n                public readonly alignments?: ElementAndAlignment[]) {\n    }\n}\n\n/**\n * Associates new bounds with a model element, which is referenced via its id.\n */\nexport interface ElementAndBounds {\n    elementId: string\n    newBounds: Bounds\n}\n\n/**\n * Associates a new alignment with a model element, which is referenced via its id.\n */\nexport interface ElementAndAlignment {\n    elementId: string\n    newAlignment: Point\n}\n\nexport interface ResolvedElementAndBounds {\n    element: SModelElement & BoundsAware\n    oldBounds: Bounds\n    newBounds: Bounds\n}\n\nexport interface ResolvedElementAndAlignment {\n    element: SModelElement & Alignable\n    oldAlignment: Point\n    newAlignment: Point\n}\n\nexport class SetBoundsCommand extends SystemCommand {\n    static readonly KIND: string  = 'setBounds';\n\n    protected bounds: ResolvedElementAndBounds[] = [];\n\n    constructor(protected action: SetBoundsAction) {\n        super();\n    }\n\n    execute(context: CommandExecutionContext) {\n        this.action.bounds.forEach(\n            b => {\n                const element = context.root.index.getById(b.elementId);\n                if (element && isBoundsAware(element)) {\n                    this.bounds.push({\n                        element: element,\n                        oldBounds: element.bounds,\n                        newBounds: b.newBounds,\n                    });\n                }\n            }\n        );\n        return this.redo(context);\n    }\n\n    undo(context: CommandExecutionContext) {\n        this.bounds.forEach(\n            b => b.element.bounds = b.oldBounds\n        );\n        return context.root;\n    }\n\n    redo(context: CommandExecutionContext) {\n        this.bounds.forEach(\n            b => b.element.bounds = b.newBounds\n        );\n        return context.root;\n    }\n}\n\nexport class RequestBoundsCommand extends HiddenCommand {\n    static readonly KIND: string  = 'requestBounds';\n\n    constructor(protected action: RequestBoundsAction) {\n        super();\n    }\n\n    execute(context: CommandExecutionContext): SModelRoot {\n        return context.modelFactory.createRoot(this.action.newRoot);\n    }\n\n    get blockUntil(): (action: Action) => boolean {\n        return action => action.kind === ComputedBoundsAction.KIND;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from \"inversify\";\nimport { TYPES } from \"../../base/types\";\nimport { SetBoundsCommand, RequestBoundsCommand } from \"./bounds-manipulation\";\nimport { HiddenBoundsUpdater } from './hidden-bounds-updater';\nimport { Layouter, LayoutRegistry } from \"./layout\";\n\nconst boundsModule = new ContainerModule(bind => {\n    bind(TYPES.ICommand).toConstructor(SetBoundsCommand);\n    bind(TYPES.ICommand).toConstructor(RequestBoundsCommand);\n    bind(TYPES.HiddenVNodeDecorator).to(HiddenBoundsUpdater).inSingletonScope();\n    bind(TYPES.Layouter).to(Layouter).inSingletonScope();\n    bind(TYPES.LayoutRegistry).to(LayoutRegistry).inSingletonScope();\n});\n\nexport default boundsModule;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Bounds, Point, isValidDimension } from '../../utils/geometry';\nimport { SParentElement, SChildElement } from \"../../base/model/smodel\";\nimport { AbstractLayout } from './abstract-layout';\nimport { AbstractLayoutOptions, VAlignment } from './layout-options';\nimport { BoundsData } from './hidden-bounds-updater';\nimport { LayoutContainer } from './model';\nimport { StatefulLayouter } from './layout';\n\nexport interface HBoxLayoutOptions extends AbstractLayoutOptions {\n    hGap: number\n    vAlign: VAlignment\n}\n\n/**\n * Layouts children of a container in horizontal (left->right) direction.\n */\nexport class HBoxLayouter extends AbstractLayout<HBoxLayoutOptions> {\n\n    static KIND = 'hbox';\n\n    protected getChildrenSize(container: SParentElement & LayoutContainer,\n                               containerOptions: HBoxLayoutOptions,\n                               layouter: StatefulLayouter) {\n        let maxWidth = 0;\n        let maxHeight = -1;\n        let isFirst = true;\n        container.children.forEach(\n            child => {\n                const bounds = layouter.getBoundsData(child).bounds;\n                if (bounds !== undefined && isValidDimension(bounds)) {\n                    if (isFirst)\n                        isFirst = false;\n                    else\n                        maxWidth += containerOptions.hGap;\n                    maxWidth += bounds.width;\n                    maxHeight = Math.max(maxHeight, bounds.height);\n                }\n            }\n        );\n        return {\n            width: maxWidth,\n            height: maxHeight\n        };\n    }\n\n    protected layoutChild(child: SChildElement,\n                        boundsData: BoundsData,\n                        bounds: Bounds,\n                        childOptions: HBoxLayoutOptions,\n                        containerOptions: HBoxLayoutOptions,\n                        currentOffset: Point,\n                        maxWidth: number,\n                        maxHeight: number): Point {\n        const dy = this.getDy(childOptions.vAlign, bounds, maxHeight);\n        boundsData.bounds = {\n            x: currentOffset.x + (child as any).bounds.x - bounds.x,\n            y: containerOptions.paddingTop + (child as any).bounds.y - bounds.y + dy,\n            width: bounds.width,\n            height: bounds.height\n        };\n        boundsData.boundsChanged = true;\n        return {\n            x: currentOffset.x + bounds.width + containerOptions.hGap,\n            y: currentOffset.y\n        };\n    }\n\n    protected getDefaultLayoutOptions(): HBoxLayoutOptions {\n        return {\n            resizeContainer: true,\n            paddingTop: 5,\n            paddingBottom: 5,\n            paddingLeft: 5,\n            paddingRight: 5,\n            paddingFactor: 1,\n            hGap: 1,\n            vAlign: 'center'\n        };\n    }\n\n    protected spread(a: HBoxLayoutOptions, b: HBoxLayoutOptions): HBoxLayoutOptions {\n        return { ...a, ...b };\n    }\n\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable } from \"inversify\";\nimport { VNode } from \"snabbdom/vnode\";\nimport { TYPES } from \"../../base/types\";\nimport { almostEquals, Bounds, Point } from '../../utils/geometry';\nimport { SModelElement, SModelRoot } from \"../../base/model/smodel\";\nimport { IVNodeDecorator } from \"../../base/views/vnode-decorators\";\nimport { IActionDispatcher } from \"../../base/actions/action-dispatcher\";\nimport { ComputedBoundsAction, ElementAndBounds, ElementAndAlignment } from './bounds-manipulation';\nimport { BoundsAware, isSizeable, isLayoutContainer, isAlignable } from \"./model\";\nimport { Layouter } from \"./layout\";\nimport { isExportable } from \"../export/model\";\n\nexport class BoundsData {\n    vnode?: VNode;\n    bounds?: Bounds;\n    alignment?: Point;\n    boundsChanged: boolean;\n    alignmentChanged: boolean;\n}\n\n/**\n * Grabs the bounds from hidden SVG DOM elements, applies layouts and fires\n * ComputedBoundsActions.\n *\n * The actual bounds of an element can usually not be determined from the SModel\n * as they depend on the view implementation and CSS stylings. So the best way is\n * to grab them from a live (but hidden) SVG using getBBox().\n *\n * If an element is Alignable, and the top-left corner of its bounding box is not\n * the origin, we also issue a realign with the ComputedBoundsAction.\n */\n@injectable()\nexport class HiddenBoundsUpdater implements IVNodeDecorator {\n\n    constructor(@inject(TYPES.IActionDispatcher) protected actionDispatcher: IActionDispatcher,\n                @inject(TYPES.Layouter) protected layouter: Layouter) {\n    }\n\n    private readonly element2boundsData: Map<SModelElement, BoundsData> = new Map;\n\n    root: SModelRoot | undefined;\n\n    decorate(vnode: VNode, element: SModelElement): VNode {\n        if (isSizeable(element) || isLayoutContainer(element)) {\n            this.element2boundsData.set(element, {\n                vnode: vnode,\n                bounds: element.bounds,\n                boundsChanged: false,\n                alignmentChanged: false\n            });\n        }\n        if (element instanceof SModelRoot)\n            this.root = element;\n        return vnode;\n    }\n\n    postUpdate() {\n        if (this.root !== undefined && isExportable(this.root) && this.root.export)\n            return;\n        this.getBoundsFromDOM();\n        this.layouter.layout(this.element2boundsData);\n        const resizes: ElementAndBounds[] = [];\n        const realignments: ElementAndAlignment[] = [];\n        this.element2boundsData.forEach(\n            (boundsData, element) => {\n                if (boundsData.boundsChanged && boundsData.bounds !== undefined)\n                    resizes.push({\n                        elementId: element.id,\n                        newBounds: boundsData.bounds\n                    });\n                if (boundsData.alignmentChanged && boundsData.alignment !== undefined)\n                    realignments.push({\n                        elementId: element.id,\n                        newAlignment: boundsData.alignment\n                    });\n            });\n        const revision = (this.root !== undefined) ? this.root.revision : undefined;\n        this.actionDispatcher.dispatch(new ComputedBoundsAction(resizes, revision, realignments));\n        this.element2boundsData.clear();\n    }\n\n    protected getBoundsFromDOM() {\n        this.element2boundsData.forEach(\n            (boundsData, element) => {\n                if (boundsData.bounds && isSizeable(element)) {\n                    const vnode = boundsData.vnode;\n                    if (vnode && vnode.elm) {\n                        const boundingBox = this.getBounds(vnode.elm, element);\n                        if (isAlignable(element) && !(\n                            almostEquals(boundingBox.x, 0) && almostEquals(boundingBox.y, 0)\n                        )) {\n                            boundsData.alignment = {\n                                x: -boundingBox.x,\n                                y: -boundingBox.y\n                            };\n                            boundsData.alignmentChanged = true;\n                        }\n                        const newBounds = {\n                            x: element.bounds.x,\n                            y: element.bounds.y,\n                            width: boundingBox.width,\n                            height: boundingBox.height\n                        };\n                        if (!(almostEquals(newBounds.x, element.bounds.x)\n                            && almostEquals(newBounds.y, element.bounds.y)\n                            && almostEquals(newBounds.width, element.bounds.width)\n                            && almostEquals(newBounds.height, element.bounds.height))) {\n                            boundsData.bounds = newBounds;\n                            boundsData.boundsChanged = true;\n                        }\n                    }\n                }\n            }\n        );\n    }\n\n    protected getBounds(elm: any, element: BoundsAware): Bounds {\n        const bounds = elm.getBBox();\n        return {\n            x: bounds.x,\n            y: bounds.y,\n            width: bounds.width,\n            height: bounds.height\n        };\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable } from \"inversify\";\nimport { TYPES } from \"../../base/types\";\nimport { ILogger } from '../../utils/logging';\nimport { InstanceRegistry } from \"../../utils/registry\";\nimport { Bounds, EMPTY_BOUNDS } from \"../../utils/geometry\";\nimport { SParentElement, SModelElement } from \"../../base/model/smodel\";\nimport { isLayoutContainer, LayoutContainer } from \"./model\";\nimport { BoundsData } from \"./hidden-bounds-updater\";\nimport { VBoxLayouter } from \"./vbox-layout\";\nimport { HBoxLayouter } from \"./hbox-layout\";\nimport { StackLayouter } from \"./stack-layout\";\n\nexport class LayoutRegistry extends InstanceRegistry<ILayout> {\n    constructor() {\n        super();\n        this.register(VBoxLayouter.KIND, new VBoxLayouter());\n        this.register(HBoxLayouter.KIND, new HBoxLayouter());\n        this.register(StackLayouter.KIND, new StackLayouter());\n    }\n}\n\n@injectable()\nexport class Layouter {\n\n    constructor(@inject(TYPES.LayoutRegistry) protected layoutRegistry: LayoutRegistry,\n                @inject(TYPES.ILogger) protected logger: ILogger) {}\n\n    layout(element2boundsData: Map<SModelElement​​ , BoundsData>) {\n        new StatefulLayouter(element2boundsData, this.layoutRegistry, this.logger).layout();\n    }\n}\n\nexport class StatefulLayouter {\n\n    private toBeLayouted: (SParentElement & LayoutContainer)[];\n\n    constructor(private readonly element2boundsData: Map<SModelElement​​ , BoundsData>,\n                private readonly layoutRegistry: LayoutRegistry,\n                public readonly log: ILogger) {\n        this.toBeLayouted = [];\n        element2boundsData.forEach(\n            (data, element) => {\n                if (isLayoutContainer(element))\n                    this.toBeLayouted.push(element);\n            });\n    }\n\n    getBoundsData(element: SModelElement): BoundsData {\n        let boundsData = this.element2boundsData.get(element);\n        let bounds = (element as any).bounds;\n        if (isLayoutContainer(element) && this.toBeLayouted.indexOf(element) >= 0) {\n            bounds = this.doLayout(element);\n        }\n        if (!boundsData) {\n            boundsData = {\n                bounds: bounds,\n                boundsChanged: false,\n                alignmentChanged: false\n            };\n            this.element2boundsData.set(element, boundsData);\n        }\n        return boundsData;\n    }\n\n    layout(): void {\n        while (this.toBeLayouted.length > 0) {\n            const element = this.toBeLayouted[0];\n            this.doLayout(element);\n        }\n    }\n\n    protected doLayout(element: SParentElement & LayoutContainer): Bounds {\n        const index = this.toBeLayouted.indexOf(element);\n        if (index >= 0)\n            this.toBeLayouted.splice(index, 1);\n        const layout = this.layoutRegistry.get(element.layout);\n        if (layout)\n            layout.layout(element, this);\n        const boundsData = this.element2boundsData.get(element);\n        if (boundsData !== undefined && boundsData.bounds !== undefined) {\n            return boundsData.bounds;\n        } else {\n            this.log.error(element, 'Layout failed');\n            return EMPTY_BOUNDS;\n        }\n    }\n}\n\nexport interface ILayout {\n    layout(container: SParentElement & LayoutContainer,\n           layouter: StatefulLayouter): void\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Bounds, EMPTY_BOUNDS, EMPTY_DIMENSION, Dimension, isBounds, ORIGIN_POINT, Point } from \"../../utils/geometry\";\nimport { SModelElement, SModelElementSchema, SParentElement, SChildElement, SModelRoot } from \"../../base/model/smodel\";\nimport { SModelExtension } from \"../../base/model/smodel-extension\";\nimport { findParentByFeature } from '../../base/model/smodel-utils';\nimport { Locateable } from '../move/model';\n\nexport const boundsFeature = Symbol('boundsFeature');\nexport const layoutContainerFeature = Symbol('layoutContainerFeature');\nexport const layoutableChildFeature = Symbol('layoutableChildFeature');\nexport const alignFeature = Symbol('alignFeature');\n\n/**\n * Model elements that implement this interface have a position and a size.\n */\nexport interface BoundsAware extends SModelExtension {\n    bounds: Bounds\n}\n\n/**\n * Used to identify model elements that specify a layout to apply to their children.\n */\nexport interface LayoutContainer extends LayoutableChild {\n    layout: string\n}\n\nexport type ModelLayoutOptions = {[key: string]: string | number | boolean};\n\nexport interface LayoutableChild extends SModelExtension, BoundsAware {\n    layoutOptions?: ModelLayoutOptions\n}\n\n/**\n * Used to adjust elements whose bounding box is not at the origin, e.g.\n * labels, or pre-rendered SVG figures.\n */\nexport interface Alignable extends SModelExtension {\n    alignment: Point\n}\n\nexport function isBoundsAware(element: SModelElement): element is SModelElement & BoundsAware {\n    return 'bounds' in element;\n}\n\nexport function isLayoutContainer(element: SModelElement): element is SParentElement & LayoutContainer {\n    return isBoundsAware(element)\n        && element.hasFeature(layoutContainerFeature)\n        && 'layout' in element;\n}\n\nexport function isLayoutableChild(element: SModelElement): element is SParentElement & LayoutableChild {\n    return isBoundsAware(element)\n        && element.hasFeature(layoutableChildFeature);\n}\n\nexport function isSizeable(element: SModelElement): element is SModelElement & BoundsAware {\n    return element.hasFeature(boundsFeature) && isBoundsAware(element);\n}\n\nexport function isAlignable(element: SModelElement): element is SModelElement & Alignable {\n    return element.hasFeature(alignFeature)\n        && 'alignment' in element;\n}\n\nexport function getAbsoluteBounds(element: SModelElement): Bounds {\n    const boundsAware = findParentByFeature(element, isBoundsAware);\n    if (boundsAware !== undefined) {\n        let bounds = boundsAware.bounds;\n        let current: SModelElement = boundsAware;\n        while (current instanceof SChildElement) {\n            const parent = current.parent;\n            bounds = parent.localToParent(bounds);\n            current = parent;\n        }\n        return bounds;\n    } else if (element instanceof SModelRoot) {\n        const canvasBounds = element.canvasBounds;\n        return { x: 0, y: 0, width: canvasBounds.width, height: canvasBounds.height };\n    } else {\n        return EMPTY_BOUNDS;\n    }\n}\n\n/**\n * Serializable schema for SShapeElement.\n */\nexport interface SShapeElementSchema extends SModelElementSchema {\n    position?: Point\n    size?: Dimension\n    children?: SModelElementSchema[]\n    layoutOptions?: ModelLayoutOptions\n}\n\n/**\n * Abstract class for elements with a position and a size.\n */\nexport abstract class SShapeElement extends SChildElement implements BoundsAware, Locateable, LayoutableChild {\n    position: Point = ORIGIN_POINT;\n    size: Dimension = EMPTY_DIMENSION;\n    layoutOptions?: ModelLayoutOptions;\n\n    get bounds(): Bounds {\n        return {\n            x: this.position.x,\n            y: this.position.y,\n            width: this.size.width,\n            height: this.size.height\n        };\n    }\n\n    set bounds(newBounds: Bounds) {\n        this.position = {\n            x: newBounds.x,\n            y: newBounds.y\n        };\n        this.size = {\n            width: newBounds.width,\n            height: newBounds.height\n        };\n    }\n\n    localToParent(point: Point | Bounds): Bounds {\n        const result = {\n            x: point.x + this.position.x,\n            y: point.y + this.position.y,\n            width: -1,\n            height: -1\n        };\n        if (isBounds(point)) {\n            result.width = point.width;\n            result.height = point.height;\n        }\n        return result;\n    }\n\n    parentToLocal(point: Point | Bounds): Bounds {\n        const result = {\n            x: point.x - this.position.x,\n            y: point.y - this.position.y,\n            width: -1,\n            height: -1\n        };\n        if (isBounds(point)) {\n            result.width = point.width;\n            result.height = point.height;\n        }\n        return result;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Animation } from \"../../base/animations/animation\";\nimport { SModelRoot, SModelElement } from \"../../base/model/smodel\";\nimport { CommandExecutionContext } from \"../../base/commands/command\";\nimport { BoundsAware } from './model';\nimport { Dimension } from '../../utils/geometry';\n\nexport interface ResolvedElementResize {\n    element: SModelElement & BoundsAware\n    fromDimension: Dimension\n    toDimension: Dimension\n}\n\nexport class ResizeAnimation extends Animation {\n    constructor(protected model: SModelRoot,\n        public elementResizes: Map<string, ResolvedElementResize>,\n        context: CommandExecutionContext,\n        protected reverse: boolean = false) {\n        super(context);\n    }\n\n    tween(t: number) {\n        this.elementResizes.forEach(\n            (elementResize) => {\n                const element = elementResize.element;\n                const newDimension: Dimension = (this.reverse) ? {\n                        width: (1 - t) * elementResize.toDimension.width + t * elementResize.fromDimension.width,\n                        height: (1 - t) * elementResize.toDimension.height + t * elementResize.fromDimension.height\n                    } : {\n                        width: (1 - t) * elementResize.fromDimension.width + t * elementResize.toDimension.width,\n                        height: (1 - t) * elementResize.fromDimension.height + t * elementResize.toDimension.height\n                    };\n                element.bounds = {\n                    x: element.bounds.x,\n                    y: element.bounds.y,\n                    width: newDimension.width,\n                    height: newDimension.height\n                };\n            }\n        );\n        return this.model;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Bounds, Point, isValidDimension } from '../../utils/geometry';\nimport { SParentElement, SChildElement } from \"../../base/model/smodel\";\nimport { AbstractLayout } from './abstract-layout';\nimport { AbstractLayoutOptions, HAlignment, VAlignment } from './layout-options';\nimport { BoundsData } from './hidden-bounds-updater';\nimport { LayoutContainer } from './model';\nimport { StatefulLayouter } from './layout';\n\nexport interface StackLayoutOptions extends AbstractLayoutOptions {\n    paddingFactor: number\n    vAlign: VAlignment\n    hAlign: HAlignment\n}\n\nexport class StackLayouter extends AbstractLayout<StackLayoutOptions> {\n\n    static KIND = 'stack';\n\n    protected getChildrenSize(container: SParentElement & LayoutContainer,\n                            options: StackLayoutOptions,\n                            layouter: StatefulLayouter) {\n        let maxWidth = -1;\n        let maxHeight = -1;\n        container.children.forEach(\n            child => {\n                const bounds = layouter.getBoundsData(child).bounds;\n                if (bounds !== undefined && isValidDimension(bounds)) {\n                    maxWidth = Math.max(maxWidth, bounds.width);\n                    maxHeight = Math.max(maxHeight, bounds.height);\n                }\n            }\n        );\n        return {\n            width: maxWidth,\n            height: maxHeight\n        };\n    }\n\n    protected layoutChild(child: SChildElement,\n                        boundsData: BoundsData,\n                        bounds: Bounds,\n                        childOptions: StackLayoutOptions,\n                        containerOptions: StackLayoutOptions,\n                        currentOffset: Point,\n                        maxWidth: number, maxHeight: number): Point {\n        const dx = this.getDx(childOptions.hAlign, bounds, maxWidth);\n        const dy = this.getDy(childOptions.vAlign, bounds, maxHeight);\n        boundsData.bounds = {\n            x: containerOptions.paddingLeft + (child as any).bounds.x - bounds.x + dx,\n            y: containerOptions.paddingTop + (child as any).bounds.y - bounds.y + dy,\n            width: bounds.width,\n            height: bounds.height\n        };\n        boundsData.boundsChanged = true;\n        return currentOffset;\n    }\n\n    protected getDefaultLayoutOptions(): StackLayoutOptions {\n        return {\n            resizeContainer: true,\n            paddingTop: 5,\n            paddingBottom: 5,\n            paddingLeft: 5,\n            paddingRight: 5,\n            paddingFactor: 1,\n            hAlign: 'center',\n            vAlign: 'center'\n        };\n    }\n\n    protected spread(a: StackLayoutOptions, b: StackLayoutOptions): StackLayoutOptions {\n        return { ...a, ...b };\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Bounds, Point, isValidDimension } from '../../utils/geometry';\nimport { SParentElement, SChildElement } from \"../../base/model/smodel\";\nimport { AbstractLayout } from './abstract-layout';\nimport { AbstractLayoutOptions, HAlignment } from './layout-options';\nimport { BoundsData } from './hidden-bounds-updater';\nimport { LayoutContainer } from './model';\nimport { StatefulLayouter } from './layout';\n\nexport interface VBoxLayoutOptions extends AbstractLayoutOptions {\n    vGap: number\n    hAlign: HAlignment\n}\n\n/**\n * Layouts children of a container in vertical (top->bottom) direction.\n */\nexport class VBoxLayouter extends AbstractLayout<VBoxLayoutOptions> {\n\n    static KIND = 'vbox';\n\n    protected getChildrenSize(container: SParentElement & LayoutContainer,\n                               containerOptions: VBoxLayoutOptions,\n                               layouter: StatefulLayouter) {\n        let maxWidth = -1;\n        let maxHeight = 0;\n        let isFirst = true;\n        container.children.forEach(\n            child => {\n                const bounds = layouter.getBoundsData(child).bounds;\n                if (bounds !== undefined && isValidDimension(bounds)) {\n                    maxHeight += bounds.height;\n                    if (isFirst)\n                        isFirst = false;\n                    else\n                        maxHeight += containerOptions.vGap;\n                    maxWidth = Math.max(maxWidth, bounds.width);\n                }\n            }\n        );\n        return {\n            width: maxWidth,\n            height: maxHeight\n        };\n    }\n\n    protected layoutChild(child: SChildElement,\n                        boundsData: BoundsData,\n                        bounds: Bounds,\n                        childOptions: VBoxLayoutOptions,\n                        containerOptions: VBoxLayoutOptions,\n                        currentOffset: Point,\n                        maxWidth: number,\n                        maxHeight: number) {\n        const dx = this.getDx(childOptions.hAlign, bounds, maxWidth);\n        boundsData.bounds = {\n            x: containerOptions.paddingLeft + (child as any).bounds.x - bounds.x + dx,\n            y: currentOffset.y + (child as any).bounds.y - bounds.y,\n            width: bounds.width,\n            height: bounds.height\n        };\n        boundsData.boundsChanged = true;\n        return {\n            x: currentOffset.x,\n            y: currentOffset.y + bounds.height + containerOptions.vGap\n        };\n    }\n\n    protected getDefaultLayoutOptions(): VBoxLayoutOptions {\n        return {\n            resizeContainer: true,\n            paddingTop: 5,\n            paddingBottom: 5,\n            paddingLeft: 5,\n            paddingRight: 5,\n            paddingFactor: 1,\n            vGap: 1,\n            hAlign: 'center'\n        };\n    }\n\n    protected spread(a: VBoxLayoutOptions, b: VBoxLayoutOptions): VBoxLayoutOptions {\n        return { ...a, ...b };\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { InstanceRegistry } from '../../utils/registry';\nimport { SButton } from './model';\nimport { Action } from '../../base/actions/action';\nimport { injectable, multiInject, optional } from 'inversify';\nimport { TYPES } from '../../base/types';\n\nexport interface IButtonHandler {\n    buttonPressed(button: SButton): Action[]\n}\n\nexport interface IButtonHandlerFactory {\n    TYPE: string\n    new(): IButtonHandler\n}\n\n@injectable()\nexport class ButtonHandlerRegistry extends InstanceRegistry<IButtonHandler> {\n\n    constructor(@multiInject(TYPES.IButtonHandler)@optional() buttonHandlerFactories: IButtonHandlerFactory[]) {\n        super();\n        buttonHandlerFactories.forEach(factory => this.register(factory.TYPE, new factory()));\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from \"inversify\";\nimport { ButtonHandlerRegistry } from './button-handler';\n\nconst buttonModule = new ContainerModule(bind => {\n    bind(ButtonHandlerRegistry).toSelf().inSingletonScope();\n});\n\nexport default buttonModule;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { boundsFeature, layoutableChildFeature, SShapeElement, SShapeElementSchema } from '../bounds/model';\nimport { fadeFeature } from '../fade/model';\n\nexport interface SButtonSchema extends SShapeElementSchema {\n    pressed: boolean\n    enabled: boolean\n}\n\nexport class SButton extends SShapeElement {\n    enabled = true;\n\n    hasFeature(feature: symbol) {\n        return feature === boundsFeature || feature === fadeFeature || feature === layoutableChildFeature;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from \"inversify\";\nimport { TYPES } from \"../../base/types\";\nimport { SwitchEditModeCommand, MoveRoutingHandleCommand } from \"./edit-routing\";\n\nconst edgeEditModule = new ContainerModule(bind => {\n    bind(TYPES.ICommand).toConstructor(SwitchEditModeCommand);\n    bind(TYPES.ICommand).toConstructor(MoveRoutingHandleCommand);\n});\n\nexport default edgeEditModule;\n","/*\n * Copyright (C) 2018 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable } from \"inversify\";\nimport { Point } from \"../../utils/geometry\";\nimport { Routable, isRoutable, canEditRouting, SRoutingHandle } from './model';\nimport { Action } from \"../../base/actions/action\";\nimport { Command, CommandExecutionContext, CommandResult } from \"../../base/commands/command\";\nimport { SModelElement, SModelRoot, SParentElement, SModelIndex } from '../../base/model/smodel';\nimport { Animation } from '../../base/animations/animation';\n\nexport function createRoutingHandle(kind: 'junction' | 'line', parentId: string, index: number): SRoutingHandle {\n    const handle = new SRoutingHandle();\n    handle.type = kind === 'junction' ? 'routing-point' : 'volatile-routing-point';\n    handle.kind = kind;\n    handle.pointIndex = index;\n    return handle;\n}\n\nexport function createRoutingHandles(editTarget: SParentElement & Routable): void {\n    const rpCount = editTarget.routingPoints.length;\n    const targetId = editTarget.id;\n    editTarget.add(createRoutingHandle('line', targetId, -1));\n    for (let i = 0; i < rpCount; i++) {\n        editTarget.add(createRoutingHandle('junction', targetId, i));\n        editTarget.add(createRoutingHandle('line', targetId, i));\n    }\n}\n\nexport class SwitchEditModeAction implements Action {\n    kind = SwitchEditModeCommand.KIND;\n\n    constructor(public readonly elementsToActivate: string[] = [],\n                public readonly elementsToDeactivate: string[] = []) {\n    }\n}\n\n@injectable()\nexport class SwitchEditModeCommand extends Command {\n    static KIND: string = \"switchEditMode\";\n\n    protected elementsToActivate: SModelElement[] = [];\n    protected elementsToDeactivate: SModelElement[] = [];\n    protected handlesToRemove: { handle: SRoutingHandle, parent: SParentElement & Routable, point?: Point }[] = [];\n\n    constructor(public action: SwitchEditModeAction) {\n        super();\n    }\n\n    execute(context: CommandExecutionContext): SModelRoot {\n        const index = context.root.index;\n        this.action.elementsToActivate.forEach(id => {\n            const element = index.getById(id);\n            if (element !== undefined )\n                this.elementsToActivate.push(element);\n        });\n        this.action.elementsToDeactivate.forEach(id => {\n            const element = index.getById(id);\n            if (element !== undefined)\n                this.elementsToDeactivate.push(element);\n            if (element instanceof SRoutingHandle && isRoutable(element.parent)) {\n                const parent = element.parent;\n                if (this.shouldRemoveHandle(element, parent)) {\n                    this.handlesToRemove.push({ handle: element, parent });\n                    this.elementsToDeactivate.push(parent);\n                    this.elementsToActivate.push(parent);\n                }\n            }\n        });\n        return this.doExecute(context);\n    }\n\n    protected doExecute(context: CommandExecutionContext): SModelRoot {\n        this.handlesToRemove.forEach(entry => {\n            entry.point = entry.parent.routingPoints.splice(entry.handle.pointIndex, 1)[0];\n        });\n        this.elementsToDeactivate.forEach(element => {\n            if (isRoutable(element) && element instanceof SParentElement)\n                element.removeAll(child => child instanceof SRoutingHandle);\n            else if (element instanceof SRoutingHandle)\n                element.editMode = false;\n        });\n        this.elementsToActivate.forEach(element => {\n            if (canEditRouting(element) && element instanceof SParentElement)\n                createRoutingHandles(element);\n            else if (element instanceof SRoutingHandle)\n                element.editMode = true;\n        });\n        return context.root;\n    }\n\n    protected shouldRemoveHandle(handle: SRoutingHandle, parent: Routable): boolean {\n        if (handle.kind === 'junction') {\n            const route = parent.route();\n            return route.find(rp => rp.pointIndex === handle.pointIndex) === undefined;\n        }\n        return false;\n    }\n\n    undo(context: CommandExecutionContext): CommandResult {\n        this.handlesToRemove.forEach(entry => {\n            if (entry.point !== undefined)\n                entry.parent.routingPoints.splice(entry.handle.pointIndex, 0, entry.point);\n        });\n        this.elementsToActivate.forEach(element => {\n            if (isRoutable(element) && element instanceof SParentElement)\n                element.removeAll(child => child instanceof SRoutingHandle);\n            else if (element instanceof SRoutingHandle)\n                element.editMode = false;\n        });\n        this.elementsToDeactivate.forEach(element => {\n            if (canEditRouting(element) && element instanceof SParentElement)\n                createRoutingHandles(element);\n            else if (element instanceof SRoutingHandle)\n                element.editMode = true;\n        });\n        return context.root;\n    }\n\n    redo(context: CommandExecutionContext): CommandResult {\n        return this.doExecute(context);\n    }\n}\n\nexport interface HandleMove {\n    elementId: string\n    fromPosition?: Point\n    toPosition: Point\n}\n\nexport interface ResolvedHandleMove {\n    elementId: string\n    element: SRoutingHandle\n    parent: SParentElement\n    fromPosition?: Point\n    toPosition: Point\n}\n\nexport class MoveRoutingHandleAction implements Action {\n    kind: string = MoveRoutingHandleCommand.KIND;\n\n    constructor(public readonly moves: HandleMove[],\n                public readonly animate: boolean = true) {\n    }\n\n}\n\n@injectable()\nexport class MoveRoutingHandleCommand extends Command {\n    static KIND: string = 'moveHandle';\n\n    resolvedMoves: Map<string, ResolvedHandleMove> = new Map;\n    originalRoutingPoints: Map<string, Point[]> = new Map;\n\n    constructor(protected action: MoveRoutingHandleAction) {\n        super();\n    }\n\n    execute(context: CommandExecutionContext) {\n        const model = context.root;\n        this.action.moves.forEach(\n            move => {\n                const resolvedMove = this.resolve(move, model.index);\n                if (resolvedMove !== undefined) {\n                    this.resolvedMoves.set(resolvedMove.elementId, resolvedMove);\n                    const parent = resolvedMove.parent;\n                    if (isRoutable(parent))\n                        this.originalRoutingPoints.set(parent.id, parent.routingPoints.slice());\n                }\n            }\n        );\n        if (this.action.animate) {\n            return new MoveHandlesAnimation(model, this.resolvedMoves, this.originalRoutingPoints, context).start();\n        } else {\n            return this.doMove(context);\n        }\n    }\n\n    protected resolve(move: HandleMove, index: SModelIndex<SModelElement>): ResolvedHandleMove | undefined {\n        const element = index.getById(move.elementId);\n        if (element instanceof SRoutingHandle) {\n            return {\n                elementId: move.elementId,\n                element: element,\n                parent: element.parent,\n                fromPosition: move.fromPosition,\n                toPosition: move.toPosition\n            };\n        }\n        return undefined;\n    }\n\n    protected doMove(context: CommandExecutionContext): SModelRoot {\n        this.resolvedMoves.forEach(res => {\n            const handle = res.element;\n            const parent = res.parent;\n            if (isRoutable(parent)) {\n                const points = parent.routingPoints;\n                let index = handle.pointIndex;\n                if (handle.kind === 'line') {\n                    // Upgrade to a proper routing point\n                    handle.kind = 'junction';\n                    handle.type = 'routing-point';\n                    points.splice(index + 1, 0, res.fromPosition || points[Math.max(index, 0)]);\n                    parent.children.forEach(child => {\n                        if (child instanceof SRoutingHandle && (child === handle || child.pointIndex > index))\n                            child.pointIndex++;\n                    });\n                    parent.add(createRoutingHandle('line', parent.id, index));\n                    parent.add(createRoutingHandle('line', parent.id, index + 1));\n                    index++;\n                }\n                if (index >= 0 && index < points.length) {\n                    points[index] = res.toPosition;\n                }\n            }\n        });\n        return context.root;\n    }\n\n    undo(context: CommandExecutionContext): CommandResult {\n        if (this.action.animate) {\n            return new MoveHandlesAnimation(context.root, this.resolvedMoves, this.originalRoutingPoints, context, true).start();\n        } else {\n            this.resolvedMoves.forEach(res => {\n                const parent = res.parent;\n                const points = this.originalRoutingPoints.get(parent.id);\n                if (points !== undefined && isRoutable(parent)) {\n                    parent.routingPoints = points;\n                    parent.removeAll(e => e instanceof SRoutingHandle);\n                    createRoutingHandles(parent);\n                }\n            });\n            return context.root;\n        }\n    }\n\n    redo(context: CommandExecutionContext): CommandResult {\n        if (this.action.animate) {\n            return new MoveHandlesAnimation(context.root, this.resolvedMoves, this.originalRoutingPoints, context, false).start();\n        } else {\n            return this.doMove(context);\n        }\n    }\n\n}\n\nexport class MoveHandlesAnimation extends Animation {\n\n    constructor(protected model: SModelRoot,\n                public handleMoves: Map<string, ResolvedHandleMove>,\n                public originalRoutingPoints: Map<string, Point[]>,\n                context: CommandExecutionContext,\n                protected reverse: boolean = false) {\n        super(context);\n    }\n\n    tween(t: number) {\n        this.handleMoves.forEach(handleMove => {\n            const parent = handleMove.parent;\n            if (isRoutable(parent) && handleMove.fromPosition !== undefined) {\n                if (this.reverse && t === 1) {\n                    const revPoints = this.originalRoutingPoints.get(parent.id);\n                    if (revPoints !== undefined) {\n                        parent.routingPoints = revPoints;\n                        parent.removeAll(e => e instanceof SRoutingHandle);\n                        createRoutingHandles(parent);\n                        return;\n                    }\n                }\n                const points = parent.routingPoints;\n                const index = handleMove.element.pointIndex;\n                if (index >= 0 && index < points.length) {\n                    if (this.reverse) {\n                        points[index] = {\n                            x: (1 - t) * handleMove.toPosition.x + t * handleMove.fromPosition.x,\n                            y: (1 - t) * handleMove.toPosition.y + t * handleMove.fromPosition.y\n                        };\n                    } else {\n                        points[index] = {\n                            x: (1 - t) * handleMove.fromPosition.x + t * handleMove.toPosition.x,\n                            y: (1 - t) * handleMove.fromPosition.y + t * handleMove.toPosition.y\n                        };\n                    }\n                }\n            }\n        });\n        return this.model;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Point, angleBetweenPoints } from '../../utils/geometry';\nimport { SModelElement, SChildElement, SParentElement } from '../../base/model/smodel';\nimport { SModelExtension } from '../../base/model/smodel-extension';\nimport { Selectable, selectFeature } from '../select/model';\nimport { moveFeature } from '../move/model';\nimport { Hoverable, hoverFeedbackFeature } from '../hover/model';\nimport { RoutedPoint } from '../../graph/routing';\n\nexport const editFeature = Symbol('editFeature');\n\nexport interface Routable extends SModelExtension {\n    routingPoints: Point[]\n    readonly source?: SModelElement\n    readonly target?: SModelElement\n    route(): RoutedPoint[]\n}\n\nexport function isRoutable(element: SModelElement): element is SModelElement & Routable {\n    return (element as any).routingPoints !== undefined && typeof((element as any).route) === 'function';\n}\n\nexport function canEditRouting(element: SModelElement): element is SModelElement & Routable {\n    return isRoutable(element) && element.hasFeature(editFeature);\n}\n\nexport class SRoutingHandle extends SChildElement implements Selectable, Hoverable {\n    /** 'junction' is a point where two line segments meet, 'line' is a volatile handle placed on a line segment. */\n    kind: 'junction' | 'line';\n    /** The actual routing point index (junction) or the previous point index (line). */\n    pointIndex: number;\n    /** Whether the routing point is being dragged. */\n    editMode: boolean = false;\n\n    hoverFeedback: boolean = false;\n    selected: boolean = false;\n\n    hasFeature(feature: symbol): boolean {\n        return feature === selectFeature || feature === moveFeature || feature === hoverFeedbackFeature;\n    }\n}\n\n/** The angle in radians below which a routing handle is removed. */\nconst HANDLE_REMOVE_THRESHOLD = 0.1;\n\n/**\n * Remove routed points that are in edit mode and for which the angle between the preceding and\n * following points falls below a threshold.\n */\nexport function filterEditModeHandles(route: RoutedPoint[], parent: SParentElement): RoutedPoint[] {\n    if (parent.children.length === 0)\n        return route;\n\n    let i = 0;\n    while (i < route.length) {\n        const curr = route[i];\n        if (curr.pointIndex !== undefined) {\n            const handle: SRoutingHandle | undefined = parent.children.find(child =>\n                child instanceof SRoutingHandle && child.kind === 'junction' && child.pointIndex === curr.pointIndex) as any;\n            if (handle !== undefined && handle.editMode && i > 0 && i < route.length - 1) {\n                const prev = route[i - 1], next = route[i + 1];\n                const prevDiff: Point = { x: prev.x - curr.x, y: prev.y - curr.y };\n                const nextDiff: Point = { x: next.x - curr.x, y: next.y - curr.y };\n                const angle = angleBetweenPoints(prevDiff, nextDiff);\n                if (Math.abs(Math.PI - angle) < HANDLE_REMOVE_THRESHOLD) {\n                    route.splice(i, 1);\n                    continue;\n                }\n            }\n        }\n        i++;\n    }\n    return route;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from \"inversify\";\nimport { TYPES } from \"../../base/types\";\nimport { ExpandButtonHandler } from \"./expand\";\n\nconst expandModule = new ContainerModule(bind => {\n    bind(TYPES.IButtonHandler).toConstructor(ExpandButtonHandler);\n});\n\nexport default expandModule;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Action } from '../../base/actions/action';\nimport { SButton } from '../button/model';\nimport { findParentByFeature } from '../../base/model/smodel-utils';\nimport { isExpandable } from './model';\nimport { IButtonHandler } from '../button/button-handler';\nimport { injectable } from 'inversify';\n\n/**\n * Sent from the client to the model source to recalculate a diagram when elements\n * are collapsed/expanded by the client.\n */\nexport class CollapseExpandAction {\n    static KIND = 'collapseExpand';\n    kind = CollapseExpandAction.KIND;\n\n    constructor(public readonly expandIds: string[],\n                public readonly collapseIds: string[]) {\n    }\n}\n\n/**\n * Programmatic action for expanding or collapsing all elements.\n */\nexport class CollapseExpandAllAction {\n    static KIND = 'collapseExpandAll';\n    kind = CollapseExpandAllAction.KIND;\n\n    /**\n     * If `expand` is true, all elements are expanded, othewise they are collapsed.\n     */\n    constructor(public readonly expand: boolean = true) {\n    }\n}\n\n@injectable()\nexport class ExpandButtonHandler implements IButtonHandler {\n    static TYPE = 'button:expand';\n\n    buttonPressed(button: SButton): Action[] {\n        const expandable = findParentByFeature(button, isExpandable);\n        if (expandable !== undefined) {\n            return [ new CollapseExpandAction(\n                expandable.expanded ? [] : [ expandable.id ],\n                expandable.expanded ? [ expandable.id ] : []) ];\n        } else {\n            return [];\n        }\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { SModelElement } from \"../../base/model/smodel\";\nimport { SModelExtension } from \"../../base/model/smodel-extension\";\n\nexport const expandFeature = Symbol('expandFeature');\n\n/**\n * Model elements that implement this interface can be expanded/collapsed\n */\nexport interface Expandable extends SModelExtension {\n    expanded: boolean\n}\n\nexport function isExpandable(element: SModelElement): element is SModelElement & Expandable {\n    return element.hasFeature(expandFeature) && 'expanded' in element;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\n /** @jsx svg */\nimport { svg } from 'snabbdom-jsx';\n\nimport { VNode } from 'snabbdom/vnode';\nimport { IView, RenderingContext } from '../../base/views/view';\nimport { isExpandable } from './model';\nimport { findParentByFeature } from '../../base/model/smodel-utils';\nimport { SButton } from '../button/model';\n\nexport class ExpandButtonView implements IView {\n    render(button: SButton, context: RenderingContext): VNode {\n        const expandable = findParentByFeature(button, isExpandable);\n        const path = (expandable !== undefined && expandable.expanded)\n            ? 'M 1,5 L 8,12 L 15,5 Z'\n            : 'M 1,8 L 8,15 L 8,1 Z';\n        return <g class-sprotty-button=\"{true}\" class-enabled=\"{button.enabled}\">\n                <rect x={0} y={0} width={16} height={16} opacity={0}></rect>\n                <path d={path}></path>\n            </g>;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from \"inversify\";\nimport { TYPES } from '../../base/types';\nimport { ExportSvgDecorator, ExportSvgKeyListener, ExportSvgCommand } from './export';\nimport { SvgExporter } from './svg-exporter';\n\nconst exportSvgModule = new ContainerModule(bind => {\n    bind(TYPES.KeyListener).to(ExportSvgKeyListener).inSingletonScope();\n    bind(TYPES.HiddenVNodeDecorator).to(ExportSvgDecorator).inSingletonScope();\n    bind(TYPES.ICommand).toConstructor(ExportSvgCommand);\n    bind(TYPES.SvgExporter).to(SvgExporter).inSingletonScope();\n});\n\nexport default exportSvgModule;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable, inject } from \"inversify\";\nimport { VNode } from 'snabbdom/vnode';\nimport { CommandExecutionContext, HiddenCommand } from '../../base/commands/command';\nimport { IVNodeDecorator } from '../../base/views/vnode-decorators';\nimport { isSelectable } from '../select/model';\nimport { Action } from '../../base/actions/action';\nimport { SModelElement, SModelRoot } from '../../base/model/smodel';\nimport { KeyListener } from '../../base/views/key-tool';\nimport { matchesKeystroke } from '../../utils/keyboard';\nimport { isExportable } from './model';\nimport { SvgExporter } from './svg-exporter';\nimport { EMPTY_ROOT } from '../../base/model/smodel-factory';\nimport { isViewport } from '../viewport/model';\nimport { isHoverable } from '../hover/model';\nimport { TYPES } from '../../base/types';\n\n@injectable()\nexport class ExportSvgKeyListener extends KeyListener {\n    keyDown(element: SModelElement, event: KeyboardEvent): Action[] {\n        if (matchesKeystroke(event, 'KeyE', 'ctrlCmd', 'shift'))\n            return [ new RequestExportSvgAction() ];\n        else\n            return [];\n    }\n}\n\nexport class RequestExportSvgAction implements Action {\n    kind = ExportSvgCommand.KIND;\n}\n\nexport class ExportSvgCommand extends HiddenCommand {\n    static KIND = 'requestExportSvg';\n\n    execute(context: CommandExecutionContext): SModelRoot {\n        if (isExportable(context.root)) {\n            const root = context.modelFactory.createRoot(context.modelFactory.createSchema(context.root));\n            if (isExportable(root)) {\n                root.export = true;\n                if (isViewport(root)) {\n                    root.zoom = 1;\n                    root.scroll = {\n                        x: 0,\n                        y: 0\n                    };\n                }\n                root.index.all().forEach(element => {\n                    if (isSelectable(element) && element.selected)\n                        element.selected = false;\n                    if (isHoverable(element) && element.hoverFeedback)\n                        element.hoverFeedback = false;\n                });\n                return root;\n            }\n        }\n        return context.modelFactory.createRoot(EMPTY_ROOT);\n    }\n}\n\n@injectable()\nexport class ExportSvgDecorator implements IVNodeDecorator {\n\n    root: SModelRoot;\n\n    constructor(@inject(TYPES.SvgExporter) protected svgExporter: SvgExporter) {\n    }\n\n    decorate(vnode: VNode, element: SModelElement): VNode {\n        if (element instanceof SModelRoot)\n            this.root = element;\n        return vnode;\n    }\n\n    postUpdate(): void {\n        if (this.root && isExportable(this.root) && this.root.export)\n            this.svgExporter.export(this.root);\n    }\n}\n\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { SModelElement } from '../../base/model/smodel';\nimport { SModelExtension } from '../../base/model/smodel-extension';\n\nexport const exportFeature = Symbol('exportFeature');\n\nexport interface Exportable extends SModelExtension {\n    export: boolean\n}\n\nexport function isExportable(element: SModelElement): element is SModelElement & Exportable {\n     return element.hasFeature(exportFeature) && (element as any)['export'] !== undefined;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ViewerOptions } from '../../base/views/viewer-options';\nimport { isBoundsAware } from '../bounds/model';\nimport { Action } from '../../base/actions/action';\nimport { ActionDispatcher } from '../../base/actions/action-dispatcher';\nimport { TYPES } from '../../base/types';\nimport { SModelRoot } from '../../base/model/smodel';\nimport { Bounds, combine, EMPTY_BOUNDS } from '../../utils/geometry';\nimport { ILogger } from '../../utils/logging';\nimport { injectable, inject } from \"inversify\";\n\nexport class ExportSvgAction implements Action {\n    static KIND = 'exportSvg';\n    kind = ExportSvgAction.KIND;\n\n    constructor(public readonly svg: string) {}\n}\n\n@injectable()\nexport class SvgExporter {\n\n    constructor(@inject(TYPES.ViewerOptions) protected options: ViewerOptions,\n                @inject(TYPES.IActionDispatcher) protected actionDispatcher: ActionDispatcher,\n                @inject(TYPES.ILogger) protected log: ILogger) {\n    }\n\n    export(root: SModelRoot): void {\n        if (typeof document !== 'undefined') {\n            const div = document.getElementById(this.options.hiddenDiv);\n            if (div !== null && div.firstElementChild && div.firstElementChild.tagName === 'svg') {\n                const svgElement = div.firstElementChild as SVGSVGElement;\n                const svg = this.createSvg(svgElement, root);\n                this.actionDispatcher.dispatch(new ExportSvgAction(svg));\n            }\n        }\n    }\n\n    protected createSvg(svgElementOrig: SVGSVGElement, root: SModelRoot): string {\n        const serializer = new XMLSerializer();\n        const svgCopy = serializer.serializeToString(svgElementOrig);\n        const iframe: HTMLIFrameElement = document.createElement('iframe');\n        document.body.appendChild(iframe);\n        if (!iframe.contentWindow)\n            throw new Error('IFrame has no contentWindow');\n        const docCopy = iframe.contentWindow.document;\n        docCopy.open();\n        docCopy.write(svgCopy);\n        docCopy.close();\n        const svgElementNew = docCopy.getElementById(svgElementOrig.id)!;\n        svgElementNew.removeAttribute('opacity');\n        this.copyStyles(svgElementOrig, svgElementNew, ['width', 'height', 'opacity']);\n        svgElementNew.setAttribute('version', '1.1');\n        const bounds = this.getBounds(root);\n        svgElementNew.setAttribute('viewBox', `${bounds.x} ${bounds.y} ${bounds.width} ${bounds.height}`);\n        const svgCode = serializer.serializeToString(svgElementNew);\n        document.body.removeChild(iframe);\n        return svgCode;\n    }\n\n    protected copyStyles(source: Element, target: Element, skipedProperties: string[]) {\n        const sourceStyle = getComputedStyle(source);\n        const targetStyle = getComputedStyle(target);\n        let diffStyle = '';\n        for (let i = 0; i < sourceStyle.length; i++) {\n            const key = sourceStyle[i];\n            if (skipedProperties.indexOf(key) === -1) {\n                const value = sourceStyle.getPropertyValue(key);\n                if (targetStyle.getPropertyValue(key) !== value) {\n                    diffStyle += key + \":\" + value + \";\";\n                }\n            }\n        }\n        if (diffStyle !== '')\n            target.setAttribute('style', diffStyle);\n        // IE doesn't retrun anything on source.children\n        for (let i = 0; i < source.childNodes.length; ++i) {\n            const sourceChild = source.childNodes[i];\n            const targetChild = target.childNodes[i];\n            if (sourceChild instanceof Element)\n                this.copyStyles(sourceChild, targetChild as Element, []);\n        }\n    }\n\n    protected getBounds(root: SModelRoot) {\n        const allBounds: Bounds[] = [ EMPTY_BOUNDS ];\n        root.children.forEach(element => {\n            if (isBoundsAware(element)) {\n                allBounds.push(element.bounds);\n            }\n        });\n        return allBounds.reduce((one, two) => combine(one, two));\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from \"inversify\";\nimport { TYPES } from \"../../base/types\";\nimport { ElementFader } from \"./fade\";\n\nconst fadeModule = new ContainerModule(bind => {\n    bind(TYPES.IVNodeDecorator).to(ElementFader).inSingletonScope();\n});\n\nexport default fadeModule;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable } from \"inversify\";\nimport { VNode } from \"snabbdom/vnode\";\nimport { Animation } from \"../../base/animations/animation\";\nimport { CommandExecutionContext } from \"../../base/commands/command\";\nimport { SModelRoot, SModelElement, SChildElement } from \"../../base/model/smodel\";\nimport { IVNodeDecorator } from \"../../base/views/vnode-decorators\";\nimport { setAttr } from \"../../base/views/vnode-utils\";\nimport { Fadeable, isFadeable } from \"./model\";\n\nexport interface ResolvedElementFade {\n    element: SModelElement & Fadeable\n    type: 'in' | 'out'\n}\n\nexport class FadeAnimation extends Animation {\n\n    constructor(protected model: SModelRoot,\n                public elementFades: ResolvedElementFade[],\n                context: CommandExecutionContext,\n                protected removeAfterFadeOut: boolean = false) {\n        super(context);\n    }\n\n    tween(t: number, context: CommandExecutionContext): SModelRoot {\n        for (const elementFade of this.elementFades) {\n            const element = elementFade.element;\n            if (elementFade.type === 'in') {\n                element.opacity = t;\n            } else if (elementFade.type === 'out') {\n                element.opacity = 1 - t;\n                if (t === 1 && this.removeAfterFadeOut && element instanceof SChildElement) {\n                    element.parent.remove(element);\n                }\n            }\n        }\n        return this.model;\n    }\n\n}\n\n@injectable()\nexport class ElementFader implements IVNodeDecorator {\n\n    decorate(vnode: VNode, element: SModelElement): VNode {\n        if (isFadeable(element)) {\n            setAttr(vnode, 'opacity', element.opacity);\n        }\n        return vnode;\n    }\n\n    postUpdate(): void {\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { SModelElement } from \"../../base/model/smodel\";\nimport { SModelExtension } from \"../../base/model/smodel-extension\";\n\nexport const fadeFeature = Symbol('fadeFeature');\n\nexport interface Fadeable extends SModelExtension {\n    opacity: number\n}\n\nexport function isFadeable(element: SModelElement): element is SModelElement & Fadeable {\n    return element.hasFeature(fadeFeature) && (element as any)['opacity'] !== undefined;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from \"inversify\";\nimport { TYPES } from \"../../base/types\";\nimport {\n    HoverMouseListener, PopupHoverMouseListener, HoverFeedbackCommand, SetPopupModelCommand, HoverKeyListener, HoverState\n} from \"./hover\";\nimport { PopupPositionUpdater } from \"./popup-position-updater\";\nimport { PopupActionHandlerInitializer } from \"./initializer\";\n\nconst hoverModule = new ContainerModule(bind => {\n    bind(TYPES.PopupVNodeDecorator).to(PopupPositionUpdater).inSingletonScope();\n    bind(TYPES.IActionHandlerInitializer).to(PopupActionHandlerInitializer);\n    bind(TYPES.ICommand).toConstructor(HoverFeedbackCommand);\n    bind(TYPES.ICommand).toConstructor(SetPopupModelCommand);\n    bind(TYPES.MouseListener).to(HoverMouseListener);\n    bind(TYPES.PopupMouseListener).to(PopupHoverMouseListener);\n    bind(TYPES.KeyListener).to(HoverKeyListener);\n    bind<HoverState>(TYPES.HoverState).toConstantValue({\n        mouseOverTimer: undefined,\n        mouseOutTimer: undefined,\n        popupOpen: false,\n        previousPopupElement: undefined\n    });\n});\n\nexport default hoverModule;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable } from \"inversify\";\nimport { matchesKeystroke } from '../../utils/keyboard';\nimport { Bounds, Point, translate } from \"../../utils/geometry\";\nimport { TYPES } from \"../../base/types\";\nimport { SModelElement, SModelRoot, SModelRootSchema } from \"../../base/model/smodel\";\nimport { MouseListener } from \"../../base/views/mouse-tool\";\nimport { Action } from \"../../base/actions/action\";\nimport { Command, CommandExecutionContext, PopupCommand } from \"../../base/commands/command\";\nimport { EMPTY_ROOT } from \"../../base/model/smodel-factory\";\nimport { KeyListener } from \"../../base/views/key-tool\";\nimport { findParentByFeature, findParent } from \"../../base/model/smodel-utils\";\nimport { ViewerOptions } from \"../../base/views/viewer-options\";\nimport { getAbsoluteBounds } from '../bounds/model';\nimport { hasPopupFeature, isHoverable } from \"./model\";\n\n/**\n * Triggered when the user puts the mouse pointer over an element.\n */\nexport class HoverFeedbackAction implements Action {\n    kind = HoverFeedbackCommand.KIND;\n\n    constructor(public readonly mouseoverElement: string, public readonly mouseIsOver: boolean) {\n    }\n}\n\nexport class HoverFeedbackCommand extends Command {\n    static readonly KIND = 'hoverFeedback';\n\n    constructor(public action: HoverFeedbackAction) {\n        super();\n    }\n\n    execute(context: CommandExecutionContext): SModelRoot {\n\n        const model: SModelRoot = context.root;\n        const modelElement: SModelElement | undefined = model.index.getById(this.action.mouseoverElement);\n\n        if (modelElement) {\n            if (isHoverable(modelElement)) {\n                modelElement.hoverFeedback = this.action.mouseIsOver;\n            }\n        }\n\n        return this.redo(context);\n    }\n\n    undo(context: CommandExecutionContext): SModelRoot {\n        return context.root;\n    }\n\n    redo(context: CommandExecutionContext): SModelRoot {\n        return context.root;\n    }\n}\n\n/**\n * Triggered when the user hovers the mouse pointer over an element to get a popup with details on\n * that element. This action is sent from the client to the model source, e.g. a DiagramServer.\n * The response is a SetPopupModelAction.\n */\nexport class RequestPopupModelAction implements Action {\n    static readonly KIND = 'requestPopupModel';\n    readonly kind = RequestPopupModelAction.KIND;\n\n    constructor(public readonly elementId: string, public readonly bounds: Bounds) {\n    }\n}\n\n/**\n * Sent from the model source to the client to display a popup in response to a RequestPopupModelAction.\n * This action can also be used to remove any existing popup by choosing EMPTY_ROOT as root element.\n */\nexport class SetPopupModelAction implements Action {\n    readonly kind = SetPopupModelCommand.KIND;\n\n    constructor(public readonly newRoot: SModelRootSchema) {\n    }\n}\n\nexport class SetPopupModelCommand extends PopupCommand {\n    static readonly KIND = 'setPopupModel';\n\n    oldRoot: SModelRoot;\n    newRoot: SModelRoot;\n\n    constructor(public action: SetPopupModelAction) {\n        super();\n    }\n\n    execute(context: CommandExecutionContext): SModelRoot {\n        this.oldRoot = context.root;\n        this.newRoot = context.modelFactory.createRoot(this.action.newRoot);\n\n        return this.newRoot;\n    }\n\n    undo(context: CommandExecutionContext): SModelRoot {\n        return this.oldRoot;\n    }\n\n    redo(context: CommandExecutionContext): SModelRoot {\n        return this.newRoot;\n    }\n}\n\nexport interface HoverState {\n    mouseOverTimer: number | undefined\n    mouseOutTimer: number | undefined\n    popupOpen: boolean\n    previousPopupElement: SModelElement | undefined\n}\n\nexport abstract class AbstractHoverMouseListener extends MouseListener {\n    constructor(@inject(TYPES.ViewerOptions) protected options: ViewerOptions,\n                @inject(TYPES.HoverState) protected state: HoverState) {\n        super();\n    }\n\n    protected stopMouseOutTimer(): void {\n        if (this.state.mouseOutTimer !== undefined) {\n            window.clearTimeout(this.state.mouseOutTimer);\n            this.state.mouseOutTimer = undefined;\n        }\n    }\n\n    protected startMouseOutTimer(): Promise<Action> {\n        this.stopMouseOutTimer();\n        return new Promise((resolve) => {\n            this.state.mouseOutTimer = window.setTimeout(() => {\n                this.state.popupOpen = false;\n                this.state.previousPopupElement = undefined;\n                resolve(new SetPopupModelAction({type: EMPTY_ROOT.type, id: EMPTY_ROOT.id}));\n            }, this.options.popupCloseDelay);\n        });\n    }\n\n    protected stopMouseOverTimer(): void {\n        if (this.state.mouseOverTimer !== undefined) {\n            window.clearTimeout(this.state.mouseOverTimer);\n            this.state.mouseOverTimer = undefined;\n        }\n    }\n}\n\n@injectable()\nexport class HoverMouseListener extends AbstractHoverMouseListener {\n\n    protected computePopupBounds(target: SModelElement, mousePosition: Point): Bounds {\n        // Default position: below the mouse cursor\n        let offset: Point = { x: -5, y: 20 };\n\n        const targetBounds = getAbsoluteBounds(target);\n        const canvasBounds = target.root.canvasBounds;\n        const boundsInWindow = translate(targetBounds, canvasBounds);\n        const distRight = boundsInWindow.x + boundsInWindow.width - mousePosition.x;\n        const distBottom = boundsInWindow.y + boundsInWindow.height - mousePosition.y;\n        if (distBottom <= distRight && this.allowSidePosition(target, 'below', distBottom)) {\n            // Put the popup below the target element\n            offset = { x: -5, y: Math.round(distBottom + 5) };\n        } else if (distRight <= distBottom && this.allowSidePosition(target, 'right', distRight)) {\n            // Put the popup right of the target element\n            offset = { x: Math.round(distRight + 5), y: -5 };\n        }\n        let leftPopupPosition = mousePosition.x + offset.x;\n        const canvasRightBorderPosition = canvasBounds.x + canvasBounds.width;\n        if (leftPopupPosition > canvasRightBorderPosition) {\n            leftPopupPosition = canvasRightBorderPosition;\n        }\n        let topPopupPosition = mousePosition.y + offset.y;\n        const canvasBottomBorderPosition = canvasBounds.y + canvasBounds.height;\n        if (topPopupPosition > canvasBottomBorderPosition) {\n            topPopupPosition = canvasBottomBorderPosition;\n        }\n        return { x: leftPopupPosition, y: topPopupPosition, width: -1, height: -1 };\n    }\n\n    protected allowSidePosition(target: SModelElement, side: 'above' | 'below' | 'left' | 'right', distance: number): boolean {\n        return !(target instanceof SModelRoot) && distance <= 150;\n    }\n\n    protected startMouseOverTimer(target: SModelElement, event: MouseEvent): Promise<Action> {\n        this.stopMouseOverTimer();\n        return new Promise((resolve) => {\n            this.state.mouseOverTimer = window.setTimeout(() => {\n                const popupBounds = this.computePopupBounds(target, {x: event.pageX, y: event.pageY});\n                resolve(new RequestPopupModelAction(target.id, popupBounds));\n\n                this.state.popupOpen = true;\n                this.state.previousPopupElement = target;\n            }, this.options.popupOpenDelay);\n        });\n    }\n\n    mouseOver(target: SModelElement, event: MouseEvent): (Action | Promise<Action>)[] {\n        const result: (Action | Promise<Action>)[] = [];\n        const popupTarget = findParent(target, hasPopupFeature);\n\n        if (this.state.popupOpen && (popupTarget === undefined ||\n            this.state.previousPopupElement !== undefined && this.state.previousPopupElement.id !== popupTarget.id)) {\n            result.push(this.startMouseOutTimer());\n        } else {\n            this.stopMouseOverTimer();\n            this.stopMouseOutTimer();\n        }\n        if (popupTarget !== undefined &&\n            (this.state.previousPopupElement === undefined || this.state.previousPopupElement.id !== popupTarget.id)) {\n            result.push(this.startMouseOverTimer(popupTarget, event));\n        }\n\n        const hoverTarget = findParentByFeature(target, isHoverable);\n        if (hoverTarget !== undefined)\n            result.push(new HoverFeedbackAction(hoverTarget.id, true));\n\n        return result;\n    }\n\n    mouseOut(target: SModelElement, event: MouseEvent): (Action | Promise<Action>)[] {\n        const result: (Action | Promise<Action>)[] = [];\n\n        if (this.state.popupOpen) {\n            const popupTarget = findParent(target, hasPopupFeature);\n            if (this.state.previousPopupElement !== undefined && popupTarget !== undefined\n                && this.state.previousPopupElement.id === popupTarget.id)\n                result.push(this.startMouseOutTimer());\n        }\n        this.stopMouseOverTimer();\n\n        const hoverTarget = findParentByFeature(target, isHoverable);\n        if (hoverTarget !== undefined)\n            result.push(new HoverFeedbackAction(hoverTarget.id, false));\n\n        return result;\n    }\n\n    mouseMove(target: SModelElement, event: MouseEvent): (Action | Promise<Action>)[] {\n        const result: (Action | Promise<Action>)[] = [];\n\n        if (this.state.previousPopupElement !== undefined && this.closeOnMouseMove(this.state.previousPopupElement, event)) {\n            result.push(this.startMouseOutTimer());\n        }\n\n        const popupTarget = findParent(target, hasPopupFeature);\n        if (popupTarget !== undefined && (this.state.previousPopupElement === undefined\n            || this.state.previousPopupElement.id !== popupTarget.id)) {\n            result.push(this.startMouseOverTimer(popupTarget, event));\n        }\n\n        return result;\n    }\n\n    protected closeOnMouseMove(target: SModelElement, event: MouseEvent): boolean {\n        return target instanceof SModelRoot;\n    }\n\n}\n\n@injectable()\nexport class PopupHoverMouseListener extends AbstractHoverMouseListener {\n\n    mouseOut(target: SModelElement, event: MouseEvent): (Action | Promise<Action>)[] {\n        return [this.startMouseOutTimer()];\n    }\n\n    mouseOver(target: SModelElement, event: MouseEvent): (Action | Promise<Action>)[] {\n        this.stopMouseOutTimer();\n        this.stopMouseOverTimer();\n        return [];\n    }\n}\n\nexport class HoverKeyListener extends KeyListener {\n    keyDown(element: SModelElement, event: KeyboardEvent): Action[] {\n        if (matchesKeystroke(event, 'Escape')) {\n            return [new SetPopupModelAction({type: EMPTY_ROOT.type, id: EMPTY_ROOT.id})];\n        }\n        return [];\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable } from \"inversify\";\nimport { ActionHandlerRegistry, IActionHandler, IActionHandlerInitializer } from \"../../base/actions/action-handler\";\nimport { Action } from \"../../base/actions/action\";\nimport { ICommand } from \"../../base/commands/command\";\nimport { SetPopupModelAction, SetPopupModelCommand } from \"./hover\";\nimport { EMPTY_ROOT } from \"../../base/model/smodel-factory\";\nimport { CenterCommand, FitToScreenCommand } from \"../viewport/center-fit\";\nimport { ViewportCommand } from \"../viewport/viewport\";\nimport { MoveCommand } from \"../move/move\";\n\nclass ClosePopupActionHandler implements IActionHandler {\n    protected popupOpen: boolean = false;\n\n    handle(action: Action): void | ICommand | Action {\n        if (action.kind === SetPopupModelCommand.KIND) {\n            this.popupOpen = (action as SetPopupModelAction).newRoot.type !== EMPTY_ROOT.type;\n        } else if (this.popupOpen) {\n            return new SetPopupModelAction({id: EMPTY_ROOT.id, type: EMPTY_ROOT.type});\n        }\n    }\n}\n\n@injectable()\nexport class PopupActionHandlerInitializer implements IActionHandlerInitializer {\n    initialize(registry: ActionHandlerRegistry): void {\n        const closePopupActionHandler = new ClosePopupActionHandler();\n        registry.register(FitToScreenCommand.KIND, closePopupActionHandler);\n        registry.register(CenterCommand.KIND, closePopupActionHandler);\n        registry.register(ViewportCommand.KIND, closePopupActionHandler);\n        registry.register(SetPopupModelCommand.KIND, closePopupActionHandler);\n        registry.register(MoveCommand.KIND, closePopupActionHandler);\n    }\n\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { SModelElement } from \"../../base/model/smodel\";\nimport { SModelExtension } from \"../../base/model/smodel-extension\";\n\nexport const hoverFeedbackFeature = Symbol('hoverFeedbackFeature');\n\nexport interface Hoverable extends SModelExtension {\n    hoverFeedback: boolean\n}\n\nexport function isHoverable(element: SModelElement): element is SModelElement & Hoverable {\n    return element.hasFeature(hoverFeedbackFeature);\n}\n\nexport const popupFeature = Symbol('popupFeature');\n\nexport function hasPopupFeature(element: SModelElement): boolean {\n    return element.hasFeature(popupFeature);\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable } from \"inversify\";\nimport { VNode } from \"snabbdom/vnode\";\nimport { TYPES } from \"../../base/types\";\nimport { IVNodeDecorator } from \"../../base/views/vnode-decorators\";\nimport { ViewerOptions } from \"../../base/views/viewer-options\";\nimport { SModelElement } from \"../../base/model/smodel\";\n\n@injectable()\nexport class PopupPositionUpdater implements IVNodeDecorator {\n\n    constructor(@inject(TYPES.ViewerOptions) protected options: ViewerOptions) {\n\n    }\n\n    decorate(vnode: VNode, element: SModelElement): VNode {\n        return vnode;\n    }\n\n    postUpdate(): void {\n        const popupDiv = document.getElementById(this.options.popupDiv);\n        if (popupDiv !== null && typeof window !== 'undefined') {\n            const boundingClientRect = popupDiv.getBoundingClientRect();\n            if (window.innerHeight < boundingClientRect.height + boundingClientRect.top) {\n                popupDiv.style.top = (window.scrollY + window.innerHeight - boundingClientRect.height - 5) + 'px';\n            }\n\n            if (window.innerWidth < boundingClientRect.left + boundingClientRect.width) {\n                popupDiv.style.left = (window.scrollX + window.innerWidth - boundingClientRect.width - 5) + 'px';\n            }\n\n            if (boundingClientRect.left < 0) {\n                popupDiv.style.left = '0px';\n            }\n\n            if (boundingClientRect.top < 0) {\n                popupDiv.style.top = '0px';\n            }\n        }\n    }\n\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from \"inversify\";\nimport { TYPES } from '../../base/types';\nimport { MoveCommand, MoveMouseListener, LocationDecorator } from './move';\n\nconst moveModule = new ContainerModule(bind => {\n    bind(TYPES.MouseListener).to(MoveMouseListener);\n    bind(TYPES.ICommand).toConstructor(MoveCommand);\n    bind(TYPES.IVNodeDecorator).to(LocationDecorator);\n    bind(TYPES.HiddenVNodeDecorator).to(LocationDecorator);\n});\n\nexport default moveModule;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Point } from \"../../utils/geometry\";\nimport { SModelElement } from \"../../base/model/smodel\";\nimport { SModelExtension } from \"../../base/model/smodel-extension\";\n\nexport const moveFeature = Symbol('moveFeature');\n\n/**\n * An element that can be placed at a specific location using its position\n * property.\n */\nexport interface Locateable extends SModelExtension {\n    position: Point\n}\n\nexport function isLocateable(element: SModelElement): element is SModelElement & Locateable {\n    return (element as any)['position'] !== undefined;\n}\n\nexport function isMoveable(element: SModelElement): element is SModelElement & Locateable {\n    return element.hasFeature(moveFeature) && isLocateable(element);\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable } from \"inversify\";\nimport { Point, centerOfLine } from '../../utils/geometry';\nimport { SChildElement } from '../../base/model/smodel';\nimport { VNode } from \"snabbdom/vnode\";\nimport { SModelElement, SModelIndex, SModelRoot } from \"../../base/model/smodel\";\nimport { findParentByFeature } from \"../../base/model/smodel-utils\";\nimport { Action } from \"../../base/actions/action\";\nimport { ICommand, CommandExecutionContext, MergeableCommand } from \"../../base/commands/command\";\nimport { Animation } from \"../../base/animations/animation\";\nimport { MouseListener } from \"../../base/views/mouse-tool\";\nimport { setAttr } from \"../../base/views/vnode-utils\";\nimport { IVNodeDecorator } from \"../../base/views/vnode-decorators\";\nimport { isViewport } from \"../viewport/model\";\nimport { isSelectable } from \"../select/model\";\nimport { isAlignable } from \"../bounds/model\";\nimport { Routable, isRoutable, SRoutingHandle } from '../edit/model';\nimport { MoveRoutingHandleAction, HandleMove, SwitchEditModeAction } from \"../edit/edit-routing\";\nimport { isMoveable, Locateable, isLocateable } from './model';\nimport { RoutedPoint } from \"../../graph/routing\";\n\nexport class MoveAction implements Action {\n    kind = MoveCommand.KIND;\n\n    constructor(public readonly moves: ElementMove[],\n                public readonly animate: boolean = true) {\n    }\n}\n\nexport interface ElementMove {\n    elementId: string\n    fromPosition?: Point\n    toPosition: Point\n}\n\nexport interface ResolvedElementMove {\n    elementId: string\n    element: SModelElement & Locateable\n    fromPosition: Point\n    toPosition: Point\n}\n\nexport interface ResolvedElementRoute {\n    elementId: string\n    element: SModelElement & Routable\n    fromRoute: Point[]\n    toRoute: Point[]\n}\n\nexport class MoveCommand extends MergeableCommand {\n    static readonly KIND = 'move';\n\n    resolvedMoves: Map<string, ResolvedElementMove> = new Map;\n    resolvedRoutes: Map<string, ResolvedElementRoute> = new Map;\n\n    constructor(protected action: MoveAction) {\n        super();\n    }\n\n    execute(context: CommandExecutionContext) {\n        const model = context.root;\n        const attachedElements: Set<SModelElement> = new Set;\n        this.action.moves.forEach(move => {\n            const resolvedMove = this.resolve(move, model.index);\n            if (resolvedMove !== undefined) {\n                this.resolvedMoves.set(resolvedMove.elementId, resolvedMove);\n                model.index.getAttachedElements(resolvedMove.element).forEach(e => attachedElements.add(e));\n            }\n        });\n        attachedElements.forEach(element => this.handleAttachedElement(element));\n        if (this.action.animate) {\n            return new MoveAnimation(model, this.resolvedMoves, this.resolvedRoutes, context).start();\n        } else {\n            return this.doMove(context);\n        }\n    }\n\n    protected resolve(move: ElementMove, index: SModelIndex<SModelElement>): ResolvedElementMove | undefined {\n        const element = index.getById(move.elementId);\n        if (element !== undefined && isLocateable(element)) {\n            const fromPosition = move.fromPosition || { x: element.position.x, y: element.position.y };\n            return {\n                elementId: move.elementId,\n                element: element,\n                fromPosition: fromPosition,\n                toPosition: move.toPosition\n            };\n        }\n        return undefined;\n    }\n\n    protected handleAttachedElement(element: SModelElement): void {\n        if (isRoutable(element)) {\n            const source = element.source;\n            const sourceMove = source ? this.resolvedMoves.get(source.id) : undefined;\n            const target = element.target;\n            const targetMove = target ? this.resolvedMoves.get(target.id) : undefined;\n            if (sourceMove !== undefined && targetMove !== undefined) {\n                const deltaX = targetMove.toPosition.x - targetMove.fromPosition.x;\n                const deltaY = targetMove.toPosition.y - targetMove.fromPosition.y;\n                this.resolvedRoutes.set(element.id, {\n                    elementId: element.id,\n                    element,\n                    fromRoute: element.routingPoints,\n                    toRoute: element.routingPoints.map(rp => ({\n                        x: rp.x + deltaX,\n                        y: rp.y + deltaY\n                    }))\n                });\n            }\n        }\n    }\n\n    protected doMove(context: CommandExecutionContext, reverse?: boolean): SModelRoot {\n        this.resolvedMoves.forEach(res => {\n            if (reverse)\n                res.element.position = res.fromPosition;\n            else\n                res.element.position = res.toPosition;\n        });\n        this.resolvedRoutes.forEach(res => {\n            if (reverse)\n                res.element.routingPoints = res.fromRoute;\n            else\n                res.element.routingPoints = res.toRoute;\n        });\n        return context.root;\n    }\n\n    undo(context: CommandExecutionContext) {\n        return new MoveAnimation(context.root, this.resolvedMoves, this.resolvedRoutes, context, true).start();\n    }\n\n    redo(context: CommandExecutionContext) {\n        return new MoveAnimation(context.root, this.resolvedMoves, this.resolvedRoutes, context, false).start();\n    }\n\n    merge(command: ICommand, context: CommandExecutionContext) {\n        if (!this.action.animate && command instanceof MoveCommand) {\n            command.action.moves.forEach(\n                otherMove => {\n                    const existingMove = this.resolvedMoves.get(otherMove.elementId);\n                    if (existingMove) {\n                        existingMove.toPosition = otherMove.toPosition;\n                    } else {\n                        const resolvedMove = this.resolve(otherMove, context.root.index);\n                        if (resolvedMove)\n                            this.resolvedMoves.set(resolvedMove.elementId, resolvedMove);\n                    }\n                }\n            );\n            return true;\n        }\n        return false;\n    }\n}\n\nexport class MoveAnimation extends Animation {\n\n    constructor(protected model: SModelRoot,\n                public elementMoves: Map<string, ResolvedElementMove>,\n                public elementRoutes: Map<string, ResolvedElementRoute>,\n                context: CommandExecutionContext,\n                protected reverse: boolean = false) {\n        super(context);\n    }\n\n    tween(t: number) {\n        this.elementMoves.forEach((elementMove) => {\n            if (this.reverse) {\n                elementMove.element.position = {\n                    x: (1 - t) * elementMove.toPosition.x + t * elementMove.fromPosition.x,\n                    y: (1 - t) * elementMove.toPosition.y + t * elementMove.fromPosition.y\n                };\n            } else {\n                elementMove.element.position = {\n                    x: (1 - t) * elementMove.fromPosition.x + t * elementMove.toPosition.x,\n                    y: (1 - t) * elementMove.fromPosition.y + t * elementMove.toPosition.y\n                };\n            }\n        });\n        this.elementRoutes.forEach(elementRoute => {\n            const route: Point[] = [];\n            for (let i = 0; i < elementRoute.fromRoute.length && i < elementRoute.toRoute.length; i++) {\n                const fp = elementRoute.fromRoute[i];\n                const tp = elementRoute.toRoute[i];\n                if (this.reverse) {\n                    route.push({\n                        x: (1 - t) * tp.x + t * fp.x,\n                        y: (1 - t) * tp.y + t * fp.y\n                    });\n                } else {\n                    route.push({\n                        x: (1 - t) * fp.x + t * tp.x,\n                        y: (1 - t) * fp.y + t * tp.y\n                    });\n                }\n            }\n            elementRoute.element.routingPoints = route;\n        });\n        return this.model;\n    }\n}\n\nexport class MoveMouseListener extends MouseListener {\n\n    hasDragged = false;\n    lastDragPosition: Point | undefined;\n\n    mouseDown(target: SModelElement, event: MouseEvent): Action[] {\n        const result: Action[] = [];\n        if (event.button === 0) {\n            const moveable = findParentByFeature(target, isMoveable);\n            const isRoutingHandle = target instanceof SRoutingHandle;\n            if (moveable !== undefined || isRoutingHandle) {\n                this.lastDragPosition = { x: event.pageX, y: event.pageY };\n            } else {\n                this.lastDragPosition = undefined;\n            }\n            this.hasDragged = false;\n            if (isRoutingHandle) {\n                result.push(new SwitchEditModeAction([target.id], []));\n            }\n        }\n        return result;\n    }\n\n    mouseMove(target: SModelElement, event: MouseEvent): Action[] {\n        const result: Action[] = [];\n        if (event.buttons === 0)\n            this.mouseUp(target, event);\n        else if (this.lastDragPosition) {\n            const viewport = findParentByFeature(target, isViewport);\n            this.hasDragged = true;\n            const zoom = viewport ? viewport.zoom : 1;\n            const dx = (event.pageX - this.lastDragPosition.x) / zoom;\n            const dy = (event.pageY - this.lastDragPosition.y) / zoom;\n            const nodeMoves: ElementMove[] = [];\n            const handleMoves: HandleMove[] = [];\n            target.root.index.all()\n                .filter(element => isSelectable(element) && element.selected)\n                .forEach(element => {\n                    if (isMoveable(element)) {\n                        nodeMoves.push({\n                            elementId: element.id,\n                            fromPosition: {\n                                x: element.position.x,\n                                y: element.position.y\n                            },\n                            toPosition: {\n                                x: element.position.x + dx,\n                                y: element.position.y + dy\n                            }\n                        });\n                    } else if (element instanceof SRoutingHandle) {\n                        const point = this.getHandlePosition(element);\n                        if (point !== undefined) {\n                            handleMoves.push({\n                                elementId: element.id,\n                                fromPosition: point,\n                                toPosition: {\n                                    x: point.x + dx,\n                                    y: point.y + dy\n                                }\n                            });\n                        }\n                    }\n                });\n            this.lastDragPosition = { x: event.pageX, y: event.pageY };\n            if (nodeMoves.length > 0)\n                result.push(new MoveAction(nodeMoves, false));\n            if (handleMoves.length > 0)\n                result.push(new MoveRoutingHandleAction(handleMoves, false));\n        }\n        return result;\n    }\n\n    protected getHandlePosition(handle: SRoutingHandle): Point | undefined {\n        const parent = handle.parent;\n        if (!isRoutable(parent)) {\n            return undefined;\n        }\n        if (handle.kind === 'line') {\n            const getIndex = (rp: RoutedPoint) => {\n                if (rp.pointIndex !== undefined)\n                    return rp.pointIndex;\n                else if (rp.kind === 'target')\n                    return parent.routingPoints.length;\n                else\n                    return -1;\n            };\n            const route = parent.route();\n            let rp1, rp2: RoutedPoint | undefined;\n            for (const rp of route) {\n                const i = getIndex(rp);\n                if (i <= handle.pointIndex && (rp1 === undefined || i > getIndex(rp1)))\n                    rp1 = rp;\n                if (i > handle.pointIndex && (rp2 === undefined || i < getIndex(rp2)))\n                    rp2 = rp;\n            }\n            if (rp1 !== undefined && rp2 !== undefined) {\n                return centerOfLine(rp1, rp2);\n            }\n        } else if (handle.pointIndex >= 0) {\n            return parent.routingPoints[handle.pointIndex];\n        }\n        return undefined;\n    }\n\n    mouseEnter(target: SModelElement, event: MouseEvent): Action[] {\n        if (target instanceof SModelRoot && event.buttons === 0)\n            this.mouseUp(target, event);\n        return [];\n    }\n\n    mouseUp(target: SModelElement, event: MouseEvent): Action[] {\n        const result: Action[] = [];\n        if (this.lastDragPosition) {\n            target.root.index.all()\n                .forEach(element => {\n                    if (element instanceof SRoutingHandle && element.editMode)\n                        result.push(new SwitchEditModeAction([], [element.id]));\n                });\n        }\n        this.hasDragged = false;\n        this.lastDragPosition = undefined;\n        return result;\n    }\n\n    decorate(vnode: VNode, element: SModelElement): VNode {\n        return vnode;\n    }\n}\n\n@injectable()\nexport class LocationDecorator implements IVNodeDecorator {\n\n    decorate(vnode: VNode, element: SModelElement): VNode {\n        let translate: string  = '';\n        if (isLocateable(element) && element instanceof SChildElement && element.parent !== undefined) {\n            translate = 'translate(' + element.position.x + ', ' + element.position.y + ')';\n        }\n        if (isAlignable(element)) {\n            if (translate.length > 0)\n                translate += ' ';\n            translate += 'translate('  + element.alignment.x + ', ' + element.alignment.y + ')';\n        }\n        if (translate.length > 0)\n            setAttr(vnode, 'transform', translate);\n        return vnode;\n    }\n\n    postUpdate(): void {\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from \"inversify\";\nimport { TYPES } from \"../../base/types\";\nimport { OpenMouseListener } from \"./open\";\n\nconst openModule = new ContainerModule(bind => {\n    bind(TYPES.MouseListener).to(OpenMouseListener);\n});\n\nexport default openModule;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { SModelElement } from \"../../base/model/smodel\";\n\nexport const openFeature = Symbol('openFeature');\n\nexport function isOpenable(element: SModelElement): element is SModelElement  {\n    return element.hasFeature(openFeature);\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { MouseListener } from '../../base/views/mouse-tool';\nimport { Action } from '../../base/actions/action';\nimport { SModelElement } from '../../base/model/smodel';\nimport { findParentByFeature } from '../../base/model/smodel-utils';\nimport { isOpenable } from './model';\n\nexport class OpenAction {\n    static KIND = 'open';\n    kind = OpenAction.KIND;\n    constructor(public readonly elementId: string) {}\n}\n\nexport class OpenMouseListener extends MouseListener {\n    doubleClick(target: SModelElement, event: WheelEvent): (Action | Promise<Action>)[] {\n        const openableTarget = findParentByFeature(target, isOpenable);\n        if (openableTarget !== undefined) {\n            return [ new OpenAction(openableTarget.id) ];\n        }\n        return [];\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from \"inversify\";\nimport { TYPES } from \"../../base/types\";\nimport { SelectCommand, SelectAllCommand, SelectKeyboardListener, SelectMouseListener } from \"./select\";\n\nconst selectModule = new ContainerModule(bind => {\n    bind(TYPES.ICommand).toConstructor(SelectCommand);\n    bind(TYPES.ICommand).toConstructor(SelectAllCommand);\n    bind(TYPES.KeyListener).to(SelectKeyboardListener);\n    bind(TYPES.MouseListener).to(SelectMouseListener);\n});\n\nexport default selectModule;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { SModelElement } from \"../../base/model/smodel\";\nimport { SModelExtension } from \"../../base/model/smodel-extension\";\n\nexport const selectFeature = Symbol('selectFeature');\n\nexport interface Selectable extends SModelExtension {\n    selected: boolean\n}\n\nexport function isSelectable(element: SModelElement): element is SModelElement & Selectable {\n    return element.hasFeature(selectFeature);\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, optional } from 'inversify';\nimport { VNode } from \"snabbdom/vnode\";\nimport { isCtrlOrCmd } from \"../../utils/browser\";\nimport { matchesKeystroke } from \"../../utils/keyboard\";\nimport { toArray } from '../../utils/iterable';\nimport { SChildElement, SModelElement, SModelRoot, SParentElement } from '../../base/model/smodel';\nimport { findParentByFeature } from \"../../base/model/smodel-utils\";\nimport { Action } from \"../../base/actions/action\";\nimport { Command, CommandExecutionContext } from \"../../base/commands/command\";\nimport { MouseListener } from \"../../base/views/mouse-tool\";\nimport { KeyListener } from \"../../base/views/key-tool\";\nimport { setClass } from \"../../base/views/vnode-utils\";\nimport { ButtonHandlerRegistry } from '../button/button-handler';\nimport { SButton } from '../button/model';\nimport { isRoutable, SRoutingHandle } from '../edit/model';\nimport { SwitchEditModeAction } from '../edit/edit-routing';\nimport { isSelectable } from \"./model\";\n\n/**\n * Triggered when the user changes the selection, e.g. by clicking on a selectable element. The resulting\n * SelectCommand changes the `selected` state accordingly, so the elements can be rendered differently.\n * This action is also forwarded to the diagram server, if present, so it may react on the selection change.\n * Furthermore, the server can send such an action to the client in order to change the selection programmatically.\n */\nexport class SelectAction implements Action {\n    kind = SelectCommand.KIND;\n\n    constructor(public readonly selectedElementsIDs: string[] = [],\n                public readonly deselectedElementsIDs: string[] = []) {\n    }\n}\n\n/**\n * Programmatic action for selecting or deselecting all elements.\n */\nexport class SelectAllAction implements Action {\n    kind = SelectAllCommand.KIND;\n\n    /**\n     * If `select` is true, all elements are selected, othewise they are deselected.\n     */\n    constructor(public readonly select: boolean = true) {\n    }\n}\n\nexport type ElementSelection = {\n    element: SChildElement\n    parent: SParentElement\n    index: number\n};\n\nexport class SelectCommand extends Command {\n    static readonly KIND = 'elementSelected';\n\n    protected selected: ElementSelection[] = [];\n    protected deselected: ElementSelection[] = [];\n\n    constructor(public action: SelectAction) {\n        super();\n    }\n\n    execute(context: CommandExecutionContext): SModelRoot {\n        const model = context.root;\n        this.action.selectedElementsIDs.forEach(id => {\n            const element = model.index.getById(id);\n            if (element instanceof SChildElement && isSelectable(element)) {\n                this.selected.push({\n                    element,\n                    parent: element.parent,\n                    index: element.parent.children.indexOf(element)\n                });\n            }\n        });\n        this.action.deselectedElementsIDs.forEach(id => {\n            const element = model.index.getById(id);\n            if (element instanceof SChildElement && isSelectable(element)) {\n                this.deselected.push({\n                    element,\n                    parent: element.parent,\n                    index: element.parent.children.indexOf(element)\n                });\n            }\n        });\n        return this.redo(context);\n    }\n\n    undo(context: CommandExecutionContext): SModelRoot {\n        for (let i = this.selected.length - 1; i >= 0; --i) {\n            const selection = this.selected[i];\n            const element = selection.element;\n            if (isSelectable(element))\n                element.selected = false;\n            selection.parent.move(element, selection.index);\n        }\n        this.deselected.reverse().forEach(selection => {\n            if (isSelectable(selection.element))\n                selection.element.selected = true;\n        });\n        return context.root;\n    }\n\n    redo(context: CommandExecutionContext): SModelRoot {\n        for (let i = 0; i < this.selected.length; ++i) {\n            const selection = this.selected[i];\n            const element = selection.element;\n            const childrenLength = selection.parent.children.length;\n            selection.parent.move(element, childrenLength - 1);\n        }\n        this.deselected.forEach(selection => {\n            if (isSelectable(selection.element))\n                selection.element.selected = false;\n        });\n        this.selected.forEach(selection => {\n            if (isSelectable(selection.element))\n                selection.element.selected = true;\n        });\n        return context.root;\n    }\n}\n\nexport class SelectAllCommand extends Command {\n    static readonly KIND = 'allSelected';\n\n    protected previousSelection: Record<string, boolean> = {};\n\n    constructor(public action: SelectAllAction) {\n        super();\n    }\n\n    execute(context: CommandExecutionContext): SModelRoot {\n        this.selectAll(context.root, this.action.select);\n        return context.root;\n    }\n\n    protected selectAll(element: SParentElement, newState: boolean): void {\n        if (isSelectable(element)) {\n            this.previousSelection[element.id] = element.selected;\n            element.selected = newState;\n        }\n        for (const child of element.children) {\n            this.selectAll(child, newState);\n        }\n    }\n\n    undo(context: CommandExecutionContext): SModelRoot {\n        const index = context.root.index;\n        for (const id in this.previousSelection) {\n            if (this.previousSelection.hasOwnProperty(id)) {\n                const element = index.getById(id);\n                if (element !== undefined && isSelectable(element))\n                    element.selected = this.previousSelection[id];\n            }\n        }\n        return context.root;\n    }\n\n    redo(context: CommandExecutionContext): SModelRoot {\n        this.selectAll(context.root, this.action.select);\n        return context.root;\n    }\n}\n\nexport class SelectMouseListener extends MouseListener {\n\n    constructor(@inject(ButtonHandlerRegistry)@optional() protected buttonHandlerRegistry: ButtonHandlerRegistry) {\n        super();\n    }\n\n    wasSelected = false;\n    hasDragged = false;\n\n    mouseDown(target: SModelElement, event: MouseEvent): Action[] {\n        const result: Action[] = [];\n        if (event.button === 0) {\n            if (this.buttonHandlerRegistry !== undefined && target instanceof SButton && target.enabled) {\n                const buttonHandler = this.buttonHandlerRegistry.get(target.type);\n                if (buttonHandler !== undefined)\n                    return buttonHandler.buttonPressed(target);\n            }\n            const selectableTarget = findParentByFeature(target, isSelectable);\n            if (selectableTarget !== undefined || target instanceof SModelRoot) {\n                this.hasDragged = false;\n                let deselect: SModelElement[] = [];\n                // multi-selection?\n                if (!isCtrlOrCmd(event)) {\n                    deselect = toArray(target.root.index.all()\n                        .filter(element => isSelectable(element) && element.selected\n                            && !(selectableTarget instanceof SRoutingHandle && element === selectableTarget.parent as SModelElement)));\n                }\n                if (selectableTarget !== undefined) {\n                    if (!selectableTarget.selected) {\n                        this.wasSelected = false;\n                        result.push(new SelectAction([selectableTarget.id], deselect.map(e => e.id)));\n                        const routableDeselect = deselect.filter(e => isRoutable(e)).map(e => e.id);\n                        if (isRoutable(selectableTarget))\n                            result.push(new SwitchEditModeAction([selectableTarget.id], routableDeselect));\n                        else if (routableDeselect.length > 0)\n                            result.push(new SwitchEditModeAction([], routableDeselect));\n                    } else if (isCtrlOrCmd(event)) {\n                        this.wasSelected = false;\n                        result.push(new SelectAction([], [selectableTarget.id]));\n                        if (isRoutable(selectableTarget))\n                            result.push(new SwitchEditModeAction([], [selectableTarget.id]));\n                    } else {\n                        this.wasSelected = true;\n                    }\n                } else {\n                    result.push(new SelectAction([], deselect.map(e => e.id)));\n                    const routableDeselect = deselect.filter(e => isRoutable(e)).map(e => e.id);\n                    if (routableDeselect.length > 0)\n                        result.push(new SwitchEditModeAction([], routableDeselect));\n                }\n            }\n        }\n        return result;\n    }\n\n    mouseMove(target: SModelElement, event: MouseEvent): Action[] {\n        this.hasDragged = true;\n        return [];\n    }\n\n    mouseUp(target: SModelElement, event: MouseEvent): Action[] {\n        if (event.button === 0) {\n            if (!this.hasDragged) {\n                const selectableTarget = findParentByFeature(target, isSelectable);\n                if (selectableTarget !== undefined && this.wasSelected) {\n                    return [new SelectAction([selectableTarget.id], [])];\n                }\n            }\n        }\n        this.hasDragged = false;\n        return [];\n    }\n\n    decorate(vnode: VNode, element: SModelElement): VNode {\n        const selectableTarget = findParentByFeature(element, isSelectable);\n        if (selectableTarget !== undefined)\n            setClass(vnode, 'selected', selectableTarget.selected);\n        return vnode;\n    }\n}\n\nexport class SelectKeyboardListener extends KeyListener {\n    keyDown(element: SModelElement, event: KeyboardEvent): Action[] {\n        if (matchesKeystroke(event, 'KeyA', 'ctrlCmd')) {\n            const selected = toArray(element.root.index.all().filter(e => isSelectable(e)).map(e => e.id));\n            return [new SelectAction(selected, [])];\n        }\n        return [];\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from \"inversify\";\nimport { TYPES } from \"../../base/types\";\nimport { UndoRedoKeyListener } from \"./undo-redo\";\n\nconst undoRedoModule = new ContainerModule(bind => {\n    bind(TYPES.KeyListener).to(UndoRedoKeyListener);\n});\n\nexport default undoRedoModule;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { matchesKeystroke } from \"../../utils/keyboard\";\nimport { Action } from \"../../base/actions/action\";\nimport { KeyListener } from \"../../base/views/key-tool\";\nimport { SModelElement } from \"../../base/model/smodel\";\n\nexport class UndoAction implements Action {\n    static readonly KIND = 'undo';\n    kind = UndoAction.KIND;\n}\n\nexport class RedoAction implements Action {\n    static readonly KIND = 'redo';\n    kind = RedoAction.KIND;\n}\n\nexport class UndoRedoKeyListener extends KeyListener {\n    keyDown(element: SModelElement, event: KeyboardEvent): Action[] {\n        if (matchesKeystroke(event, 'KeyZ', 'ctrlCmd'))\n            return [new UndoAction];\n        if (matchesKeystroke(event, 'KeyZ', 'ctrlCmd', 'shift'))\n            return [new RedoAction];\n        return [];\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { SModelRootSchema, SModelElementSchema, SModelRoot, SModelIndex, SModelElement, isParent } from '../../base/model/smodel';\n\nexport interface Match {\n    left?: SModelElementSchema\n    right?: SModelElementSchema\n    leftParentId?: string\n    rightParentId?: string\n}\n\nexport interface MatchResult {\n    [id: string]: Match\n}\n\nexport function forEachMatch(matchResult: MatchResult, callback: (id: string, match: Match) => void): void {\n    for (const id in matchResult) {\n        if (matchResult.hasOwnProperty(id))\n            callback(id, matchResult[id]);\n    }\n}\n\nexport class ModelMatcher {\n    match(left: SModelRootSchema | SModelRoot, right: SModelRootSchema | SModelRoot): MatchResult {\n        const result: MatchResult = {};\n        this.matchLeft(left, result);\n        this.matchRight(right, result);\n        return result;\n    }\n\n    protected matchLeft(element: SModelElementSchema | SModelElement, result: MatchResult, parentId?: string): void {\n        let match = result[element.id];\n        if (match !== undefined) {\n            match.left = element;\n            match.leftParentId = parentId;\n        } else {\n            match = {\n                left: element,\n                leftParentId: parentId\n            };\n            result[element.id] = match;\n        }\n        if (isParent(element)) {\n            for (const child of element.children) {\n                this.matchLeft(child, result, element.id);\n            }\n        }\n    }\n\n    protected matchRight(element: SModelElementSchema | SModelElement, result: MatchResult, parentId?: string) {\n        let match = result[element.id];\n        if (match !== undefined) {\n            match.right = element;\n            match.rightParentId = parentId;\n        } else {\n            match = {\n                right: element,\n                rightParentId: parentId\n            };\n            result[element.id] = match;\n        }\n        if (isParent(element)) {\n            for (const child of element.children) {\n                this.matchRight(child, result, element.id);\n            }\n        }\n    }\n}\n\nexport function applyMatches(root: SModelRootSchema, matches: Match[]): void {\n    let index: SModelIndex<SModelElementSchema>;\n    if (root instanceof SModelRoot) {\n        index = root.index;\n    } else {\n        index = new SModelIndex();\n        index.add(root);\n    }\n    for (const match of matches) {\n        let newElementInserted = false;\n        if (match.left !== undefined && match.leftParentId !== undefined) {\n            const parent = index.getById(match.leftParentId);\n            if (parent !== undefined && parent.children !== undefined) {\n                const i = parent.children.indexOf(match.left);\n                if (i >= 0) {\n                    if (match.right !== undefined && match.leftParentId === match.rightParentId) {\n                        parent.children.splice(i, 1, match.right);\n                        newElementInserted = true;\n                    } else {\n                        parent.children.splice(i, 1);\n                    }\n                }\n                index.remove(match.left);\n            }\n        }\n        if (!newElementInserted && match.right !== undefined && match.rightParentId !== undefined) {\n            const parent = index.getById(match.rightParentId);\n            if (parent !== undefined) {\n                if (parent.children === undefined)\n                    parent.children = [];\n                parent.children.push(match.right);\n            }\n        }\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable } from \"inversify\";\nimport { isValidDimension, almostEquals } from \"../../utils/geometry\";\nimport { Animation, CompoundAnimation } from '../../base/animations/animation';\nimport { Command, CommandExecutionContext, CommandResult } from '../../base/commands/command';\nimport { FadeAnimation, ResolvedElementFade } from '../fade/fade';\nimport { Action } from '../../base/actions/action';\nimport { SModelRootSchema, SModelRoot, SChildElement, SModelElement, SParentElement } from \"../../base/model/smodel\";\nimport { MoveAnimation, ResolvedElementMove } from \"../move/move\";\nimport { Fadeable, isFadeable } from \"../fade/model\";\nimport { isLocateable } from \"../move/model\";\nimport { isBoundsAware } from \"../bounds/model\";\nimport { ViewportRootElement } from \"../viewport/viewport-root\";\nimport { isSelectable } from \"../select/model\";\nimport { MatchResult, ModelMatcher, Match, forEachMatch } from \"./model-matching\";\nimport { ResolvedElementResize, ResizeAnimation } from '../bounds/resize';\n\n/**\n * Sent from the model source to the client in order to update the model. If no model is present yet,\n * this behaves the same as a SetModelAction. The transition from the old model to the new one can be animated.\n */\nexport class UpdateModelAction implements Action {\n    readonly kind = UpdateModelCommand.KIND;\n\n    public readonly newRoot?: SModelRootSchema;\n    public readonly matches?: Match[];\n\n    constructor(input: SModelRootSchema | Match[],\n                public readonly animate: boolean = true) {\n        if ((input as SModelRootSchema).id !== undefined)\n            this.newRoot = input as SModelRootSchema;\n        else\n            this.matches = input as Match[];\n    }\n}\n\nexport interface UpdateAnimationData {\n    fades: ResolvedElementFade[]\n    moves?: ResolvedElementMove[]\n    resizes?: ResolvedElementResize[]\n}\n\n@injectable()\nexport class UpdateModelCommand extends Command {\n    static readonly KIND = 'updateModel';\n\n    oldRoot: SModelRoot;\n    newRoot: SModelRoot;\n\n    constructor(public action: UpdateModelAction) {\n        super();\n    }\n\n    execute(context: CommandExecutionContext): CommandResult {\n        let newRoot: SModelRoot;\n        if (this.action.newRoot !== undefined) {\n            newRoot = context.modelFactory.createRoot(this.action.newRoot);\n        } else {\n            newRoot = context.modelFactory.createRoot(context.root);\n            if (this.action.matches !== undefined)\n                this.applyMatches(newRoot, this.action.matches, context);\n        }\n        this.oldRoot = context.root;\n        this.newRoot = newRoot;\n        return this.performUpdate(this.oldRoot, this.newRoot, context);\n    }\n\n    protected performUpdate(oldRoot: SModelRoot, newRoot: SModelRoot, context: CommandExecutionContext): CommandResult {\n        if ((this.action.animate === undefined || this.action.animate) && oldRoot.id === newRoot.id) {\n            let matchResult: MatchResult;\n            if (this.action.matches === undefined) {\n                const matcher = new ModelMatcher();\n                matchResult = matcher.match(oldRoot, newRoot);\n            } else {\n                matchResult = this.convertToMatchResult(this.action.matches, oldRoot, newRoot);\n            }\n            const animationOrRoot = this.computeAnimation(newRoot, matchResult, context);\n            if (animationOrRoot instanceof Animation)\n                return animationOrRoot.start();\n            else\n                return animationOrRoot;\n        } else {\n            if (oldRoot.type === newRoot.type && isValidDimension(oldRoot.canvasBounds))\n                newRoot.canvasBounds = oldRoot.canvasBounds;\n            return newRoot;\n        }\n    }\n\n    protected applyMatches(root: SModelRoot, matches: Match[], context: CommandExecutionContext): void {\n        const index = root.index;\n        for (const match of matches) {\n            if (match.left !== undefined) {\n                const element = index.getById(match.left.id);\n                if (element instanceof SChildElement)\n                    element.parent.remove(element);\n            }\n            if (match.right !== undefined) {\n                const element = context.modelFactory.createElement(match.right);\n                let parent: SModelElement | undefined;\n                if (match.rightParentId !== undefined)\n                    parent = index.getById(match.rightParentId);\n                if (parent instanceof SParentElement)\n                    parent.add(element);\n                else\n                    root.add(element);\n            }\n        }\n    }\n\n    protected convertToMatchResult(matches: Match[], leftRoot: SModelRoot, rightRoot: SModelRoot): MatchResult {\n        const result: MatchResult = {};\n        for (const match of matches) {\n            const converted: Match = {};\n            let id: string | undefined = undefined;\n            if (match.left !== undefined) {\n                id = match.left.id;\n                converted.left = leftRoot.index.getById(id);\n                converted.leftParentId = match.leftParentId;\n            }\n            if (match.right !== undefined) {\n                id = match.right.id;\n                converted.right = rightRoot.index.getById(id);\n                converted.rightParentId = match.rightParentId;\n            }\n            if (id !== undefined)\n                result[id] = converted;\n        }\n        return result;\n    }\n\n    protected computeAnimation(newRoot: SModelRoot, matchResult: MatchResult, context: CommandExecutionContext): SModelRoot | Animation {\n        const animationData: UpdateAnimationData = {\n            fades: [] as ResolvedElementFade[]\n        };\n        forEachMatch(matchResult, (id, match) => {\n            if (match.left !== undefined && match.right !== undefined) {\n                // The element is still there, but may have been moved\n                this.updateElement(match.left as SModelElement, match.right as SModelElement, animationData);\n            } else if (match.right !== undefined) {\n                // An element has been added\n                const right = match.right as SModelElement;\n                if (isFadeable(right)) {\n                    right.opacity = 0;\n                    animationData.fades.push({\n                        element: right,\n                        type: 'in'\n                    });\n                }\n            } else if (match.left instanceof SChildElement) {\n                // An element has been removed\n                const left = match.left;\n                if (isFadeable(left) && match.leftParentId !== undefined) {\n                    if (newRoot.index.getById(left.id) === undefined) {\n                        const parent = newRoot.index.getById(match.leftParentId);\n                        if (parent instanceof SParentElement) {\n                            const leftCopy = context.modelFactory.createElement(left) as SChildElement & Fadeable;\n                            parent.add(leftCopy);\n                            animationData.fades.push({\n                                element: leftCopy,\n                                type: 'out'\n                            });\n                        }\n                    }\n                }\n            }\n        });\n\n        const animations = this.createAnimations(animationData, newRoot, context);\n        if (animations.length >= 2) {\n            return new CompoundAnimation(newRoot, context, animations);\n        } else if (animations.length === 1) {\n            return animations[0];\n        } else {\n            return newRoot;\n        }\n    }\n\n    protected updateElement(left: SModelElement, right: SModelElement, animationData: UpdateAnimationData): void {\n        if (isLocateable(left) && isLocateable(right)) {\n            const leftPos = left.position;\n            const rightPos = right.position;\n            if (!almostEquals(leftPos.x, rightPos.x) || !almostEquals(leftPos.y, rightPos.y)) {\n                if (animationData.moves === undefined)\n                    animationData.moves = [];\n                animationData.moves.push({\n                    element: right,\n                    elementId: right.id,\n                    fromPosition: leftPos,\n                    toPosition: rightPos\n                });\n                right.position = leftPos;\n            }\n        }\n        if (isBoundsAware(left) && isBoundsAware(right)) {\n            if (!isValidDimension(right.bounds)) {\n                right.bounds = {\n                    x: right.bounds.x,\n                    y: right.bounds.y,\n                    width: left.bounds.width,\n                    height: left.bounds.height\n                };\n            } else if (!almostEquals(left.bounds.width, right.bounds.width)\n                    || !almostEquals(left.bounds.height, right.bounds.height)) {\n                if (animationData.resizes === undefined)\n                    animationData.resizes = [];\n                animationData.resizes.push({\n                    element: right,\n                    fromDimension: {\n                        width: left.bounds.width,\n                        height: left.bounds.height,\n                    },\n                    toDimension: {\n                        width: right.bounds.width,\n                        height: right.bounds.height,\n                    }\n                });\n            }\n        }\n        if (isSelectable(left) && isSelectable(right)) {\n            right.selected = left.selected;\n        }\n        if (left instanceof SModelRoot && right instanceof SModelRoot) {\n            right.canvasBounds = left.canvasBounds;\n        }\n        if (left instanceof ViewportRootElement && right instanceof ViewportRootElement) {\n            right.scroll = left.scroll;\n            right.zoom = left.zoom;\n        }\n    }\n\n    protected createAnimations(data: UpdateAnimationData, root: SModelRoot, context: CommandExecutionContext): Animation[] {\n        const animations: Animation[] = [];\n        if (data.fades.length > 0) {\n            animations.push(new FadeAnimation(root, data.fades, context, true));\n        }\n        if (data.moves !== undefined && data.moves.length > 0) {\n            const movesMap: Map<string, ResolvedElementMove> = new Map;\n            for (const move of data.moves) {\n                movesMap.set(move.elementId, move);\n            }\n            animations.push(new MoveAnimation(root, movesMap, new Map, context, false));\n        }\n        if (data.resizes !== undefined && data.resizes.length > 0) {\n            const resizesMap: Map<string, ResolvedElementResize> = new Map;\n            for (const resize of data.resizes) {\n                resizesMap.set(resize.element.id, resize);\n            }\n            animations.push(new ResizeAnimation(root, resizesMap, context, false));\n        }\n        return animations;\n    }\n\n    undo(context: CommandExecutionContext): CommandResult {\n        return this.performUpdate(this.newRoot, this.oldRoot, context);\n    }\n\n    redo(context: CommandExecutionContext): CommandResult {\n        return this.performUpdate(this.oldRoot, this.newRoot, context);\n    }\n}\n\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Bounds, center, combine, isValidDimension } from \"../../utils/geometry\";\nimport { matchesKeystroke } from \"../../utils/keyboard\";\nimport { SChildElement } from '../../base/model/smodel';\nimport { Action } from \"../../base/actions/action\";\nimport { Command, CommandExecutionContext } from \"../../base/commands/command\";\nimport { SModelElement, SModelRoot } from \"../../base/model/smodel\";\nimport { KeyListener } from \"../../base/views/key-tool\";\nimport { isBoundsAware } from \"../bounds/model\";\nimport { isSelectable } from \"../select/model\";\nimport { ViewportAnimation } from \"./viewport\";\nimport { isViewport, Viewport } from \"./model\";\n\n/**\n * Triggered when the user requests the viewer to center on the current model. The resulting\n * CenterCommand changes the scroll setting of the viewport accordingly and resets the zoom to its default.\n * This action can also be sent from the model source to the client in order to perform such a\n * viewport change programmatically.\n */\nexport class CenterAction implements Action {\n    readonly kind = CenterCommand.KIND;\n\n    constructor(public readonly elementIds: string[],\n                public readonly animate: boolean = true) {\n    }\n}\n\n/**\n * Triggered when the user requests the viewer to fit its content to the available drawing area.\n * The resulting FitToScreenCommand changes the zoom and scroll settings of the viewport so the model\n * can be shown completely. This action can also be sent from the model source to the client in order\n * to perform such a viewport change programmatically.\n */\nexport class FitToScreenAction implements Action {\n    readonly kind = FitToScreenCommand.KIND;\n\n    constructor(public readonly elementIds: string[],\n                public readonly padding?: number,\n                public readonly maxZoom?: number,\n                public readonly animate: boolean = true) {\n    }\n}\n\nexport abstract class BoundsAwareViewportCommand extends Command {\n\n    oldViewport: Viewport;\n    newViewport?: Viewport;\n\n    constructor(protected readonly animate: boolean) {\n        super();\n    }\n\n    protected initialize(model: SModelRoot) {\n        if (isViewport(model)) {\n            this.oldViewport = {\n                scroll: model.scroll,\n                zoom: model.zoom\n            };\n            const allBounds: Bounds[] = [];\n            this.getElementIds().forEach(\n                id => {\n                    const element = model.index.getById(id);\n                    if (element && isBoundsAware(element))\n                        allBounds.push(this.boundsInViewport(element, element.bounds, model));\n                }\n            );\n            if (allBounds.length === 0) {\n                model.index.all().forEach(\n                    element => {\n                        if (isSelectable(element) && element.selected && isBoundsAware(element))\n                            allBounds.push(this.boundsInViewport(element, element.bounds, model));\n                    }\n                );\n            }\n            if (allBounds.length === 0) {\n                model.index.all().forEach(\n                    element => {\n                        if (isBoundsAware(element))\n                            allBounds.push(this.boundsInViewport(element, element.bounds, model));\n                    }\n                );\n            }\n            if (allBounds.length !== 0) {\n                const bounds = allBounds.reduce((b0, b1) => combine(b0, b1));\n                if (isValidDimension(bounds))\n                    this.newViewport = this.getNewViewport(bounds, model);\n            }\n        }\n    }\n\n    protected boundsInViewport(element: SModelElement, bounds: Bounds, viewport: SModelRoot & Viewport): Bounds {\n        if (element instanceof SChildElement && element.parent !== viewport)\n            return this.boundsInViewport(element.parent, element.parent.localToParent(bounds) as Bounds, viewport);\n        else\n            return bounds;\n    }\n\n    protected abstract getNewViewport(bounds: Bounds, model: SModelRoot): Viewport | undefined;\n\n    protected abstract getElementIds(): string[];\n\n    execute(context: CommandExecutionContext) {\n        this.initialize(context.root);\n        return this.redo(context);\n    }\n\n    undo(context: CommandExecutionContext) {\n        const model = context.root;\n        if (isViewport(model) && this.newViewport !== undefined && !this.equal(this.newViewport, this.oldViewport)) {\n            if (this.animate)\n                return new ViewportAnimation(model, this.newViewport, this.oldViewport, context).start();\n            else {\n                model.scroll = this.oldViewport.scroll;\n                model.zoom = this.oldViewport.zoom;\n            }\n        }\n        return model;\n    }\n\n    redo(context: CommandExecutionContext) {\n        const model = context.root;\n        if (isViewport(model) && this.newViewport !== undefined && !this.equal(this.newViewport, this.oldViewport)) {\n            if (this.animate) {\n               return new ViewportAnimation(model, this.oldViewport, this.newViewport, context).start();\n            } else {\n                model.scroll = this.newViewport.scroll;\n                model.zoom = this.newViewport.zoom;\n            }\n        }\n        return model;\n    }\n\n    protected equal(vp1: Viewport, vp2: Viewport): boolean {\n        return vp1.zoom === vp2.zoom && vp1.scroll.x === vp2.scroll.x && vp1.scroll.y === vp2.scroll.y;\n    }\n}\n\nexport class CenterCommand extends BoundsAwareViewportCommand {\n    static readonly KIND = 'center';\n\n    constructor(protected action: CenterAction) {\n        super(action.animate);\n    }\n\n    getElementIds() {\n        return this.action.elementIds;\n    }\n\n    getNewViewport(bounds: Bounds, model: SModelRoot): Viewport | undefined {\n        if (!isValidDimension(model.canvasBounds)) {\n            return undefined;\n        }\n        const c = center(bounds);\n        return {\n            scroll: {\n                x: c.x - 0.5 * model.canvasBounds.width,\n                y: c.y - 0.5 * model.canvasBounds.height\n            },\n            zoom: 1\n        };\n    }\n}\n\nexport class FitToScreenCommand extends BoundsAwareViewportCommand {\n    static readonly KIND = 'fit';\n\n    constructor(protected action: FitToScreenAction) {\n        super(action.animate);\n    }\n\n    getElementIds() {\n        return this.action.elementIds;\n    }\n\n    getNewViewport(bounds: Bounds, model: SModelRoot): Viewport | undefined {\n        if (!isValidDimension(model.canvasBounds)) {\n            return undefined;\n        }\n        const c = center(bounds);\n        const delta = this.action.padding === undefined\n            ? 0\n            : 2 *  this.action.padding;\n        let zoom = Math.min(\n            model.canvasBounds.width / (bounds.width + delta),\n            model.canvasBounds.height / bounds.height + delta);\n        if (this.action.maxZoom !== undefined)\n           zoom = Math.min(zoom, this.action.maxZoom);\n        return {\n            scroll: {\n                x: c.x - 0.5 * model.canvasBounds.width / zoom,\n                y: c.y - 0.5 * model.canvasBounds.height / zoom\n            },\n            zoom: zoom\n        };\n    }\n}\n\nexport class CenterKeyboardListener extends KeyListener {\n    keyDown(element: SModelElement, event: KeyboardEvent): Action[] {\n        if (matchesKeystroke(event, 'KeyC', 'ctrlCmd', 'shift'))\n            return [new CenterAction([])];\n        if (matchesKeystroke(event, 'KeyF', 'ctrlCmd', 'shift'))\n            return [new FitToScreenAction([])];\n        return [];\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from \"inversify\";\nimport { TYPES } from \"../../base/types\";\nimport { CenterCommand, CenterKeyboardListener, FitToScreenCommand } from \"./center-fit\";\nimport { ViewportCommand } from \"./viewport\";\nimport { ScrollMouseListener } from \"./scroll\";\nimport { ZoomMouseListener } from \"./zoom\";\n\nconst viewportModule = new ContainerModule(bind => {\n    bind(TYPES.ICommand).toConstructor(CenterCommand);\n    bind(TYPES.ICommand).toConstructor(FitToScreenCommand);\n    bind(TYPES.ICommand).toConstructor(ViewportCommand);\n    bind(TYPES.KeyListener).to(CenterKeyboardListener);\n    bind(TYPES.MouseListener).to(ScrollMouseListener);\n    bind(TYPES.MouseListener).to(ZoomMouseListener);\n});\n\nexport default viewportModule;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { SModelElement, SModelRoot } from \"../../base/model/smodel\";\nimport { Scrollable } from \"./scroll\";\nimport { Zoomable } from \"./zoom\";\n\nexport const viewportFeature = Symbol('viewportFeature');\n\nexport interface Viewport extends Scrollable, Zoomable {\n}\n\nexport function isViewport(element: SModelElement): element is SModelRoot & Viewport {\n    return element instanceof SModelRoot\n        && element.hasFeature(viewportFeature)\n        && 'zoom' in element\n        && 'scroll' in element;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Point } from \"../../utils/geometry\";\nimport { SModelElement, SModelRoot } from \"../../base/model/smodel\";\nimport { MouseListener } from \"../../base/views/mouse-tool\";\nimport { Action } from \"../../base/actions/action\";\nimport { SModelExtension } from \"../../base/model/smodel-extension\";\nimport { findParentByFeature } from \"../../base/model/smodel-utils\";\nimport { ViewportAction } from \"./viewport\";\nimport { isViewport, Viewport } from \"./model\";\nimport { isMoveable } from \"../move/model\";\nimport { SRoutingHandle } from \"../edit/model\";\n\nexport interface Scrollable extends SModelExtension {\n    scroll: Point\n}\n\nexport function isScrollable(element: SModelElement | Scrollable): element is Scrollable {\n    return 'scroll' in element;\n}\n\nexport class ScrollMouseListener extends MouseListener {\n\n    lastScrollPosition: Point |undefined;\n\n    mouseDown(target: SModelElement, event: MouseEvent): Action[] {\n        const moveable = findParentByFeature(target, isMoveable);\n        if (moveable === undefined && !(target instanceof SRoutingHandle)) {\n            const viewport = findParentByFeature(target, isViewport);\n            if (viewport)\n                this.lastScrollPosition = { x: event.pageX, y: event.pageY };\n            else\n                this.lastScrollPosition = undefined;\n        }\n        return [];\n    }\n\n    mouseMove(target: SModelElement, event: MouseEvent): Action[] {\n        if (event.buttons === 0)\n            this.mouseUp(target, event);\n        else if (this.lastScrollPosition) {\n            const viewport = findParentByFeature(target, isViewport);\n            if (viewport) {\n                const dx = (event.pageX - this.lastScrollPosition.x) / viewport.zoom;\n                const dy = (event.pageY - this.lastScrollPosition.y) / viewport.zoom;\n                const newViewport: Viewport = {\n                    scroll: {\n                        x: viewport.scroll.x - dx,\n                        y: viewport.scroll.y - dy,\n                    },\n                    zoom: viewport.zoom\n                };\n                this.lastScrollPosition = {x: event.pageX, y: event.pageY};\n                return [new ViewportAction(viewport.id, newViewport, false)];\n            }\n        }\n        return [];\n    }\n\n    mouseEnter(target: SModelElement, event: MouseEvent): Action[] {\n        if (target instanceof SModelRoot && event.buttons === 0)\n            this.mouseUp(target, event);\n        return [];\n    }\n\n    mouseUp(target: SModelElement, event: MouseEvent): Action[] {\n        this.lastScrollPosition = undefined;\n        return [];\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Bounds, Point, isBounds, isValidDimension } from \"../../utils/geometry\";\nimport { SModelRoot, SModelIndex, SModelElement } from '../../base/model/smodel';\nimport { Viewport, viewportFeature } from \"./model\";\nimport { Exportable, exportFeature } from \"../export/model\";\n\n/**\n * Model root element that defines a viewport, so it transforms the coordinate system with\n * a `scroll` translation and a `zoom` scaling.\n */\nexport class ViewportRootElement extends SModelRoot implements Viewport, Exportable {\n    scroll: Point = { x: 0, y: 0 };\n    zoom: number = 1;\n    export: boolean = false;\n\n    constructor(index?: SModelIndex<SModelElement>) {\n        super(index);\n    }\n\n    hasFeature(feature: symbol): boolean {\n        return feature === viewportFeature || feature === exportFeature;\n    }\n\n    localToParent(point: Point | Bounds): Bounds {\n        const result = {\n            x: (point.x - this.scroll.x) * this.zoom,\n            y: (point.y - this.scroll.y) * this.zoom,\n            width: -1,\n            height: -1\n        };\n        if (isBounds(point)) {\n            result.width = point.width * this.zoom;\n            result.height = point.height * this.zoom;\n        }\n        return result;\n    }\n\n    parentToLocal(point: Point | Bounds): Bounds {\n        const result = {\n            x: (point.x / this.zoom) + this.scroll.x,\n            y: (point.y / this.zoom) + this.scroll.y,\n            width: -1,\n            height: -1\n        };\n        if (isBounds(point) && isValidDimension(point)) {\n            result.width = point.width / this.zoom;\n            result.height = point.height / this.zoom;\n        }\n        return result;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { SModelElement, SModelRoot } from \"../../base/model/smodel\";\nimport { Action } from \"../../base/actions/action\";\nimport { MergeableCommand, ICommand, CommandExecutionContext } from \"../../base/commands/command\";\nimport { Animation } from \"../../base/animations/animation\";\nimport { isViewport, Viewport } from \"./model\";\n\nexport class ViewportAction implements Action {\n    kind = ViewportCommand.KIND;\n\n    constructor(public readonly elementId: string,\n                public readonly newViewport: Viewport,\n                public readonly animate: boolean) {\n    }\n}\n\nexport class ViewportCommand extends MergeableCommand {\n    static readonly KIND = 'viewport';\n\n    protected element: SModelElement & Viewport;\n    protected oldViewport: Viewport;\n    protected newViewport: Viewport;\n\n    constructor(protected action: ViewportAction) {\n        super();\n        this.newViewport = action.newViewport;\n    }\n\n    execute( context: CommandExecutionContext) {\n        const model = context.root;\n        const element = model.index.getById(this.action.elementId);\n        if (element && isViewport(element)) {\n            this.element = element;\n            this.oldViewport = {\n                scroll: this.element.scroll,\n                zoom: this.element.zoom,\n            };\n            if (this.action.animate)\n                return new ViewportAnimation(this.element, this.oldViewport, this.newViewport, context).start();\n            else {\n                this.element.scroll = this.newViewport.scroll;\n                this.element.zoom = this.newViewport.zoom;\n            }\n        }\n        return model;\n    }\n\n    undo(context: CommandExecutionContext) {\n        return new ViewportAnimation(this.element, this.newViewport, this.oldViewport, context).start();\n    }\n\n    redo(context: CommandExecutionContext) {\n        return new ViewportAnimation(this.element, this.oldViewport, this.newViewport, context).start();\n    }\n\n    merge(command: ICommand, context: CommandExecutionContext) {\n        if (!this.action.animate && command instanceof ViewportCommand && this.element === command.element) {\n            this.newViewport = command.newViewport;\n            return true;\n        }\n        return false;\n    }\n}\n\nexport class ViewportAnimation extends Animation {\n\n    protected zoomFactor: number;\n\n    constructor(protected element: SModelElement & Viewport,\n                protected oldViewport: Viewport,\n                protected newViewport: Viewport,\n                protected context: CommandExecutionContext) {\n        super(context);\n        this.zoomFactor = Math.log(newViewport.zoom / oldViewport.zoom);\n    }\n\n    tween(t: number, context: CommandExecutionContext): SModelRoot {\n        this.element.scroll = {\n            x: (1 - t) * this.oldViewport.scroll.x + t * this.newViewport.scroll.x,\n            y: (1 - t) * this.oldViewport.scroll.y + t * this.newViewport.scroll.y\n        };\n        this.element.zoom = this.oldViewport.zoom * Math.exp(t * this.zoomFactor);\n        return context.root;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { SModelElement } from \"../../base/model/smodel\";\nimport { MouseListener } from \"../../base/views/mouse-tool\";\nimport { Action } from \"../../base/actions/action\";\nimport { SModelExtension } from \"../../base/model/smodel-extension\";\nimport { findParentByFeature } from \"../../base/model/smodel-utils\";\nimport { ViewportAction } from \"./viewport\";\nimport { isViewport, Viewport } from \"./model\";\n\nexport interface Zoomable extends SModelExtension {\n    zoom: number\n}\n\nexport function isZoomable(element: SModelElement | Zoomable): element is Zoomable {\n    return 'zoom' in element;\n}\n\nexport class ZoomMouseListener extends MouseListener {\n\n    wheel(target: SModelElement, event: WheelEvent): Action[] {\n        const viewport = findParentByFeature(target, isViewport);\n        if (viewport) {\n            const newZoom = Math.exp(-event.deltaY * 0.005);\n            const factor = 1. / (newZoom * viewport.zoom) - 1. / viewport.zoom;\n            const newViewport: Viewport = {\n                scroll: {\n                    x: -(factor * event.offsetX - viewport.scroll.x),\n                    y: -(factor * event.offsetY - viewport.scroll.y)\n                },\n                zoom: viewport.zoom * newZoom\n            };\n            return [new ViewportAction(viewport.id, newViewport, false)];\n        }\n        return [];\n    }\n}\n","/*\n * Copyright (C) 2018 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable } from \"inversify\";\nimport { center, maxDistance, Point } from \"../utils/geometry\";\nimport { SEdge } from \"./sgraph\";\n\nexport interface RoutedPoint extends Point {\n    kind: 'source' | 'target' | 'linear'\n    pointIndex?: number\n}\n\nexport interface IEdgeRouter {\n    route(edge: SEdge): RoutedPoint[]\n}\n\n\nexport interface LinearRouteOptions {\n    minimalPointDistance: number;\n}\n\n@injectable()\nexport class LinearEdgeRouter implements IEdgeRouter {\n    route(edge: SEdge, options: LinearRouteOptions = { minimalPointDistance: 2 }): RoutedPoint[] {\n        const source = edge.source;\n        const target = edge.target;\n        if (source === undefined || target === undefined) {\n            return [];\n        }\n\n        let sourceAnchor: Point;\n        let targetAnchor: Point;\n        const rpCount = edge.routingPoints !== undefined ? edge.routingPoints.length : 0;\n        if (rpCount >= 1) {\n            // Use the first routing point as start anchor reference\n            const p0 = edge.routingPoints[0];\n            sourceAnchor = source.getTranslatedAnchor(p0, edge.parent, edge, edge.sourceAnchorCorrection);\n            // Use the last routing point as end anchor reference\n            const pn = edge.routingPoints[rpCount - 1];\n            targetAnchor = target.getTranslatedAnchor(pn, edge.parent, edge, edge.targetAnchorCorrection);\n        } else {\n            // Use the target center as start anchor reference\n            const startRef = center(target.bounds);\n            sourceAnchor = source.getTranslatedAnchor(startRef, target.parent, edge, edge.sourceAnchorCorrection);\n            // Use the source center as end anchor reference\n            const endRef = center(source.bounds);\n            targetAnchor = target.getTranslatedAnchor(endRef, source.parent, edge, edge.targetAnchorCorrection);\n        }\n\n        const result: RoutedPoint[] = [];\n        result.push({ kind: 'source', x: sourceAnchor.x, y: sourceAnchor.y });\n        for (let i = 0; i < rpCount; i++) {\n            const p = edge.routingPoints[i];\n            if (i > 0 && i < rpCount - 1\n                || i === 0 && maxDistance(sourceAnchor, p) >= options.minimalPointDistance + (edge.sourceAnchorCorrection || 0)\n                || i === rpCount - 1 && maxDistance(p, targetAnchor) >= options.minimalPointDistance + (edge.targetAnchorCorrection || 0)) {\n                result.push({ kind: 'linear', x: p.x, y: p.y, pointIndex: i });\n            }\n        }\n        result.push({ kind: 'target', x: targetAnchor.x, y: targetAnchor.y});\n        return result;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable } from \"inversify\";\nimport { SModelFactory } from \"../base/model/smodel-factory\";\nimport {\n    SChildElement, SModelElementSchema, SModelRoot, SModelRootSchema, SParentElement\n} from \"../base/model/smodel\";\nimport { getBasicType } from \"../base/model/smodel-utils\";\nimport {\n    SCompartment, SEdge, SEdgeSchema, SGraph, SGraphSchema, SLabel, SLabelSchema, SNode, SNodeSchema, SPortSchema, SPort\n} from \"./sgraph\";\nimport { SButton, SButtonSchema } from '../features/button/model';\n\n@injectable()\nexport class SGraphFactory extends SModelFactory {\n\n    createElement(schema: SModelElementSchema, parent?: SParentElement): SChildElement {\n        let child: SChildElement;\n        if (this.registry.hasKey(schema.type)) {\n            const regElement = this.registry.get(schema.type, undefined);\n            if (!(regElement instanceof SChildElement))\n                throw new Error(`Element with type ${schema.type} was expected to be an SChildElement.`);\n            child = regElement;\n        } else if (this.isNodeSchema(schema)) {\n            child = new SNode();\n        } else if (this.isPortSchema(schema)) {\n            child = new SPort();\n        } else if (this.isEdgeSchema(schema)) {\n            child = new SEdge();\n        } else if (this.isLabelSchema(schema)) {\n            child = new SLabel();\n        } else if (this.isCompartmentSchema(schema)) {\n            child = new SCompartment();\n        } else if (this.isButtonSchema(schema)) {\n            child = new SButton();\n        } else {\n            child = new SChildElement();\n        }\n        return this.initializeChild(child, schema, parent);\n    }\n\n    createRoot(schema: SModelRootSchema): SModelRoot {\n        let root: SModelRoot;\n        if (this.registry.hasKey(schema.type)) {\n            const regElement = this.registry.get(schema.type, undefined);\n            if (!(regElement instanceof SModelRoot))\n                throw new Error(`Element with type ${schema.type} was expected to be an SModelRoot.`);\n            root = regElement;\n        } else if (this.isGraphSchema(schema)) {\n            root = new SGraph();\n        } else {\n            root = new SModelRoot();\n        }\n        return this.initializeRoot(root, schema);\n    }\n\n    isGraphSchema(schema: SModelElementSchema): schema is SGraphSchema {\n        return getBasicType(schema) === 'graph';\n    }\n\n    isNodeSchema(schema: SModelElementSchema): schema is SNodeSchema {\n        return getBasicType(schema) === 'node';\n    }\n\n    isPortSchema(schema: SModelElementSchema): schema is SPortSchema {\n        return getBasicType(schema) === 'port';\n    }\n\n    isEdgeSchema(schema: SModelElementSchema): schema is SEdgeSchema {\n        return getBasicType(schema) === 'edge';\n    }\n\n    isLabelSchema(schema: SModelElementSchema): schema is SLabelSchema {\n        return getBasicType(schema) === 'label';\n    }\n\n    isCompartmentSchema(schema: SModelElementSchema): schema is SLabelSchema {\n        return getBasicType(schema) === 'comp';\n    }\n\n    isButtonSchema(schema: SModelElementSchema): schema is SButtonSchema {\n        return getBasicType(schema) === 'button';\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { FluentIterable, FluentIterableImpl } from '../utils/iterable';\nimport {\n    SChildElement, SModelElementSchema, SModelRootSchema, SModelIndex, SModelElement, SParentElement\n} from '../base/model/smodel';\nimport {\n    boundsFeature, layoutContainerFeature, layoutableChildFeature, Alignable, alignFeature, ModelLayoutOptions\n} from '../features/bounds/model';\nimport { Fadeable, fadeFeature } from '../features/fade/model';\nimport { Hoverable, hoverFeedbackFeature, popupFeature } from '../features/hover/model';\nimport { moveFeature } from '../features/move/model';\nimport { Selectable, selectFeature } from '../features/select/model';\nimport { ViewportRootElement } from '../features/viewport/viewport-root';\nimport { Bounds, ORIGIN_POINT, Point, center } from '../utils/geometry';\nimport { SShapeElement, SShapeElementSchema } from '../features/bounds/model';\nimport { editFeature, Routable, filterEditModeHandles } from '../features/edit/model';\nimport { translatePoint } from '../base/model/smodel-utils';\nimport { RoutedPoint, LinearEdgeRouter, IEdgeRouter } from './routing';\n\n/**\n * Serializable schema for graph-like models.\n */\nexport interface SGraphSchema extends SModelRootSchema {\n    children: SModelElementSchema[]\n    bounds?: Bounds\n    scroll?: Point\n    zoom?: number\n    layoutOptions?: ModelLayoutOptions\n}\n\n/**\n * Root element for graph-like models.\n */\nexport class SGraph extends ViewportRootElement {\n    layoutOptions?: ModelLayoutOptions;\n\n    constructor(index = new SGraphIndex()) {\n        super(index);\n    }\n}\n\n/**\n * A connectable element is one that can have outgoing and incoming edges, i.e. it can be the source\n * or target element of an edge. There are two kinds of connectable elements: nodes (`SNode`) and\n * ports (`SPort`). A node represents a main entity, while a port is a connection point inside a node.\n */\nexport abstract class SConnectableElement extends SShapeElement {\n\n    /**\n     * The incoming edges of this connectable element. They are resolved by the index, which must\n     * be an `SGraphIndex`.\n     */\n    get incomingEdges(): FluentIterable<SEdge> {\n        return (this.index as SGraphIndex).getIncomingEdges(this);\n    }\n\n    /**\n     * The outgoing edges of this connectable element. They are resolved by the index, which must\n     * be an `SGraphIndex`.\n     */\n    get outgoingEdges(): FluentIterable<SEdge> {\n        return (this.index as SGraphIndex).getOutgoingEdges(this);\n    }\n\n    /**\n     * Compute an anchor position for routing an edge towards this element.\n     *\n     * The default implementation returns the element's center point. If edges should be connected\n     * differently, e.g. to some point on the boundary of the element's view, the according computation\n     * should be implemented in a subclass by overriding this method.\n     *\n     * @param referencePoint The point from which the edge is routed towards this element\n     * @param offset An optional offset value to be considered in the anchor computation;\n     *               positive values should shift the anchor away from this element, negative values\n     *               should shift the anchor more to the inside.\n     */\n    getAnchor(referencePoint: Point, offset?: number): Point {\n        return center(this.bounds);\n    }\n\n    /**\n     * Compute an anchor position for routing an edge towards this element and correct any mismatch\n     * of the coordinate systems.\n     *\n     * @param refPoint The point from which the edge is routed towards this element\n     * @param refContainer The parent element that defines the coordinate system for `refPoint`\n     * @param edge The edge for which the anchor is computed\n     * @param offset An optional offset value (see `getAnchor`)\n     */\n    getTranslatedAnchor(refPoint: Point, refContainer: SParentElement, edge: SEdge, offset?: number): Point {\n        const translatedRefPoint = translatePoint(refPoint, refContainer, this.parent);\n        const anchor = this.getAnchor(translatedRefPoint, offset);\n        return translatePoint(anchor, this.parent, edge.parent);\n    }\n}\n\n/**\n * Serializable schema for SNode.\n */\nexport interface SNodeSchema extends SShapeElementSchema {\n    layout?: string\n    selected?: boolean\n    hoverFeedback?: boolean\n    opacity?: number\n}\n\n/**\n * Model element class for nodes, which are the main entities in a graph. A node can be connected to\n * another node via an SEdge. Such a connection can be direct, i.e. the node is the source or target of\n * the edge, or indirect through a port, i.e. it contains an SPort which is the source or target of the edge.\n */\nexport class SNode extends SConnectableElement implements Selectable, Fadeable, Hoverable {\n    children: SChildElement[];\n    layout?: string;\n    selected: boolean = false;\n    hoverFeedback: boolean = false;\n    opacity: number = 1;\n\n    hasFeature(feature: symbol): boolean {\n        return feature === selectFeature || feature === moveFeature || feature === boundsFeature\n            || feature === layoutContainerFeature || feature === fadeFeature || feature === hoverFeedbackFeature\n            || feature === popupFeature;\n    }\n}\n\n/**\n * Serializable schema for SPort.\n */\nexport interface SPortSchema extends SShapeElementSchema {\n    selected?: boolean\n    hoverFeedback?: boolean\n    opacity?: number\n}\n\n/**\n * A port is a connection point for edges. It should always be contained in an SNode.\n */\nexport class SPort extends SConnectableElement implements Selectable, Fadeable, Hoverable {\n    selected: boolean = false;\n    hoverFeedback: boolean = false;\n    opacity: number = 1;\n\n    hasFeature(feature: symbol): boolean {\n        return feature === selectFeature || feature === boundsFeature || feature === fadeFeature\n            || feature === hoverFeedbackFeature;\n    }\n}\n\n/**\n * Serializable schema for SEdge.\n */\nexport interface SEdgeSchema extends SModelElementSchema {\n    sourceId: string\n    targetId: string\n    routingPoints?: Point[]\n    selected?: boolean\n    hoverFeedback?: boolean\n    opacity?: number\n}\n\n/**\n * Model element class for edges, which are the connectors in a graph. An edge has a source and a target,\n * each of which can be either a node or a port. The source and target elements are referenced via their\n * ids and can be resolved with the index stored in the root element.\n */\nexport class SEdge extends SChildElement implements Fadeable, Selectable, Routable, Hoverable {\n    sourceId: string;\n    targetId: string;\n    routingPoints: Point[] = [];\n    selected: boolean = false;\n    hoverFeedback: boolean = false;\n    opacity: number = 1;\n    sourceAnchorCorrection?: number;\n    targetAnchorCorrection?: number;\n    router?: IEdgeRouter;\n\n    get source(): SConnectableElement | undefined {\n        return this.index.getById(this.sourceId) as SConnectableElement;\n    }\n\n    get target(): SConnectableElement | undefined {\n        return this.index.getById(this.targetId) as SConnectableElement;\n    }\n\n    route(): RoutedPoint[] {\n        if (this.router === undefined)\n            this.router = new LinearEdgeRouter();\n        const route = this.router.route(this);\n        return filterEditModeHandles(route, this);\n    }\n\n    hasFeature(feature: symbol): boolean {\n        return feature === fadeFeature || feature === selectFeature ||\n            feature === editFeature || feature === hoverFeedbackFeature;\n    }\n}\n\n/**\n * Serializable schema for SLabel.\n */\nexport interface SLabelSchema extends SShapeElementSchema {\n    text: string\n    selected?: boolean\n}\n\n/**\n * A label can be attached to a node, edge, or port, and contains some text to be rendered in its view.\n */\nexport class SLabel extends SShapeElement implements Selectable, Alignable, Fadeable {\n    text: string;\n    selected: boolean = false;\n    alignment: Point = ORIGIN_POINT;\n    opacity = 1;\n\n    hasFeature(feature: symbol) {\n        return feature === boundsFeature || feature === alignFeature || feature === fadeFeature || feature === layoutableChildFeature;\n    }\n}\n\n/**\n * Serializable schema for SCompartment.\n */\nexport interface SCompartmentSchema extends SShapeElementSchema {\n    layout?: string\n}\n\n/**\n * A compartment is used to group multiple child elements such as labels of a node. Usually a `vbox`\n * or `hbox` layout is used to arrange these children.\n */\nexport class SCompartment extends SShapeElement implements Fadeable {\n    children: SChildElement[];\n    layout?: string;\n    layoutOptions?: {[key: string]: string | number | boolean};\n    opacity = 1;\n\n    hasFeature(feature: symbol) {\n        return feature === boundsFeature || feature === layoutContainerFeature || feature === layoutableChildFeature || feature === fadeFeature;\n    }\n}\n\n/**\n * A specialized model index that tracks outgoing and incoming edges.\n */\nexport class SGraphIndex extends SModelIndex<SModelElement> {\n\n    private outgoing: Map<string, SEdge[]> = new Map;\n    private incoming: Map<string, SEdge[]> = new Map;\n\n    add(element: SModelElement): void {\n        super.add(element);\n        if (element instanceof SEdge) {\n            // Register the edge in the outgoing map\n            if (element.sourceId) {\n                const sourceArr = this.outgoing.get(element.sourceId);\n                if (sourceArr === undefined)\n                    this.outgoing.set(element.sourceId, [element]);\n                else\n                    sourceArr.push(element);\n            }\n            // Register the edge in the incoming map\n            if (element.targetId) {\n                const targetArr = this.incoming.get(element.targetId);\n                if (targetArr === undefined)\n                    this.incoming.set(element.targetId, [element]);\n                else\n                    targetArr.push(element);\n            }\n        }\n    }\n\n    remove(element: SModelElement): void {\n        super.remove(element);\n        if (element instanceof SEdge) {\n            // Remove the edge from the outgoing map\n            const sourceArr = this.outgoing.get(element.sourceId);\n            if (sourceArr !== undefined) {\n                const index = sourceArr.indexOf(element);\n                if (index >= 0) {\n                    if (sourceArr.length === 1)\n                        this.outgoing.delete(element.sourceId);\n                    else\n                        sourceArr.splice(index, 1);\n                }\n            }\n            // Remove the edge from the incoming map\n            const targetArr = this.incoming.get(element.targetId);\n            if (targetArr !== undefined) {\n                const index = targetArr.indexOf(element);\n                if (index >= 0) {\n                    if (targetArr.length === 1)\n                        this.incoming.delete(element.targetId);\n                    else\n                        targetArr.splice(index, 1);\n                }\n            }\n        }\n    }\n\n    getAttachedElements(element: SModelElement): FluentIterable<SModelElement> {\n        return new FluentIterableImpl(\n            () => ({\n                outgoing: this.outgoing.get(element.id),\n                incoming: this.incoming.get(element.id),\n                nextOutgoingIndex: 0,\n                nextIncomingIndex: 0\n            }),\n            (state) => {\n                let index = state.nextOutgoingIndex;\n                if (state.outgoing !== undefined && index < state.outgoing.length) {\n                    state.nextOutgoingIndex = index + 1;\n                    return { done: false, value: state.outgoing[index] };\n                }\n                index = state.nextIncomingIndex;\n                if (state.incoming !== undefined) {\n                    // Filter out self-loops: edges that are both outgoing and incoming\n                    while (index < state.incoming.length) {\n                        const edge = state.incoming[index];\n                        if (edge.sourceId !== edge.targetId) {\n                            state.nextIncomingIndex = index + 1;\n                            return { done: false, value: edge };\n                        }\n                        index++;\n                    }\n                }\n                return { done: true, value: undefined as any };\n            }\n        );\n    }\n\n    getIncomingEdges(element: SConnectableElement): FluentIterable<SEdge> {\n        return this.incoming.get(element.id) || [];\n    }\n\n    getOutgoingEdges(element: SConnectableElement): FluentIterable<SEdge> {\n        return this.outgoing.get(element.id) || [];\n    }\n\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\n /** @jsx svg */\nimport { svg } from 'snabbdom-jsx';\n\nimport { VNode } from \"snabbdom/vnode\";\nimport { Point, centerOfLine, maxDistance } from '../utils/geometry';\nimport { setAttr } from '../base/views/vnode-utils';\nimport { RenderingContext, IView } from \"../base/views/view\";\nimport { getSubType } from \"../base/model/smodel-utils\";\nimport { SRoutingHandle, isRoutable } from '../features/edit/model';\nimport { SCompartment, SEdge, SGraph, SLabel } from \"./sgraph\";\nimport { RoutedPoint } from './routing';\n\n/**\n * IView component that turns an SGraph element and its children into a tree of virtual DOM elements.\n */\nexport class SGraphView implements IView {\n\n    render(model: Readonly<SGraph>, context: RenderingContext): VNode {\n        const transform = `scale(${model.zoom}) translate(${-model.scroll.x},${-model.scroll.y})`;\n        return <svg class-sprotty-graph={true}>\n            <g transform={transform}>\n                {context.renderChildren(model)}\n            </g>\n        </svg>;\n    }\n}\n\nexport class PolylineEdgeView implements IView {\n\n    render(edge: Readonly<SEdge>, context: RenderingContext): VNode {\n        const route = edge.route();\n        if (route.length === 0)\n            return this.renderDanglingEdge(\"Cannot compute route\", edge, context);\n\n        return <g class-sprotty-edge={true} class-mouseover={edge.hoverFeedback}>\n            {this.renderLine(edge, route, context)}\n            {this.renderAdditionals(edge, route, context)}\n            {context.renderChildren(edge, { route })}\n        </g>;\n    }\n\n    protected renderLine(edge: SEdge, segments: Point[], context: RenderingContext): VNode {\n        const firstPoint = segments[0];\n        let path = `M ${firstPoint.x},${firstPoint.y}`;\n        for (let i = 1; i < segments.length; i++) {\n            const p = segments[i];\n            path += ` L ${p.x},${p.y}`;\n        }\n        return <path d={path}/>;\n    }\n\n    protected renderAdditionals(edge: SEdge, segments: Point[], context: RenderingContext): VNode[] {\n        return [];\n    }\n\n    protected renderDanglingEdge(message: string, edge: SEdge, context: RenderingContext): VNode {\n        return <text class-sprotty-edge-dangling={true} title={message}>?</text>;\n    }\n}\n\nexport class SRoutingHandleView implements IView {\n    minimalPointDistance: number = 10;\n\n    render(handle: Readonly<SRoutingHandle>, context: RenderingContext, args?: { route?: RoutedPoint[] }): VNode {\n        if (args && args.route) {\n            const position = this.getPosition(handle, args.route);\n            if (position !== undefined) {\n                const node = <circle class-sprotty-routing-handle={true}\n                        class-selected={handle.selected} class-mouseover={handle.hoverFeedback}\n                        cx={position.x} cy={position.y}/>;   // Radius must be specified via CSS\n                setAttr(node, 'data-kind', handle.kind);\n                return node;\n            }\n        }\n        // Fallback: Create an empty group\n        return <g/>;\n    }\n\n    protected getPosition(handle: SRoutingHandle, route: RoutedPoint[]): Point | undefined {\n        if (handle.kind === 'line') {\n            return this.getLinePosition(handle, route);\n        } else {\n            return this.getJunctionPosition(handle, route);\n        }\n    }\n\n    protected getJunctionPosition(handle: SRoutingHandle, route: RoutedPoint[]): Point | undefined {\n        return route.find(rp => rp.pointIndex === handle.pointIndex);\n    }\n\n    protected getLinePosition(handle: SRoutingHandle, route: RoutedPoint[]): Point | undefined {\n        const parent = handle.parent;\n        if (isRoutable(parent)) {\n            const getIndex = (rp: RoutedPoint) => {\n                if (rp.pointIndex !== undefined)\n                    return rp.pointIndex;\n                else if (rp.kind === 'target')\n                    return parent.routingPoints.length;\n                else\n                    return -1;\n            };\n            let rp1, rp2: RoutedPoint | undefined;\n            for (const rp of route) {\n                const i = getIndex(rp);\n                if (i <= handle.pointIndex && (rp1 === undefined || i > getIndex(rp1)))\n                    rp1 = rp;\n                if (i > handle.pointIndex && (rp2 === undefined || i < getIndex(rp2)))\n                    rp2 = rp;\n            }\n            if (rp1 !== undefined && rp2 !== undefined) {\n                // Skip this handle if its related line segment is not included in the route\n                if (getIndex(rp1) !== handle.pointIndex && handle.pointIndex >= 0) {\n                    const point = parent.routingPoints[handle.pointIndex];\n                    if (maxDistance(point, rp1) >= maxDistance(point, rp2))\n                        return undefined;\n                }\n                if (getIndex(rp2) !== handle.pointIndex + 1 && handle.pointIndex + 1 < parent.routingPoints.length) {\n                    const point = parent.routingPoints[handle.pointIndex + 1];\n                    if (maxDistance(point, rp1) < maxDistance(point, rp2))\n                        return undefined;\n                }\n                // Skip this handle if its related line segment is too short\n                if (maxDistance(rp1, rp2) >= this.minimalPointDistance)\n                    return centerOfLine(rp1, rp2);\n            }\n        }\n        return undefined;\n    }\n}\n\nexport class SLabelView implements IView {\n    render(label: Readonly<SLabel>, context: RenderingContext): VNode {\n        const vnode = <text class-sprotty-label={true}>{label.text}</text>;\n        const subType = getSubType(label);\n        if (subType)\n            setAttr(vnode, 'class', subType);\n        return vnode;\n    }\n}\n\nexport class SCompartmentView implements IView {\n    render(model: Readonly<SCompartment>, context: RenderingContext): VNode {\n        const translate = `translate(${model.bounds.x}, ${model.bounds.y})`;\n        const vnode = <g transform={translate} class-sprotty-comp=\"{true}\">\n            {context.renderChildren(model)}\n        </g>;\n        const subType = getSubType(model);\n        if (subType)\n            setAttr(vnode, 'class', subType);\n        return vnode;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License'); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\n\n// ------------------ Base ------------------\n\nexport * from './base/actions/action';\nexport * from './base/actions/action-dispatcher';\nexport * from './base/actions/action-handler';\n\nexport * from './base/animations/animation-frame-syncer';\nexport * from './base/animations/animation';\nexport * from './base/animations/easing';\n\nexport * from './base/commands/command-stack-options';\nexport * from './base/commands/command-stack';\nexport * from './base/commands/command';\n\nexport * from './base/features/initialize-canvas';\nexport * from './base/features/set-model';\n\nexport * from './base/model/smodel-extension';\nexport * from './base/model/smodel-factory';\nexport * from './base/model/smodel-storage';\nexport * from './base/model/smodel-utils';\nexport * from './base/model/smodel';\n\nexport * from './base/views/key-tool';\nexport * from './base/views/mouse-tool';\nexport * from './base/views/thunk-view';\nexport * from './base/views/view';\nexport * from './base/views/viewer-cache';\nexport * from './base/views/viewer-options';\nexport * from './base/views/viewer';\nexport * from './base/views/vnode-decorators';\nexport * from './base/views/vnode-utils';\n\nexport * from './base/types';\n\nimport defaultModule from './base/di.config';\nexport { defaultModule };\n\n\n// ------------------ Features ------------------\n\nexport * from \"./features/bounds/bounds-manipulation\";\nexport * from \"./features/bounds/layout\";\nexport * from \"./features/bounds/model\";\nexport * from \"./features/bounds/vbox-layout\";\nexport * from \"./features/bounds/hbox-layout\";\nexport * from \"./features/bounds/stack-layout\";\n\nexport * from \"./features/button/button-handler\";\nexport * from \"./features/button/model\";\n\nexport * from \"./features/edit/edit-routing\";\nexport * from \"./features/edit/model\";\n\nexport * from \"./features/expand/expand\";\nexport * from \"./features/expand/model\";\nexport * from \"./features/expand/views\";\n\nexport * from \"./features/export/export\";\nexport * from \"./features/export/model\";\nexport * from \"./features/export/svg-exporter\";\n\nexport * from \"./features/fade/fade\";\nexport * from \"./features/fade/model\";\n\nexport * from \"./features/hover/hover\";\nexport * from \"./features/hover/model\";\n\nexport * from \"./features/move/model\";\nexport * from \"./features/move/move\";\n\nexport * from \"./features/open/open\";\nexport * from \"./features/open/model\";\n\nexport * from \"./features/select/model\";\nexport * from \"./features/select/select\";\n\nexport * from \"./features/undo-redo/undo-redo\";\n\nexport * from \"./features/update/model-matching\";\nexport * from \"./features/update/update-model\";\n\nexport * from \"./features/viewport/center-fit\";\nexport * from \"./features/viewport/model\";\nexport * from \"./features/viewport/scroll\";\nexport * from \"./features/viewport/viewport-root\";\nexport * from \"./features/viewport/viewport\";\nexport * from \"./features/viewport/zoom\";\n\nimport moveModule from \"./features/move/di.config\";\nimport boundsModule from \"./features/bounds/di.config\";\nimport fadeModule from \"./features/fade/di.config\";\nimport selectModule from \"./features/select/di.config\";\nimport undoRedoModule from \"./features/undo-redo/di.config\";\nimport viewportModule from \"./features/viewport/di.config\";\nimport hoverModule from \"./features/hover/di.config\";\nimport edgeEditModule from \"./features/edit/di.config\";\nimport exportModule from \"./features/export/di.config\";\nimport expandModule from \"./features/expand/di.config\";\nimport openModule from \"./features/open/di.config\";\nimport buttonModule from \"./features/button/di.config\";\n\nexport { moveModule, boundsModule, fadeModule, selectModule, undoRedoModule, viewportModule, hoverModule, edgeEditModule, exportModule, expandModule, openModule, buttonModule };\n\n\n// ------------------ Graph ------------------\n\nexport * from \"./graph/sgraph-factory\";\nexport * from \"./graph/sgraph\";\nexport * from \"./graph/views\";\n\n\n// ------------------ Library ------------------\n\nexport * from \"./lib/generic-views\";\nexport * from \"./lib/html-views\";\nexport * from \"./lib/model\";\nexport * from \"./lib/svg-views\";\n\n\n// ------------------ Model Source ------------------\n\nexport * from \"./model-source/diagram-server\";\nexport * from \"./model-source/diagram-state\";\nexport * from \"./model-source/local-model-source\";\nexport * from \"./model-source/logging\";\nexport * from \"./model-source/model-source\";\nexport * from \"./model-source/websocket\";\n\nimport modelSourceModule from \"./model-source/di.config\";\nexport { modelSourceModule };\n\n\n// ------------------ Utilities ------------------\n\nexport * from \"./utils/anchors\";\nexport * from \"./utils/browser\";\nexport * from \"./utils/color\";\nexport * from \"./utils/geometry\";\nexport * from \"./utils/logging\";\nexport * from \"./utils/registry\";\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport virtualize from \"snabbdom-virtualize/strings\";\nimport { VNode } from \"snabbdom/vnode\";\nimport { IView, RenderingContext } from \"../base/views/view\";\nimport { PreRenderedElement } from \"./model\";\n\nexport class PreRenderedView implements IView {\n    render(model: PreRenderedElement, context: RenderingContext): VNode {\n        const node = virtualize(model.code);\n        this.correctNamespace(node);\n        return node;\n    }\n\n    protected correctNamespace(node: VNode) {\n        if (node.sel === 'svg' || node.sel === 'g')\n            this.setNamespace(node, 'http://www.w3.org/2000/svg');\n    }\n\n    protected setNamespace(node: VNode, ns: string) {\n        if (node.data === undefined)\n            node.data = {};\n        node.data.ns = ns;\n        const children = node.children;\n        if (children !== undefined) {\n            for (let i = 0; i < children.length; i++) {\n                const child = children[i];\n                if (typeof child !== 'string')\n                    this.setNamespace(child, ns);\n            }\n        }\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\n /** @jsx html */\nimport { html } from 'snabbdom-jsx';\n\nimport { VNode } from \"snabbdom/vnode\";\nimport { IView, RenderingContext } from \"../base/views/view\";\nimport { setClass } from \"../base/views/vnode-utils\";\nimport { HtmlRoot } from \"./model\";\n\nexport class HtmlRootView implements IView {\n    render(model: HtmlRoot, context: RenderingContext): VNode {\n        const root = <div>\n            { context.renderChildren(model) }\n        </div>;\n        for (const c of model.classes) {\n            setClass(root, c, true);\n        }\n        return root;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { SModelRoot, SModelRootSchema, SChildElement, SModelElementSchema } from \"../base/model/smodel\";\nimport { Point, Dimension, ORIGIN_POINT, EMPTY_DIMENSION, Bounds } from \"../utils/geometry\";\nimport { computeCircleAnchor, computeRectangleAnchor, computeDiamondAnchor } from '../utils/anchors';\nimport { BoundsAware, boundsFeature, Alignable, alignFeature } from \"../features/bounds/model\";\nimport { Locateable, moveFeature } from \"../features/move/model\";\nimport { Selectable, selectFeature } from \"../features/select/model\";\nimport { SNode, SPort } from '../graph/sgraph';\n\n/**\n * A node that is represented by a circle.\n */\nexport class CircularNode extends SNode {\n    strokeWidth: number = 0;\n\n    protected get radius(): number {\n        const d = Math.min(this.size.width, this.size.height);\n        return d > 0 ? d / 2 : 0;\n    }\n\n    getAnchor(refPoint: Point, offset: number = 0): Point {\n        const strokeCorrection = 0.5 * this.strokeWidth;\n        return computeCircleAnchor(this.position, this.radius, refPoint, offset + strokeCorrection);\n    }\n}\n\n/**\n * A node that is represented by a rectangle.\n */\nexport class RectangularNode extends SNode {\n    strokeWidth: number = 0;\n\n    getAnchor(refPoint: Point, offset: number = 0): Point {\n        const strokeCorrection = 0.5 * this.strokeWidth;\n        return computeRectangleAnchor(this.bounds, refPoint, offset + strokeCorrection);\n    }\n}\n\n/**\n * A node that is represented by a diamond.\n */\nexport class DiamondNode extends SNode {\n    strokeWidth: number = 0;\n\n    getAnchor(refPoint: Point, offset: number = 0): Point {\n        const strokeCorrection = 0.5 * this.strokeWidth;\n        return computeDiamondAnchor(this.bounds, refPoint, offset + strokeCorrection);\n    }\n}\n\n/**\n * A port that is represented by a circle.\n */\nexport class CircularPort extends SPort {\n    strokeWidth: number = 0;\n\n    protected get radius(): number {\n        const d = Math.min(this.size.width, this.size.height);\n        return d > 0 ? d / 2 : 0;\n    }\n\n    getAnchor(refPoint: Point, offset: number = 0): Point {\n        const strokeCorrection = 0.5 * this.strokeWidth;\n        return computeCircleAnchor(this.position, this.radius, refPoint, offset + strokeCorrection);\n    }\n}\n\n/**\n * A port that is represented by a rectangle.\n */\nexport class RectangularPort extends SPort {\n    strokeWidth: number = 0;\n\n    getAnchor(refPoint: Point, offset: number = 0): Point {\n        const strokeCorrection = 0.5 * this.strokeWidth;\n        return computeRectangleAnchor(this.bounds, refPoint, offset + strokeCorrection);\n    }\n}\n\n/**\n * Serializable schema for HtmlRoot.\n */\nexport interface HtmlRootSchema extends SModelRootSchema {\n    classes?: string[]\n}\n\n/**\n * Root model element class for HTML content. Usually this is rendered with a `div` DOM element.\n */\nexport class HtmlRoot extends SModelRoot {\n    classes: string[] = [];\n}\n\n/**\n * Serializable schema for PreRenderedElement.\n */\nexport interface PreRenderedElementSchema extends SModelElementSchema {\n    code: string\n}\n\n/**\n * Pre-rendered elements contain HTML or SVG code to be transferred to the DOM. This can be useful to\n * render complex figures or to compute the view on the server instead of the client code.\n */\nexport class PreRenderedElement extends SChildElement {\n    code: string;\n}\n\n/**\n * Serializable schema for ShapedPreRenderedElement.\n */\nexport interface ShapedPreRenderedElementSchema extends PreRenderedElementSchema {\n    position?: Point\n    size?: Dimension\n}\n\n/**\n * Same as PreRenderedElement, but with a position and a size.\n */\nexport class ShapedPreRenderedElement extends PreRenderedElement implements BoundsAware, Locateable, Selectable, Alignable {\n    position: Point = ORIGIN_POINT;\n    size: Dimension = EMPTY_DIMENSION;\n    selected: boolean = false;\n    alignment: Point = ORIGIN_POINT;\n\n    get bounds(): Bounds {\n        return {\n            x: this.position.x,\n            y: this.position.y,\n            width: this.size.width,\n            height: this.size.height\n        };\n    }\n\n    set bounds(newBounds: Bounds) {\n        this.position = {\n            x: newBounds.x,\n            y: newBounds.y\n        };\n        this.size = {\n            width: newBounds.width,\n            height: newBounds.height\n        };\n    }\n\n    hasFeature(feature: symbol): boolean {\n        return feature === moveFeature || feature === boundsFeature || feature === selectFeature || feature === alignFeature;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/** @jsx svg */\nimport { svg } from 'snabbdom-jsx';\n\nimport { VNode } from \"snabbdom/vnode\";\nimport { IView, RenderingContext } from \"../base/views/view\";\nimport { SNode, SPort } from \"../graph/sgraph\";\nimport { ViewportRootElement } from \"../features/viewport/viewport-root\";\nimport { SShapeElement } from '../features/bounds/model';\nimport { Hoverable } from '../features/hover/model';\nimport { Selectable } from '../features/select/model';\nimport { Diamond, Point } from '../utils/geometry';\n\nexport class SvgViewportView implements IView {\n    render(model: Readonly<ViewportRootElement>, context: RenderingContext): VNode {\n        const transform = `scale(${model.zoom}) translate(${-model.scroll.x},${-model.scroll.y})`;\n        return <svg>\n            <g transform={transform}>\n                {context.renderChildren(model)}\n            </g>\n        </svg>;\n    }\n}\n\nexport class CircularNodeView implements IView {\n    render(node: Readonly<SShapeElement & Hoverable & Selectable>, context: RenderingContext): VNode {\n        const radius = this.getRadius(node);\n        return <g>\n            <circle class-sprotty-node={node instanceof SNode} class-sprotty-port={node instanceof SPort}\n                    class-mouseover={node.hoverFeedback} class-selected={node.selected}\n                    r={radius} cx={radius} cy={radius}></circle>\n            {context.renderChildren(node)}\n        </g>;\n    }\n\n    protected getRadius(node: SShapeElement): number {\n        const d = Math.min(node.size.width, node.size.height);\n        return d > 0 ? d / 2 : 0;\n    }\n}\n\nexport class RectangularNodeView implements IView {\n    render(node: Readonly<SShapeElement & Hoverable & Selectable>, context: RenderingContext): VNode {\n        return <g>\n            <rect class-sprotty-node={node instanceof SNode} class-sprotty-port={node instanceof SPort}\n                  class-mouseover={node.hoverFeedback} class-selected={node.selected}\n                  x=\"0\" y=\"0\" width={Math.max(node.size.width, 0)} height={Math.max(node.size.height, 0)}></rect>\n            {context.renderChildren(node)}\n        </g>;\n    }\n}\n\nexport class DiamondNodeView implements IView {\n    render(node: Readonly<SShapeElement & Hoverable & Selectable>, context: RenderingContext): VNode {\n        const diamond = new Diamond({ height: Math.max(node.size.height, 0), width: Math.max(node.size.width, 0), x: 0, y: 0 });\n        const points = `${svgStr(diamond.topPoint)} ${svgStr(diamond.rightPoint)} ${svgStr(diamond.bottomPoint)} ${svgStr(diamond.leftPoint)}`;\n        return <g>\n            <polygon class-sprotty-node={node instanceof SNode} class-sprotty-port={node instanceof SPort}\n                  class-mouseover={node.hoverFeedback} class-selected={node.selected}\n                  points={points} />\n            {context.renderChildren(node)}\n        </g>;\n    }\n}\n\nfunction svgStr(point: Point) {\n    return `${point.x},${point.y}`;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from \"inversify\";\nimport { TYPES } from \"../base/types\";\nimport { ModelSource } from \"./model-source\";\n\n/**\n * This container module does NOT provide any binding for TYPES.ModelSource because that needs to be\n * done according to the needs of the application. You can choose between a local (LocalModelSource)\n * and a remote (e.g. WebSocketDiagramServer) implementation.\n */\nconst modelSourceModule = new ContainerModule(bind => {\n    bind(TYPES.ModelSourceProvider).toProvider<ModelSource>((context) => {\n        return () => {\n            return new Promise<ModelSource>((resolve) => {\n                resolve(context.container.get<ModelSource>(TYPES.ModelSource));\n            });\n        };\n    });\n});\n\nexport default modelSourceModule;\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable } from \"inversify\";\nimport { TYPES } from \"../base/types\";\nimport { Bounds, Point } from \"../utils/geometry\";\nimport { ILogger } from \"../utils/logging\";\nimport { SModelRootSchema, SModelIndex, SModelElementSchema } from \"../base/model/smodel\";\nimport { SModelStorage } from \"../base/model/smodel-storage\";\nimport { Action } from \"../base/actions/action\";\nimport { ActionHandlerRegistry } from \"../base/actions/action-handler\";\nimport { IActionDispatcher } from \"../base/actions/action-dispatcher\";\nimport { ICommand } from \"../base/commands/command\";\nimport { ViewerOptions } from \"../base/views/viewer-options\";\nimport { SetModelCommand, SetModelAction } from \"../base/features/set-model\";\nimport { UpdateModelCommand, UpdateModelAction } from \"../features/update/update-model\";\nimport { ComputedBoundsAction, RequestBoundsCommand } from '../features/bounds/bounds-manipulation';\nimport { RequestPopupModelAction } from \"../features/hover/hover\";\nimport { ModelSource } from \"./model-source\";\nimport { ExportSvgAction } from '../features/export/svg-exporter';\nimport { saveAs } from 'file-saver';\nimport { CollapseExpandAction, CollapseExpandAllAction } from '../features/expand/expand';\nimport { OpenAction } from '../features/open/open';\n\n/**\n * Wrapper for actions when transferring them between client and server via a DiagramServer.\n */\nexport interface ActionMessage {\n    clientId: string\n    action: Action\n}\n\nexport function isActionMessage(object: any): object is ActionMessage {\n    return object !== undefined && object.hasOwnProperty('clientId') && object.hasOwnProperty('action');\n}\n\n/**\n * Sent by the external server when to signal a state change.\n */\nexport class ServerStatusAction {\n    static KIND = 'serverStatus';\n    kind = ServerStatusAction.KIND;\n    severity: string;\n    message: string;\n}\n\nconst receivedFromServerProperty = '__receivedFromServer';\n\n/**\n * A ModelSource that communicates with an external model provider, e.g.\n * a model editor.\n *\n * This class defines which actions are sent to and received from the\n * external model source.\n */\n@injectable()\nexport abstract class DiagramServer extends ModelSource {\n\n    clientId: string;\n\n    protected currentRoot: SModelRootSchema = {\n        type: 'NONE',\n        id: 'ROOT'\n    };\n\n    protected lastSubmittedModelType: string;\n\n    constructor(@inject(TYPES.IActionDispatcher) actionDispatcher: IActionDispatcher,\n                @inject(TYPES.ActionHandlerRegistry) actionHandlerRegistry: ActionHandlerRegistry,\n                @inject(TYPES.ViewerOptions) viewerOptions: ViewerOptions,\n                @inject(TYPES.SModelStorage) protected storage: SModelStorage,\n                @inject(TYPES.ILogger) protected logger: ILogger) {\n        super(actionDispatcher, actionHandlerRegistry, viewerOptions);\n        this.clientId = this.viewerOptions.baseDiv;\n    }\n\n    protected initialize(registry: ActionHandlerRegistry): void {\n        super.initialize(registry);\n\n        // Register model manipulation commands\n        registry.registerCommand(UpdateModelCommand);\n\n        // Register this model source\n        registry.register(ComputedBoundsAction.KIND, this);\n        registry.register(RequestBoundsCommand.KIND, this);\n        registry.register(RequestPopupModelAction.KIND, this);\n        registry.register(CollapseExpandAction.KIND, this);\n        registry.register(CollapseExpandAllAction.KIND, this);\n        registry.register(OpenAction.KIND, this);\n        registry.register(ServerStatusAction.KIND, this);\n    }\n\n    handle(action: Action): void | ICommand {\n        const forwardToServer = this.handleLocally(action);\n        if (forwardToServer) {\n            const message: ActionMessage = {\n                clientId: this.clientId,\n                action: action\n            };\n            this.logger.log(this, 'sending', message);\n            this.sendMessage(message);\n        }\n    }\n\n    protected abstract sendMessage(message: ActionMessage): void;\n\n    protected messageReceived(data: any): void {\n        const object = typeof(data) === 'string' ? JSON.parse(data) : data;\n        if (isActionMessage(object) && object.action) {\n            if (!object.clientId || object.clientId === this.clientId) {\n                (object.action as any)[receivedFromServerProperty] = true;\n                this.logger.log(this, 'receiving', object);\n                this.actionDispatcher.dispatch(object.action).then(() => {\n                    this.storeNewModel(object.action);\n                });\n            }\n        } else {\n            this.logger.error(this, 'received data is not an action message', object);\n        }\n    }\n\n    /**\n     * Check whether the given action should be handled locally. Returns true if the action should\n     * still be sent to the server, and false if it's only handled locally.\n     */\n    protected handleLocally(action: Action): boolean {\n        this.storeNewModel(action);\n        switch (action.kind) {\n            case ComputedBoundsAction.KIND:\n                return this.handleComputedBounds(action as ComputedBoundsAction);\n            case RequestBoundsCommand.KIND:\n                return false;\n            case ExportSvgAction.KIND:\n                return this.handleExportSvgAction(action as ExportSvgAction);\n            case ServerStatusAction.KIND:\n                return this.handleServerStateAction(action as ServerStatusAction);\n        }\n        return !(action as any)[receivedFromServerProperty];\n    }\n\n    /**\n     * Put the new model contained in the given action into the model storage, if there is any.\n     */\n    protected storeNewModel(action: Action): void {\n        if (action.kind === SetModelCommand.KIND\n            || action.kind === UpdateModelCommand.KIND\n            || action.kind === RequestBoundsCommand.KIND) {\n            const newRoot = (action as any).newRoot;\n            if (newRoot) {\n                this.currentRoot = newRoot as SModelRootSchema;\n                if (action.kind === SetModelCommand.KIND || action.kind === UpdateModelCommand.KIND) {\n                    this.lastSubmittedModelType = newRoot.type;\n                }\n                this.storage.store(this.currentRoot);\n            }\n        }\n    }\n\n    /**\n     * If the server requires to compute a layout, the computed bounds are forwarded. Otherwise they\n     * are applied to the current model locally and a model update is triggered.\n     */\n    protected handleComputedBounds(action: ComputedBoundsAction): boolean {\n        if (this.viewerOptions.needsServerLayout) {\n            return true;\n        } else {\n            const index = new SModelIndex();\n            const root = this.currentRoot;\n            index.add(root);\n            for (const b of action.bounds) {\n                const element = index.getById(b.elementId);\n                if (element !== undefined)\n                    this.applyBounds(element, b.newBounds);\n            }\n            if (action.alignments !== undefined) {\n                for (const a of action.alignments) {\n                    const element = index.getById(a.elementId);\n                    if (element !== undefined)\n                        this.applyAlignment(element, a.newAlignment);\n                }\n            }\n            if (root.type === this.lastSubmittedModelType) {\n                this.actionDispatcher.dispatch(new UpdateModelAction(root));\n            } else {\n                this.actionDispatcher.dispatch(new SetModelAction(root));\n            }\n            this.lastSubmittedModelType = root.type;\n            return false;\n        }\n    }\n\n    protected applyBounds(element: SModelElementSchema, newBounds: Bounds) {\n        const e = element as any;\n        e.position = { x: newBounds.x, y: newBounds.y };\n        e.size = { width: newBounds.width, height: newBounds.height };\n    }\n\n    protected applyAlignment(element: SModelElementSchema, newAlignment: Point) {\n        const e = element as any;\n        e.alignment = { x: newAlignment.x, y: newAlignment.y };\n    }\n\n    protected handleExportSvgAction(action: ExportSvgAction): boolean {\n        const blob = new Blob([action.svg], {type: \"text/plain;charset=utf-8\"});\n        saveAs(blob, \"diagram.svg\");\n        return false;\n    }\n\n    protected handleServerStateAction(action: ServerStatusAction): boolean {\n        return false;\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { SModelRootSchema, SModelElementSchema } from '../base/model/smodel';\nimport { CollapseExpandAction } from '../features/expand/expand';\n\nexport interface DiagramState {\n    expansionState: ExpansionState\n}\n\nexport class ExpansionState {\n    expandedElementIds: string[] = [];\n\n    constructor(root: SModelRootSchema) {\n        this.initialize(root);\n    }\n\n    protected initialize(element: SModelElementSchema): void {\n        if ((element as any).expanded)\n            this.expandedElementIds.push(element.id);\n        if (element.children !== undefined)\n            element.children.forEach(child => this.initialize(child));\n    }\n\n    apply(action: CollapseExpandAction) {\n        for (const collapsed of action.collapseIds) {\n            const index = this.expandedElementIds.indexOf(collapsed);\n            if (index !== -1)\n                this.expandedElementIds.splice(index, 1);\n        }\n        for (const expanded of action.expandIds) {\n            this.expandedElementIds.push(expanded);\n        }\n    }\n\n    collapseAll() {\n        this.expandedElementIds = [];\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable, inject, optional } from \"inversify\";\nimport { Bounds, Point } from \"../utils/geometry\";\nimport { Deferred } from \"../utils/async\";\nimport { ILogger } from \"../utils/logging\";\nimport { TYPES } from \"../base/types\";\nimport { Action } from \"../base/actions/action\";\nimport { ActionHandlerRegistry } from \"../base/actions/action-handler\";\nimport { IActionDispatcher } from \"../base/actions/action-dispatcher\";\nimport { findElement } from \"../base/model/smodel-utils\";\nimport { ViewerOptions } from \"../base/views/viewer-options\";\nimport { RequestModelAction, SetModelAction } from \"../base/features/set-model\";\nimport { SModelElementSchema, SModelIndex, SModelRootSchema } from \"../base/model/smodel\";\nimport { ComputedBoundsAction, RequestBoundsAction } from '../features/bounds/bounds-manipulation';\nimport { Match, applyMatches } from \"../features/update/model-matching\";\nimport { UpdateModelAction, UpdateModelCommand } from \"../features/update/update-model\";\nimport { RequestPopupModelAction, SetPopupModelAction } from \"../features/hover/hover\";\nimport { ModelSource } from \"./model-source\";\nimport { ExportSvgAction } from '../features/export/svg-exporter';\nimport { saveAs } from 'file-saver';\nimport { CollapseExpandAction, CollapseExpandAllAction } from '../features/expand/expand';\nimport { DiagramState, ExpansionState } from './diagram-state';\n\n/**\n * A model source that allows to set and modify the model through function calls.\n * This class can be used as a facade over the action-based API of sprotty. It handles\n * actions for bounds calculation and model updates.\n */\n@injectable()\nexport class LocalModelSource extends ModelSource {\n\n    protected currentRoot: SModelRootSchema = {\n        type: 'NONE',\n        id: 'ROOT'\n    };\n\n    protected diagramState: DiagramState = {\n        expansionState: new ExpansionState(this.currentRoot)\n    };\n\n    /**\n     * The `type` property of the model root is used to determine whether a model update\n     * is a change of the previous model or a totally new one.\n     */\n    protected lastSubmittedModelType: string;\n\n    /**\n     * When client layout is active, model updates are not applied immediately. Instead the\n     * model is rendered on a hidden canvas first to derive actual bounds. The promises listed\n     * here are resolved after the new bounds have been applied and the new model state has\n     * been actually applied to the visible canvas.\n     */\n    protected pendingUpdates: Deferred<void>[] = [];\n\n    get model(): SModelRootSchema {\n        return this.currentRoot;\n    }\n\n    set model(root: SModelRootSchema) {\n        this.setModel(root);\n    }\n\n    constructor(@inject(TYPES.IActionDispatcher) actionDispatcher: IActionDispatcher,\n                @inject(TYPES.ActionHandlerRegistry) actionHandlerRegistry: ActionHandlerRegistry,\n                @inject(TYPES.ViewerOptions) viewerOptions: ViewerOptions,\n                @inject(TYPES.ILogger) protected readonly logger: ILogger,\n                @inject(TYPES.StateAwareModelProvider)@optional() protected modelProvider?: IStateAwareModelProvider,\n                @inject(TYPES.IPopupModelProvider)@optional() protected popupModelProvider?: IPopupModelProvider,\n                @inject(TYPES.IModelLayoutEngine)@optional() protected layoutEngine?: IModelLayoutEngine\n            ) {\n        super(actionDispatcher, actionHandlerRegistry, viewerOptions);\n    }\n\n    protected initialize(registry: ActionHandlerRegistry): void {\n        super.initialize(registry);\n\n        // Register model manipulation commands\n        registry.registerCommand(UpdateModelCommand);\n\n        // Register this model source\n        registry.register(ComputedBoundsAction.KIND, this);\n        registry.register(RequestPopupModelAction.KIND, this);\n        registry.register(CollapseExpandAction.KIND, this);\n        registry.register(CollapseExpandAllAction.KIND, this);\n    }\n\n    /**\n     * Set the model without incremental update.\n     */\n    setModel(newRoot: SModelRootSchema): Promise<void> {\n        this.currentRoot = newRoot;\n        this.diagramState = {\n            expansionState: new ExpansionState(newRoot)\n        };\n        return this.submitModel(newRoot, false);\n    }\n\n    /**\n     * Apply an incremental update to the model with an animation showing the transition to\n     * the new state. If `newRoot` is undefined, the current root is submitted; in that case\n     * it is assumed that it has been modified before.\n     */\n    updateModel(newRoot?: SModelRootSchema): Promise<void> {\n        if (newRoot === undefined) {\n            return this.submitModel(this.currentRoot, true);\n        } else {\n            this.currentRoot = newRoot;\n            return this.submitModel(newRoot, true);\n        }\n    }\n\n    /**\n     * If client layout is active, run a `RequestBoundsAction` and wait for the resulting\n     * `ComputedBoundsAction`, otherwise call `doSubmitModel(…)` directly.\n     */\n    protected submitModel(newRoot: SModelRootSchema, update: boolean | Match[]): Promise<void> {\n        if (this.viewerOptions.needsClientLayout) {\n            const deferred = new Deferred<void>();\n            this.pendingUpdates.push(deferred);\n            this.actionDispatcher.dispatch(new RequestBoundsAction(newRoot));\n            return deferred.promise;\n        } else {\n            return this.doSubmitModel(newRoot, update);\n        }\n    }\n\n    /**\n     * Submit the given model with an `UpdateModelAction` or a `SetModelAction` depending on the\n     * `update` argument. If available, the model layout engine is invoked first.\n     */\n    protected async doSubmitModel(newRoot: SModelRootSchema, update: boolean | Match[], index?: SModelIndex<SModelElementSchema>): Promise<void> {\n        if (this.layoutEngine !== undefined) {\n            try {\n                const layoutResult = this.layoutEngine.layout(newRoot, index);\n                if (layoutResult instanceof Promise)\n                    newRoot = await layoutResult;\n                else if (layoutResult !== undefined)\n                    newRoot = layoutResult;\n            } catch (error) {\n                this.logger.error(this, error.toString(), error.stack);\n            }\n        }\n\n        const lastSubmittedModelType = this.lastSubmittedModelType;\n        this.lastSubmittedModelType = newRoot.type;\n        const updates = this.pendingUpdates;\n        this.pendingUpdates = [];\n        if (update && newRoot.type === lastSubmittedModelType) {\n            const input = Array.isArray(update) ? update : newRoot;\n            await this.actionDispatcher.dispatch(new UpdateModelAction(input));\n        } else {\n            await this.actionDispatcher.dispatch(new SetModelAction(newRoot));\n        }\n        updates.forEach(d => d.resolve());\n    }\n\n    /**\n     * Modify the current model with an array of matches.\n     */\n    applyMatches(matches: Match[]): Promise<void> {\n        const root = this.currentRoot;\n        applyMatches(root, matches);\n        return this.submitModel(root, matches);\n    }\n\n    /**\n     * Modify the current model by adding new elements.\n     */\n    addElements(elements: (SModelElementSchema | { element: SModelElementSchema, parentId: string })[]): Promise<void> {\n        const matches: Match[] = [];\n        for (const e of elements) {\n            const anye: any = e;\n            if (anye.element !== undefined && anye.parentId !== undefined) {\n                matches.push({\n                    right: anye.element,\n                    rightParentId: anye.parentId\n                });\n            } else if (anye.id !== undefined) {\n                matches.push({\n                    right: anye,\n                    rightParentId: this.currentRoot.id\n                });\n            }\n        }\n        return this.applyMatches(matches);\n    }\n\n    /**\n     * Modify the current model by removing elements.\n     */\n    removeElements(elements: (string | { elementId: string, parentId: string })[]): Promise<void> {\n        const matches: Match[] = [];\n        const index = new SModelIndex();\n        index.add(this.currentRoot);\n        for (const e of elements) {\n            const anye: any = e;\n            if (anye.elementId !== undefined && anye.parentId !== undefined) {\n                const element = index.getById(anye.elementId);\n                if (element !== undefined) {\n                    matches.push({\n                        left: element,\n                        leftParentId: anye.parentId\n                    });\n                }\n            } else {\n                const element = index.getById(anye);\n                if (element !== undefined) {\n                    matches.push({\n                        left: element,\n                        leftParentId: this.currentRoot.id\n                    });\n                }\n            }\n        }\n        return this.applyMatches(matches);\n    }\n\n\n    // ----- Methods for handling incoming actions ----------------------------\n\n    handle(action: Action): void {\n        switch (action.kind) {\n            case RequestModelAction.KIND:\n                this.handleRequestModel(action as RequestModelAction);\n                break;\n            case ComputedBoundsAction.KIND:\n                this.handleComputedBounds(action as ComputedBoundsAction);\n                break;\n            case RequestPopupModelAction.KIND:\n                this.handleRequestPopupModel(action as RequestPopupModelAction);\n                break;\n            case ExportSvgAction.KIND:\n                this.handleExportSvgAction(action as ExportSvgAction);\n                break;\n            case CollapseExpandAction.KIND:\n                this.handleCollapseExpandAction(action as CollapseExpandAction);\n                break;\n            case CollapseExpandAllAction.KIND:\n                this.handleCollapseExpandAllAction(action as CollapseExpandAllAction);\n                break;\n        }\n    }\n\n    protected handleRequestModel(action: RequestModelAction): void {\n        if (this.modelProvider)\n            this.currentRoot = this.modelProvider.getModel(this.diagramState, this.currentRoot);\n        this.submitModel(this.currentRoot, false);\n    }\n\n    protected handleComputedBounds(action: ComputedBoundsAction): void {\n        const root = this.currentRoot;\n        const index = new SModelIndex();\n        index.add(root);\n        for (const b of action.bounds) {\n            const element = index.getById(b.elementId);\n            if (element !== undefined)\n                this.applyBounds(element, b.newBounds);\n        }\n        if (action.alignments !== undefined) {\n            for (const a of action.alignments) {\n                const element = index.getById(a.elementId);\n                if (element !== undefined)\n                    this.applyAlignment(element, a.newAlignment);\n            }\n        }\n        this.doSubmitModel(root, true, index);\n    }\n\n    protected applyBounds(element: SModelElementSchema, newBounds: Bounds) {\n        const e = element as any;\n        e.position = { x: newBounds.x, y: newBounds.y };\n        e.size = { width: newBounds.width, height: newBounds.height };\n    }\n\n    protected applyAlignment(element: SModelElementSchema, newAlignment: Point) {\n        const e = element as any;\n        e.alignment = { x: newAlignment.x, y: newAlignment.y };\n    }\n\n    protected handleRequestPopupModel(action: RequestPopupModelAction): void {\n        if (this.popupModelProvider !== undefined) {\n            const element = findElement(this.currentRoot, action.elementId);\n            const popupRoot = this.popupModelProvider.getPopupModel(action, element);\n            if (popupRoot !== undefined) {\n                popupRoot.canvasBounds = action.bounds;\n                this.actionDispatcher.dispatch(new SetPopupModelAction(popupRoot));\n            }\n        }\n    }\n\n    protected handleExportSvgAction(action: ExportSvgAction): void {\n        const blob = new Blob([action.svg], {type: \"text/plain;charset=utf-8\"});\n        saveAs(blob, \"diagram.svg\");\n    }\n\n    protected handleCollapseExpandAction(action: CollapseExpandAction): void {\n        if (this.modelProvider !== undefined) {\n            this.diagramState.expansionState.apply(action);\n            const expandedModel = this.modelProvider.getModel(this.diagramState, this.currentRoot);\n            this.updateModel(expandedModel);\n        }\n    }\n\n    protected handleCollapseExpandAllAction(action: CollapseExpandAllAction): void {\n        if (this.modelProvider !== undefined) {\n            if (action.expand) {\n                // Expanding all elements locally is currently not supported\n            } else {\n                this.diagramState.expansionState.collapseAll();\n            }\n            const expandedModel = this.modelProvider.getModel(this.diagramState, this.currentRoot);\n            this.updateModel(expandedModel);\n        }\n    }\n}\n\n/**\n * @deprecated Use IPopupModelProvider instead.\n */\nexport type PopupModelFactory = (request: RequestPopupModelAction, element?: SModelElementSchema)\n    => SModelRootSchema | undefined;\n\nexport interface IPopupModelProvider {\n    getPopupModel(request: RequestPopupModelAction, element?: SModelElementSchema): SModelRootSchema | undefined;\n}\n\nexport interface IStateAwareModelProvider  {\n    getModel(diagramState: DiagramState, currentRoot?: SModelRootSchema): SModelRootSchema\n}\n\nexport interface IModelLayoutEngine {\n    layout(model: SModelRootSchema, index?: SModelIndex<SModelElementSchema>): SModelRootSchema | Promise<SModelRootSchema>\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable, inject } from \"inversify\";\nimport { ILogger, LogLevel } from \"../utils/logging\";\nimport { TYPES } from \"../base/types\";\nimport { Action } from \"../base/actions/action\";\nimport { ModelSource } from \"./model-source\";\n\nexport class LoggingAction implements Action {\n    static readonly KIND = 'logging';\n    readonly kind = LoggingAction.KIND;\n\n    constructor(public readonly severity: string,\n                public readonly time: string,\n                public readonly caller: string,\n                public readonly message: string,\n                public readonly params: string[]) {\n    }\n}\n\n/**\n * A logger that forwards messages of type 'error', 'warn', and 'info' to the model source.\n */\n@injectable()\nexport class ForwardingLogger implements ILogger {\n    constructor(@inject(TYPES.ModelSourceProvider) protected modelSourceProvider: () => Promise<ModelSource>,\n                @inject(TYPES.LogLevel) public logLevel: LogLevel) {}\n\n    error(thisArg: any, message: string, ...params: any[]): void {\n        if (this.logLevel >= LogLevel.error)\n            this.forward(thisArg, message, LogLevel.error, params);\n    }\n\n    warn(thisArg: any, message: string, ...params: any[]): void {\n        if (this.logLevel >= LogLevel.warn)\n            this.forward(thisArg, message, LogLevel.warn, params);\n    }\n\n    info(thisArg: any, message: string, ...params: any[]): void {\n        if (this.logLevel >= LogLevel.info)\n            this.forward(thisArg, message, LogLevel.info, params);\n    }\n\n    log(thisArg: any, message: string, ...params: any[]): void {\n        if (this.logLevel >= LogLevel.log) {\n            // We cannot forward 'log' level messages since that would lead to endless loops\n            try {\n                const caller = typeof thisArg === 'object' ? thisArg.constructor.name : String(thisArg);\n                console.log.apply(thisArg, [caller + ': ' + message, ...params]);\n            } catch (error) {}\n        }\n    }\n\n    protected forward(thisArg: any, message: string, logLevel: LogLevel, params: any[]) {\n        const date = new Date();\n        const action = new LoggingAction(\n            LogLevel[logLevel],\n            date.toLocaleTimeString(),\n            typeof thisArg === 'object' ? thisArg.constructor.name : String(thisArg),\n            message,\n            params.map(p => JSON.stringify(p))\n        );\n        this.modelSourceProvider().then(modelSource => {\n            try {\n                modelSource.handle(action);\n            } catch (error) {\n                try {\n                    console.log.apply(thisArg, [message, action, error]);\n                } catch (error) {}\n            }\n        });\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable } from \"inversify\";\nimport { TYPES } from \"../base/types\";\nimport { Action } from \"../base/actions/action\";\nimport { ActionHandlerRegistry, IActionHandler } from \"../base/actions/action-handler\";\nimport { IActionDispatcher } from \"../base/actions/action-dispatcher\";\nimport { ViewerOptions } from \"../base/views/viewer-options\";\nimport { RequestModelAction, SetModelCommand } from \"../base/features/set-model\";\nimport { ICommand } from \"../base/commands/command\";\nimport { ExportSvgAction } from '../features/export/svg-exporter';\n\n/**\n * A model source is serving the model to the event cycle. It represents\n * the entry point to the client for external sources, such as model\n * editors.\n *\n * As an IActionHandler it listens to actions in and reacts to them with\n * commands or actions if necessary. This way, you can implement action\n * protocols between the client and the outside world.\n *\n * There are two default implementations for a ModelSource:\n * <ul>\n * <li>the LocalModelSource handles the actions to calculate bounds and\n * set/update the model</li>\n * <li>the DiagramServer connects via websocket to a remote source. It\n * can be used to connect to a model editor that provides the model,\n * layouts diagrams, transfers selection and answers model queries from\n * the client.</li>\n */\n@injectable()\nexport abstract class ModelSource implements IActionHandler {\n\n    constructor(@inject(TYPES.IActionDispatcher) readonly actionDispatcher: IActionDispatcher,\n                @inject(TYPES.ActionHandlerRegistry) actionHandlerRegistry: ActionHandlerRegistry,\n                @inject(TYPES.ViewerOptions) protected viewerOptions: ViewerOptions) {\n        this.initialize(actionHandlerRegistry);\n    }\n\n    protected initialize(registry: ActionHandlerRegistry): void {\n        // Register model manipulation commands\n        registry.registerCommand(SetModelCommand);\n\n        // Register this model source\n        registry.register(RequestModelAction.KIND, this);\n        registry.register(ExportSvgAction.KIND, this);\n    }\n\n    abstract handle(action: Action): ICommand | Action | void;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable } from \"inversify\";\nimport { DiagramServer, ActionMessage } from \"./diagram-server\";\n\n/**\n * An external ModelSource that connects to the model provider using a\n * websocket.\n */\n@injectable()\nexport class WebSocketDiagramServer extends DiagramServer {\n\n    protected webSocket?: WebSocket;\n\n    listen(webSocket: WebSocket): void {\n        webSocket.addEventListener('message', event => {\n            this.messageReceived(event.data);\n        });\n        webSocket.addEventListener('error', event => {\n            this.logger.error(this, 'error event received', event);\n        });\n        this.webSocket = webSocket;\n    }\n\n    disconnect() {\n        if (this.webSocket) {\n            this.webSocket.close();\n            this.webSocket = undefined;\n        }\n    }\n\n    protected sendMessage(message: ActionMessage): void {\n        if (this.webSocket) {\n            this.webSocket.send(JSON.stringify(message));\n        } else {\n            throw new Error('WebSocket is not connected');\n        }\n    }\n}\n","/*\n * Copyright (C) 2018 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { Point, Bounds, center, almostEquals, PointToPointLine, Diamond, shiftTowards } from './geometry';\n\nexport function computeCircleAnchor(position: Point, radius: number, refPoint: Point, offset: number = 0): Point {\n    const cx = position.x + radius;\n    const cy = position.y + radius;\n    const dx = cx - refPoint.x;\n    const dy = cy - refPoint.y;\n    const distance = Math.sqrt(dx * dx + dy * dy);\n    const normX = (dx / distance) || 0;\n    const normY = (dy / distance) || 0;\n    return {\n        x: cx - normX * (radius + offset),\n        y: cy - normY * (radius + offset)\n    };\n}\n\nfunction getXIntersection(yIntersection: number, centerPoint: Point, point: Point): number {\n    const t = (yIntersection - centerPoint.y) / (point.y - centerPoint.y);\n    return (point.x - centerPoint.x) * t + centerPoint.x;\n}\n\nfunction getYIntersection(xIntersection: number, centerPoint: Point, point: Point): number {\n    const t = (xIntersection - centerPoint.x) / (point.x - centerPoint.x);\n    return (point.y - centerPoint.y) * t + centerPoint.y;\n}\n\nclass NearestPointFinder {\n    protected currentBest: Point | undefined;\n    protected currentDist: number = -1;\n\n    constructor(protected centerPoint: Point, protected refPoint: Point) {\n    }\n\n    addCandidate(x: number, y: number) {\n        const dx = this.refPoint.x - x;\n        const dy = this.refPoint.y - y;\n        const dist = dx * dx + dy * dy;\n        if (this.currentDist < 0 || dist < this.currentDist) {\n            this.currentBest = {\n                x: x,\n                y: y\n            };\n            this.currentDist = dist;\n        }\n    }\n\n    get best(): Point {\n        if (this.currentBest === undefined)\n            return this.centerPoint;\n        else\n            return this.currentBest;\n    }\n}\n\nexport function computeRectangleAnchor(bounds: Bounds, refPoint: Point, offset: number): Point {\n    const c = center(bounds);\n    const finder = new NearestPointFinder(c, refPoint);\n    if (!almostEquals(c.y, refPoint.y)) {\n        const xTop = getXIntersection(bounds.y, c, refPoint);\n        if (xTop >= bounds.x && xTop <= bounds.x + bounds.width)\n            finder.addCandidate(xTop, bounds.y - offset);\n        const xBottom = getXIntersection(bounds.y + bounds.height, c, refPoint);\n        if (xBottom >= bounds.x && xBottom <= bounds.x + bounds.width)\n            finder.addCandidate(xBottom, bounds.y + bounds.height + offset);\n    }\n    if (!almostEquals(c.x, refPoint.x)) {\n        const yLeft = getYIntersection(bounds.x, c, refPoint);\n        if (yLeft >= bounds.y && yLeft <= bounds.y + bounds.height)\n            finder.addCandidate(bounds.x - offset, yLeft);\n        const yRight = getYIntersection(bounds.x + bounds.width, c, refPoint);\n        if (yRight >= bounds.y && yRight <= bounds.y + bounds.height)\n            finder.addCandidate(bounds.x + bounds.width + offset, yRight);\n    }\n    return finder.best;\n}\n\nexport function computeDiamondAnchor(bounds: Bounds, refPoint: Point, offset: number): Point {\n    const referenceLine = new PointToPointLine(center(bounds), refPoint);\n    const closestDiamondSide = new Diamond(bounds).closestSideLine(refPoint);\n    const anchorPoint = closestDiamondSide.intersection(referenceLine);\n    return shiftTowards(anchorPoint, refPoint, offset);\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/**\n * Simple implementation of the deferred pattern.\n * An object that exposes a promise and functions to resolve and reject it.\n */\nexport class Deferred<T> {\n    resolve: (value?: T | PromiseLike<T>) => void;\n    reject: (reason?: any) => void;\n\n    readonly promise = new Promise<T>((resolve, reject) => {\n        this.resolve = resolve;\n        this.reject = reject;\n    });\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/**\n * Returns whether the mouse or keyboard event includes the CMD key\n * on Mac or CTRL key on Linux / others.\n */\nexport function isCtrlOrCmd(event: KeyboardEvent | MouseEvent) {\n    if (isMac())\n        return event.metaKey;\n    else\n        return event.ctrlKey;\n}\n\nexport function isMac(): boolean {\n    return window.navigator.userAgent.indexOf(\"Mac\") !== -1;\n}\n\nexport function isCrossSite(url: string): boolean {\n    if (url && typeof window !== 'undefined' && window.location) {\n        let baseURL: string = '';\n        if (window.location.protocol)\n            baseURL += window.location.protocol + '//';\n        if (window.location.host)\n            baseURL += window.location.host;\n        return baseURL.length > 0 && !url.startsWith(baseURL);\n    }\n    return false;\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nexport interface RGBColor {\n    red: number\n    green: number\n    blue: number\n}\n\nexport function rgb(red: number, green: number, blue: number): RGBColor {\n    return {\n        red: red,\n        green: green,\n        blue: blue\n    };\n}\n\nexport function toSVG(c: RGBColor): string {\n    return 'rgb(' + c.red + ',' + c.green + ',' + c.blue + ')';\n}\n\nexport class ColorMap {\n\n    constructor(protected stops: RGBColor[]) {\n    }\n\n    getColor(t: number): RGBColor {\n        t = Math.max(0, Math.min(0.99999999, t));\n        const i = Math.floor(t * this.stops.length);\n        return this.stops[i];\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/**\n * A Point is composed of the (x,y) coordinates of an object.\n */\nexport interface Point {\n    readonly x: number\n    readonly y: number\n}\n\n/**\n * (x,y) coordinates of the origin.\n */\nexport const ORIGIN_POINT: Point = Object.freeze({\n    x: 0,\n    y: 0\n});\n\n/**\n * Adds two points.\n * @param {Point} p1 - First point\n * @param {Point} p2 - Second point\n * @returns {Point} The sum of the two points\n */\nexport function add(p1: Point, p2: Point): Point {\n    return {\n        x: p1.x + p2.x,\n        y: p1.y + p2.y\n    };\n}\n\n/**\n * Subtracts two points.\n * @param {Point} p1 - First point\n * @param {Point} p2 - Second point\n * @returns {Point} The difference of the two points\n */\nexport function subtract(p1: Point, p2: Point): Point {\n    return {\n        x: p1.x - p2.x,\n        y: p1.y - p2.y\n    };\n}\n\n/**\n * The Dimension of an object is composed of its width and height.\n */\nexport interface Dimension {\n    readonly width: number\n    readonly height: number\n}\n\n/**\n * A dimension with both width and height set to a negative value, which is considered as undefined.\n */\nexport const EMPTY_DIMENSION: Dimension = Object.freeze({\n    width: -1,\n    height: -1\n});\n\n/**\n * Checks whether the given dimention is valid, i.e. the width and height are non-zero.\n * @param {Dimension} b - Dimension object\n * @returns {boolean}\n */\nexport function isValidDimension(d: Dimension): boolean {\n    return d.width >= 0 && d.height >= 0;\n}\n\n/**\n * The bounds are the position (x, y) and dimension (width, height) of an object.\n */\nexport interface Bounds extends Point, Dimension {\n}\n\nexport const EMPTY_BOUNDS: Bounds = Object.freeze({\n    x: 0,\n    y: 0,\n    width: -1,\n    height: -1\n});\n\nexport function isBounds(element: any): element is Bounds {\n    return 'x' in element\n        && 'y' in element\n        && 'width' in element\n        && 'height' in element;\n}\n\n/**\n * Combines the bounds of two objects into one, so that the new bounds\n * are the minimum bounds that covers both of the original bounds.\n * @param {Bounds} b0 - First bounds object\n * @param {Bounds} b1 - Second bounds object\n * @returns {Bounds} The combined bounds\n */\nexport function combine(b0: Bounds, b1: Bounds): Bounds {\n    const minX = Math.min(b0.x, b1.x);\n    const minY = Math.min(b0.y, b1.y);\n    const maxX = Math.max(b0.x + (b0.width >= 0 ? b0.width : 0), b1.x + (b1.width >= 0 ? b1.width : 0));\n    const maxY = Math.max(b0.y + (b0.height >= 0 ? b0.height : 0), b1.y + (b1.height >= 0 ? b1.height : 0));\n    return {\n        x: minX, y: minY, width: maxX - minX, height: maxY - minY\n    };\n}\n\n/**\n * Translates the given bounds.\n * @param {Bounds} b - Bounds object\n * @param {Point} p - Vector by which to translate the bounds\n * @returns {Bounds} The translated bounds\n */\nexport function translate(b: Bounds, p: Point): Bounds {\n    return {\n        x: b.x + p.x,\n        y: b.y + p.y,\n        width: b.width,\n        height: b.height\n    };\n}\n\n/**\n * Returns the center point of the bounds of an object\n * @param {Bounds} b - Bounds object\n * @returns {Point} the center point\n */\nexport function center(b: Bounds): Point {\n    return {\n        x: b.x + (b.width >= 0 ? 0.5 * b.width : 0),\n        y: b.y + (b.height >= 0 ? 0.5 * b.height : 0)\n    };\n}\n\nexport function centerOfLine(s: Point, e: Point): Point {\n    const b: Bounds = {\n        x: s.x > e.x ? e.x : s.x,\n        y: s.y > e.y ? e.y : s.y,\n        width: Math.abs(e.x - s.x),\n        height: Math.abs(e.y - s.y)\n    };\n    return center(b);\n}\n\n/**\n * Checks whether the point p is included in the bounds b.\n */\nexport function includes(b: Bounds, p: Point): boolean {\n    return p.x >= b.x && p.x <= b.x + b.width && p.y >= b.y && p.y <= b.y + b.height;\n}\n\n/**\n * Represents an object's insets, for top, bottom, left and right\n */\nexport interface Insets {\n    top: number\n    bottom: number\n    left: number\n    right: number\n}\n\n/**\n * Enumeration of possible directions (left, right, up, down)\n */\nexport enum Direction { left, right, up, down }\n\n/**\n * Returns the \"straight line\" distance between two points.\n * @param {Point} a - First point\n * @param {Point} b - Second point\n * @returns {number} The Eucledian distance\n */\nexport function euclideanDistance(a: Point, b: Point): number {\n    const dx = b.x - a.x;\n    const dy = b.y - a.y;\n    return Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Returns the distance between two points in a grid, using a\n * strictly vertical and/or horizontal path (versus straight line).\n * @param {Point} a - First point\n * @param {Point} b - Second point\n * @returns {number} The Manhattan distance\n */\nexport function manhattanDistance(a: Point, b: Point): number {\n    return Math.abs(b.x - a.x) + Math.abs(b.y - a.y);\n}\n\n/**\n * Returns the maximum of the horizontal and the vertical distance.\n * @param {Point} a - First point\n * @param {Point} b - Second point\n * @returns {number} The maximum distance\n */\nexport function maxDistance(a: Point, b: Point): number {\n    return Math.max(Math.abs(b.x - a.x), Math.abs(b.y - a.y));\n}\n\n/**\n * Computes the angle in radians of the given point to the x-axis of the coordinate system.\n * The result is in the range [-pi, pi].\n * @param {Point} p - A point in the Eucledian plane\n */\nexport function angleOfPoint(p: Point): number {\n    return Math.atan2(p.y, p.x);\n}\n\n/**\n * Computes the angle in radians between the two given points (relative to the origin of the coordinate system).\n * The result is in the range [0, pi]. Returns NaN if the points are equal.\n * @param {Point} a - First point\n * @param {Point} b - Second point\n */\nexport function angleBetweenPoints(a: Point, b: Point): number {\n    const lengthProduct = Math.sqrt((a.x * a.x + a.y * a.y) * (b.x * b.x + b.y * b.y));\n    if (isNaN(lengthProduct) || lengthProduct === 0)\n        return NaN;\n    const dotProduct = a.x * b.x + a.y * b.y;\n    return Math.acos(dotProduct / lengthProduct);\n}\n\n/**\n * Computes a point that is the original `point` shifted towards `refPoint` by the given `distance`.\n * @param {Point} point - Point to shift\n * @param {Point} refPoint - Point to shift towards\n * @param {Point} distance - Distance to shift\n */\nexport function shiftTowards(point: Point, refPoint: Point, distance: number): Point {\n    const diff = subtract(refPoint, point);\n    const normalized = normalize(diff);\n    const shift = {x: normalized.x * distance, y: normalized.y * distance};\n    return add(point, shift);\n}\n\n/**\n * Computes the normalized vector from the vector given in `point`; that is, computing its unit vector.\n * @param {Point} point - Point representing the vector to be normalized\n * @returns {Point} The normalized point\n */\nexport function normalize(point: Point): Point {\n    const mag = magnitude(point);\n    if (mag === 0 || mag === 1) {\n        return ORIGIN_POINT;\n    }\n    return {\n        x: point.x / mag,\n        y: point.y / mag\n    };\n}\n\n/**\n * Computes the magnitude of the vector given in `point`.\n * @param {Point} point - Point representing the vector to compute the magnitude for\n * @returns {number} The magnitude or also known as length of the `point`\n */\nexport function magnitude(point: Point): number {\n    return Math.sqrt(Math.pow(point.x, 2) + Math.pow(point.y, 2));\n}\n\n/**\n * Converts from radians to degrees\n * @param {number} a - A value in radians\n * @returns {number} The converted value\n */\nexport function toDegrees(a: number): number {\n    return a * 180 / Math.PI;\n}\n\n/**\n * Converts from degrees to radians\n * @param {number} a - A value in degrees\n * @returns {number} The converted value\n */\nexport function toRadians(a: number): number {\n    return a * Math.PI / 180;\n}\n\n/**\n * Returns whether two numbers are almost equal, within a small margin (0.001)\n * @param {number} a - First number\n * @param {number} b - Second number\n * @returns {boolean} True if the two numbers are almost equal\n */\nexport function almostEquals(a: number, b: number): boolean {\n    return Math.abs(a - b) < 1e-3;\n}\n\n/**\n * A diamond or rhombus is a quadrilateral whose four sides all have the same length.\n * It consinsts of four points, a `topPoint`, `rightPoint`, `bottomPoint`, and a `leftPoint`,\n * which are connected by four lines -- the `topRightSideLight`, `topLeftSideLine`, `bottomRightSideLine`,\n * and the `bottomLeftSideLine`.\n */\nexport class Diamond {\n\n    constructor(protected bounds: Bounds) { }\n\n    get topPoint(): Point {\n        return {\n            x: this.bounds.x + this.bounds.width / 2,\n            y: this.bounds.y\n        };\n    }\n\n    get rightPoint(): Point {\n        return {\n            x: this.bounds.x + this.bounds.width,\n            y: this.bounds.y + this.bounds.height / 2\n        };\n    }\n\n    get bottomPoint(): Point {\n        return {\n            x: this.bounds.x + this.bounds.width / 2,\n            y: this.bounds.y + this.bounds.height\n        };\n    }\n\n    get leftPoint(): Point {\n        return {\n            x: this.bounds.x,\n            y: this.bounds.y + this.bounds.height / 2\n        };\n    }\n\n    get topRightSideLine(): Line {\n        return new PointToPointLine(this.topPoint, this.rightPoint);\n    }\n\n    get topLeftSideLine(): Line {\n        return new PointToPointLine(this.topPoint, this.leftPoint);\n    }\n\n    get bottomRightSideLine(): Line {\n        return new PointToPointLine(this.bottomPoint, this.rightPoint);\n    }\n\n    get bottomLeftSideLine(): Line {\n        return new PointToPointLine(this.bottomPoint, this.leftPoint);\n    }\n\n    /**\n     * Return the closest side of this diamond to the specified `refPoint`.\n     * @param {Point} refPoint a reference point\n     * @returns {Line} a line representing the closest side\n     */\n    closestSideLine(refPoint: Point): Line {\n        const c = center(this.bounds);\n        if (refPoint.x > c.x) {\n            if (refPoint.y > c.y) {\n                return this.bottomRightSideLine;\n            } else {\n                return this.topRightSideLine;\n            }\n        } else {\n            if (refPoint.y > c.y) {\n                return this.bottomLeftSideLine;\n            } else {\n                return this.topLeftSideLine;\n            }\n        }\n    }\n}\n\n/**\n * A line represented in its standard form `a*x + b*y = c`.\n */\nexport interface Line {\n\n    readonly a: number\n    readonly b: number\n    readonly c: number\n\n    intersection(otherLine: Line): Point\n}\n\n/**\n * A line made up from two points.\n */\nexport class PointToPointLine implements Line {\n\n    constructor(protected p1: Point, protected p2: Point) { }\n\n    get a(): number {\n        return this.p1.y - this.p2.y;\n    }\n\n    get b(): number {\n        return this.p2.x - this.p1.x;\n    }\n\n    get c(): number {\n        return this.p2.x * this.p1.y - this.p1.x * this.p2.y;\n    }\n\n    intersection(other: Line): Point {\n        return {\n            x: (this.c * other.b - other.c * this.b) / (this.a * other.b - other.a * this.b),\n            y: (this.a * other.c - other.a * this.c) / (this.a * other.b - other.a * this.b)\n        };\n    }\n}\n","/*\n * Copyright (C) 2018 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/**\n * An iterable that allows filtering, mapping values etc. with a fluent API.\n * Arrays conform to this interface, so an array can be passed at every place where\n * a FluentIterable is expected.\n */\nexport interface FluentIterable<T> extends Iterable<T> {\n    filter(callback: (element: T) => boolean): FluentIterable<T>\n    map<T2>(callback: (element: T) => T2): FluentIterable<T2>\n    forEach(callback: (element: T, index: number) => void): void\n}\n\n/**\n * A helper class that allows to easily create fluent iterables.\n */\nexport class FluentIterableImpl<S, T> implements FluentIterable<T> {\n\n    constructor(private readonly startFn: () => S,\n                private readonly nextFn: (state: S) => IteratorResult<T>) {}\n\n    [Symbol.iterator]() {\n        const iterator = {\n            state: this.startFn(),\n            next: () => this.nextFn(iterator.state),\n            [Symbol.iterator]: () => iterator\n        };\n        return iterator;\n    }\n\n    filter(callback: (element: T) => boolean): FluentIterable<T> {\n        return filterIterable(this, callback);\n    }\n\n    map<T2>(callback: (element: T) => T2): FluentIterable<T2> {\n        return mapIterable(this, callback);\n    }\n\n    forEach(callback: (element: T, index: number) => void): void {\n        const iterator = this[Symbol.iterator]();\n        let index = 0;\n        let result: IteratorResult<T>;\n        do {\n            result = iterator.next();\n            if (result.value !== undefined)\n                callback(result.value, index);\n            index++;\n        } while (!result.done);\n    }\n}\n\n/**\n * Converts a FluentIterable into an array. If the input is an array, it is returned unchanged.\n */\nexport function toArray<T>(input: FluentIterable<T>): T[] {\n    if (input.constructor === Array) {\n        return input as T[];\n    }\n    const result: T[] = [];\n    input.forEach(element => result.push(element));\n    return result;\n}\n\nexport const DONE_RESULT: IteratorResult<any> = Object.freeze({ done: true, value: undefined });\n\n/**\n * Create a fluent iterable that filters the content of the given iterable or array.\n */\nexport function filterIterable<T>(input: Iterable<T> | ArrayLike<T>, callback: (element: T) => boolean): FluentIterable<T> {\n    return new FluentIterableImpl(\n        () => createIterator(input),\n        (iterator) => {\n            let result: IteratorResult<T>;\n            do {\n                result = iterator.next();\n            } while (!result.done && !callback(result.value));\n            return result;\n        }\n    );\n}\n\n/**\n * Create a fluent iterable that maps the content of the given iterable or array.\n */\nexport function mapIterable<T1, T2>(input: Iterable<T1> | ArrayLike<T1>, callback: (element: T1) => T2): FluentIterable<T2> {\n    return new FluentIterableImpl(\n        () => createIterator(input),\n        (iterator) => {\n            const { done, value } = iterator.next();\n            if (done)\n                return DONE_RESULT;\n            else\n                return { done: false, value: callback(value) };\n        }\n    );\n}\n\n/**\n * Create an iterator for the given iterable or array.\n */\nfunction createIterator<T>(collection: Iterable<T> | ArrayLike<T>): Iterator<T> {\n    const method = (collection as Iterable<T>)[Symbol.iterator];\n    if (typeof method === 'function') {\n        return method.call(collection);\n    }\n    const length = (collection as ArrayLike<T>).length;\n    if (typeof length === 'number' && length >= 0) {\n        return new ArrayIterator(collection as ArrayLike<T>);\n    }\n    return { next: () => DONE_RESULT };\n}\n\n/**\n * Iterator implementation for arrays.\n */\nclass ArrayIterator<T> implements IterableIterator<T> {\n    constructor(private readonly array: ArrayLike<T>) {}\n\n    private index = 0;\n\n    next(): IteratorResult<T> {\n        if (this.index < this.array.length)\n            return { done: false, value: this.array[this.index++] };\n        else\n            return DONE_RESULT;\n    }\n\n    [Symbol.iterator]() {\n        return this;\n    }\n}\n","/*\n * Copyright (C) 2018 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License'); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { isMac } from './browser';\n\n/**\n * Returns whether the keyboard event matches the keystroke described by the given\n * code and modifiers. The code must comply to the format of the `code` property\n * of KeyboardEvent, but in contrast to that property, the actual keyboard layout is\n * considered by this function if possible.\n */\nexport function matchesKeystroke(event: KeyboardEvent, code: KeyCode, ...modifiers: KeyboardModifier[]): boolean {\n    if (getActualCode(event) !== code)\n        return false;\n    if (isMac()) {\n        if (event.ctrlKey !== (modifiers.findIndex(m => m === 'ctrl') >= 0))\n            return false;\n        if (event.metaKey !== (modifiers.findIndex(m => m === 'meta' || m === 'ctrlCmd') >= 0))\n            return false;\n    } else {\n        if (event.ctrlKey !== (modifiers.findIndex(m => m === 'ctrl' || m === 'ctrlCmd') >= 0))\n            return false;\n        if (event.metaKey !== (modifiers.findIndex(m => m === 'meta') >= 0))\n            return false;\n    }\n    if (event.altKey !== (modifiers.findIndex(m => m === 'alt') >= 0))\n        return false;\n    if (event.shiftKey !== (modifiers.findIndex(m => m === 'shift') >= 0))\n        return false;\n    return true;\n}\n\nexport type KeyboardModifier = 'ctrl' | 'meta' | 'ctrlCmd' | 'alt' | 'shift';\n\nexport type KeyCode =\n    'AltLeft'|'AltRight'|'ArrowDown'|'ArrowLeft'|'ArrowRight'|'ArrowUp'|'Backslash'|'Backspace'|'Backquote'\n    |'BracketLeft'|'BracketRight'|'CapsLock'|'Comma'|'ContextMenu'|'ControlLeft'|'ControlRight'|'Convert'|'Delete'\n    |'Digit0'|'Digit1'|'Digit2'|'Digit3'|'Digit4'|'Digit5'|'Digit6'|'Digit7'|'Digit8'|'Digit9'\n    |'F1'|'F2'|'F3'|'F4'|'F5'|'F6'|'F7'|'F8'|'F9'|'F10'|'F11'|'F12'|'F13'|'F14'|'F15'|'F16'|'F17'|'F18'|'F19'|'F20'|'F21'|'F22'|'F23'|'F24'\n    |'End'|'Enter'|'Equal'|'Escape'|'Home'|'Insert'|'IntlBackslash'|'IntlRo'|'IntlYen'|'KanaMode'\n    |'KeyA'|'KeyB'|'KeyC'|'KeyD'|'KeyE'|'KeyF'|'KeyG'|'KeyH'|'KeyI'|'KeyJ'|'KeyK'|'KeyL'|'KeyM'\n    |'KeyN'|'KeyO'|'KeyP'|'KeyQ'|'KeyR'|'KeyS'|'KeyT'|'KeyU'|'KeyV'|'KeyW'|'KeyX'|'KeyY'|'KeyZ'\n    |'MetaLeft'|'MetaRight'|'Minus'|'NonConvert'|'NumLock'\n    |'Numpad0'|'Numpad1'|'Numpad2'|'Numpad3'|'Numpad4'|'Numpad5'|'Numpad6'|'Numpad7'|'Numpad8'|'Numpad9'\n    |'NumpadAdd'|'NumpadComma'|'NumpadDecimal'|'NumpadDivide'|'NumpadEnter'|'NumpadEqual'|'NumpadMultiply'\n    |'NumpadSeparator'|'NumpadSubtract'|'OSLeft'|'OSRight'|'PageDown'|'PageUp'|'Pause'|'Period'|'PrintScreen'\n    |'Quote'|'ScrollLock'|'Semicolon'|'ShiftLeft'|'ShiftRight'|'Slash'|'Space'|'Tab';\n\n/**\n * Determines a key code from the given event. This is necessary because the `code` property of\n * a KeyboardEvent does not consider keyboard layouts.\n */\nexport function getActualCode(event: KeyboardEvent): KeyCode {\n    if (event.keyCode) {\n        const result = STRING_CODE[event.keyCode];\n        if (result !== undefined)\n            return result;\n    }\n    return event.code as KeyCode;\n}\n\nconst STRING_CODE: { [keyCode: number]: KeyCode } = new Array(256);\n\n(() => {\n    function addKeyCode(stringCode: KeyCode, numericCode: number): void {\n        if (STRING_CODE[numericCode] === undefined)\n            STRING_CODE[numericCode] = stringCode;\n    }\n\n    addKeyCode('Pause', 3);\n    addKeyCode('Backspace', 8);\n    addKeyCode('Tab', 9);\n    addKeyCode('Enter', 13);\n    addKeyCode('ShiftLeft', 16);\n    addKeyCode('ShiftRight', 16);\n    addKeyCode('ControlLeft', 17);\n    addKeyCode('ControlRight', 17);\n    addKeyCode('AltLeft', 18);\n    addKeyCode('AltRight', 18);\n    addKeyCode('CapsLock', 20);\n    addKeyCode('Escape', 27);\n    addKeyCode('Space', 32);\n    addKeyCode('PageUp', 33);\n    addKeyCode('PageDown', 34);\n    addKeyCode('End', 35);\n    addKeyCode('Home', 36);\n    addKeyCode('ArrowLeft', 37);\n    addKeyCode('ArrowUp', 38);\n    addKeyCode('ArrowRight', 39);\n    addKeyCode('ArrowDown', 40);\n    addKeyCode('Insert', 45);\n    addKeyCode('Delete', 46);\n\n    addKeyCode('Digit1', 49);\n    addKeyCode('Digit2', 50);\n    addKeyCode('Digit3', 51);\n    addKeyCode('Digit4', 52);\n    addKeyCode('Digit5', 53);\n    addKeyCode('Digit6', 54);\n    addKeyCode('Digit7', 55);\n    addKeyCode('Digit8', 56);\n    addKeyCode('Digit9', 57);\n    addKeyCode('Digit0', 48);\n\n    addKeyCode('KeyA', 65);\n    addKeyCode('KeyB', 66);\n    addKeyCode('KeyC', 67);\n    addKeyCode('KeyD', 68);\n    addKeyCode('KeyE', 69);\n    addKeyCode('KeyF', 70);\n    addKeyCode('KeyG', 71);\n    addKeyCode('KeyH', 72);\n    addKeyCode('KeyI', 73);\n    addKeyCode('KeyJ', 74);\n    addKeyCode('KeyK', 75);\n    addKeyCode('KeyL', 76);\n    addKeyCode('KeyM', 77);\n    addKeyCode('KeyN', 78);\n    addKeyCode('KeyO', 79);\n    addKeyCode('KeyP', 80);\n    addKeyCode('KeyQ', 81);\n    addKeyCode('KeyR', 82);\n    addKeyCode('KeyS', 83);\n    addKeyCode('KeyT', 84);\n    addKeyCode('KeyU', 85);\n    addKeyCode('KeyV', 86);\n    addKeyCode('KeyW', 87);\n    addKeyCode('KeyX', 88);\n    addKeyCode('KeyY', 89);\n    addKeyCode('KeyZ', 90);\n\n    addKeyCode('OSLeft', 91);\n    addKeyCode('MetaLeft', 91);\n    addKeyCode('OSRight', 92);\n    addKeyCode('MetaRight', 92);\n    addKeyCode('ContextMenu', 93);\n\n    addKeyCode('Numpad0', 96);\n    addKeyCode('Numpad1', 97);\n    addKeyCode('Numpad2', 98);\n    addKeyCode('Numpad3', 99);\n    addKeyCode('Numpad4', 100);\n    addKeyCode('Numpad5', 101);\n    addKeyCode('Numpad6', 102);\n    addKeyCode('Numpad7', 103);\n    addKeyCode('Numpad8', 104);\n    addKeyCode('Numpad9', 105);\n    addKeyCode('NumpadMultiply', 106);\n    addKeyCode('NumpadAdd', 107);\n    addKeyCode('NumpadSeparator', 108);\n    addKeyCode('NumpadSubtract', 109);\n    addKeyCode('NumpadDecimal', 110);\n    addKeyCode('NumpadDivide', 111);\n\n    addKeyCode('F1', 112);\n    addKeyCode('F2', 113);\n    addKeyCode('F3', 114);\n    addKeyCode('F4', 115);\n    addKeyCode('F5', 116);\n    addKeyCode('F6', 117);\n    addKeyCode('F7', 118);\n    addKeyCode('F8', 119);\n    addKeyCode('F9', 120);\n    addKeyCode('F10', 121);\n    addKeyCode('F11', 122);\n    addKeyCode('F12', 123);\n    addKeyCode('F13', 124);\n    addKeyCode('F14', 125);\n    addKeyCode('F15', 126);\n    addKeyCode('F16', 127);\n    addKeyCode('F17', 128);\n    addKeyCode('F18', 129);\n    addKeyCode('F19', 130);\n    addKeyCode('F20', 131);\n    addKeyCode('F21', 132);\n    addKeyCode('F22', 133);\n    addKeyCode('F23', 134);\n    addKeyCode('F24', 135);\n\n    addKeyCode('NumLock', 144);\n    addKeyCode('ScrollLock', 145);\n\n    addKeyCode('Semicolon', 186);\n    addKeyCode('Equal', 187);\n    addKeyCode('Comma', 188);\n    addKeyCode('Minus', 189);\n    addKeyCode('Period', 190);\n    addKeyCode('Slash', 191);\n    addKeyCode('Backquote', 192);\n    addKeyCode('IntlRo', 193);\n    addKeyCode('BracketLeft', 219);\n    addKeyCode('Backslash', 220);\n    addKeyCode('BracketRight', 221);\n    addKeyCode('Quote', 222);\n    addKeyCode('IntlYen', 255);\n})();\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable } from \"inversify\";\nimport { TYPES } from \"../base/types\";\nimport { ViewerOptions } from \"../base/views/viewer-options\";\n\nexport interface ILogger {\n    logLevel: LogLevel\n\n    error(thisArg: any, message: string, ...params: any[]): void\n    warn(thisArg: any, message: string, ...params: any[]): void\n    info(thisArg: any, message: string, ...params: any[]): void\n    log(thisArg: any, message: string, ...params: any[]): void\n}\n\nexport enum LogLevel { none = 0, error = 1, warn = 2, info = 3, log = 4 }\n\n@injectable()\nexport class NullLogger implements ILogger {\n    logLevel: LogLevel = LogLevel.none;\n\n    error(thisArg: any, message: string, ...params: any[]): void {}\n    warn(thisArg: any, message: string, ...params: any[]): void {}\n    info(thisArg: any, message: string, ...params: any[]): void {}\n    log(thisArg: any, message: string, ...params: any[]): void {}\n}\n\n@injectable()\nexport class ConsoleLogger implements ILogger {\n\n    constructor(@inject(TYPES.LogLevel) public logLevel: LogLevel = LogLevel.log,\n                @inject(TYPES.ViewerOptions) protected viewOptions: ViewerOptions = { baseDiv: '' } as ViewerOptions) {\n    }\n\n    error(thisArg: any, message: string, ...params: any[]): void {\n        if (this.logLevel >= LogLevel.error)\n            try {\n                console.error.apply(thisArg, this.consoleArguments(thisArg, message, params));\n            } catch (error) {}\n    }\n\n    warn(thisArg: any, message: string, ...params: any[]): void {\n        if (this.logLevel >= LogLevel.warn)\n            try {\n                console.warn.apply(thisArg, this.consoleArguments(thisArg, message, params));\n            } catch (error) {}\n    }\n\n    info(thisArg: any, message: string, ...params: any[]): void {\n        if (this.logLevel >= LogLevel.info)\n            try {\n                console.info.apply(thisArg, this.consoleArguments(thisArg, message, params));\n            } catch (error) {}\n    }\n\n    log(thisArg: any, message: string, ...params: any[]): void {\n        if (this.logLevel >= LogLevel.log)\n            try {\n                console.log.apply(thisArg, this.consoleArguments(thisArg, message, params));\n            } catch (error) {}\n    }\n\n    protected consoleArguments(thisArg: any, message: string, params: any[]): any[] {\n        let caller: any;\n        if (typeof thisArg === 'object')\n            caller = thisArg.constructor.name;\n        else\n            caller = thisArg;\n        const date = new Date();\n        return [date.toLocaleTimeString() + ' ' + this.viewOptions.baseDiv + ' ' + caller + ': ' + message, ...params];\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable } from \"inversify\";\n\n@injectable()\nexport class ProviderRegistry<T, U> {\n    protected elements: Map<string, new(u: U) => T> = new Map;\n\n    register(key: string, cstr: new (u: U) => T) {\n        if (key === undefined)\n            throw new Error('Key is undefined');\n        if (this.hasKey(key))\n            throw new Error('Key is already registered: ' + key);\n        this.elements.set(key, cstr);\n    }\n\n    deregister(key: string) {\n        if (key === undefined)\n            throw new Error('Key is undefined');\n        this.elements.delete(key);\n    }\n\n    hasKey(key: string): boolean {\n        return this.elements.has(key);\n    }\n\n    get(key: string, arg: U): T {\n        const existingCstr = this.elements.get(key);\n        if (existingCstr)\n            return new existingCstr(arg);\n        else\n            return this.missing(key, arg);\n    }\n\n    protected missing(key: string, arg: U): T | never {\n        throw new Error('Unknown registry key: ' + key);\n    }\n}\n\n@injectable()\nexport class InstanceRegistry<T> {\n    protected elements: Map<string, T> = new Map;\n\n    register(key: string, instance: T) {\n        if (key === undefined)\n            throw new Error('Key is undefined');\n        if (this.hasKey(key))\n            throw new Error('Key is already registered: ' + key);\n        this.elements.set(key, instance);\n    }\n\n    deregister(key: string) {\n        if (key === undefined)\n            throw new Error('Key is undefined');\n        this.elements.delete(key);\n    }\n\n    hasKey(key: string): boolean {\n        return this.elements.has(key);\n    }\n\n    get(key: string): T {\n        const existingInstance = this.elements.get(key);\n        if (existingInstance)\n            return existingInstance;\n        else\n            return this.missing(key);\n    }\n\n    protected missing(key: string): T | never {\n        throw new Error('Unknown registry key: ' + key);\n    }\n}\n\n@injectable()\nexport class MultiInstanceRegistry<T> {\n    protected elements: Map<string, T[]> = new Map;\n\n    register(key: string, instance: T) {\n        if (key === undefined)\n            throw new Error('Key is undefined');\n        const instances = this.elements.get(key);\n        if (instances !== undefined)\n            instances.push(instance);\n        else\n            this.elements.set(key, [instance]);\n    }\n\n    deregisterAll(key: string) {\n        if (key === undefined)\n            throw new Error('Key is undefined');\n        this.elements.delete(key);\n    }\n\n    get(key: string): T[] {\n        const existingInstances = this.elements.get(key);\n        if (existingInstances !== undefined)\n            return existingInstances;\n        else\n            return [];\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\") you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport {\n    ILogger, SelectCommand, ActionHandlerRegistry, IActionDispatcher, SModelStorage, TYPES,\n    ViewerOptions, DiagramServer, ActionMessage, ExportSvgAction, RequestModelAction, Action,\n    ICommand, ServerStatusAction, RequestPopupModelAction, SetPopupModelAction, SModelRootSchema, SModelElementSchema\n} from 'sprotty/lib'\nimport { TheiaSprottyConnector } from './theia-sprotty-connector'\nimport { injectable, inject, optional } from \"inversify\"\nimport { Workspace } from '@theia/languages/lib/browser';\n\n\nexport const TheiaDiagramServerProvider = Symbol('TheiaDiagramServerProvider');\n\nexport type TheiaDiagramServerProvider = () => Promise<TheiaDiagramServer>;\n\nexport const IRootPopupModelProvider = Symbol('IRootPopupModelProvider');\nexport interface IRootPopupModelProvider {\n    getPopupModel(action: RequestPopupModelAction, rootElement: SModelRootSchema): Promise<SModelElementSchema | undefined>;\n}\n\n/**\n * A sprotty DiagramServer that can be connected to a Theia language\n * server.\n *\n * This class is the sprotty side of the Theia/sprotty integration. It\n * is instantiated with the DI container of the sprotty diagram. Theia\n * services are available via the TheiaDiagramServerConnector.\n */\n@injectable()\nexport class TheiaDiagramServer extends DiagramServer {\n\n    private connector: Promise<TheiaSprottyConnector>\n    private resolveConnector: (server: TheiaSprottyConnector) => void\n    protected sourceUri: string\n    protected workspace: Workspace | undefined;\n\n    @inject(IRootPopupModelProvider)@optional() protected rootPopupModelProvider: IRootPopupModelProvider;\n\n    constructor(@inject(TYPES.IActionDispatcher) public actionDispatcher: IActionDispatcher,\n                @inject(TYPES.ActionHandlerRegistry) actionHandlerRegistry: ActionHandlerRegistry,\n                @inject(TYPES.ViewerOptions) viewerOptions: ViewerOptions,\n                @inject(TYPES.SModelStorage) storage: SModelStorage,\n                @inject(TYPES.ILogger) logger: ILogger) {\n        super(actionDispatcher, actionHandlerRegistry, viewerOptions, storage, logger)\n        this.waitForConnector()\n    }\n\n    connect(connector: TheiaSprottyConnector): void {\n        this.resolveConnector(connector)\n        this.workspace = connector.workspace\n    }\n\n    disconnect(): void {\n        this.waitForConnector()\n    }\n\n    private waitForConnector(): void {\n        this.connector = new Promise<TheiaSprottyConnector>(resolve =>\n            this.resolveConnector = resolve)\n    }\n\n    getConnector() {\n        return this.connector\n    }\n\n    getSourceUri() {\n        return this.sourceUri\n    }\n\n    getWorkspace() {\n        return this.workspace\n    }\n\n    initialize(registry: ActionHandlerRegistry): void {\n        super.initialize(registry)\n        registry.register(SelectCommand.KIND, this)\n    }\n\n    handle(action: Action): void | ICommand {\n        if (action instanceof RequestModelAction && action.options !== undefined)\n            this.sourceUri = action.options.sourceUri\n        return super.handle(action)\n    }\n\n    handleLocally(action: Action): boolean {\n        if (action instanceof RequestPopupModelAction) {\n            return this.handleRequestPopupModel(action);\n        } else {\n            return super.handleLocally(action);\n        }\n    }\n\n    handleExportSvgAction(action: ExportSvgAction): boolean {\n        this.connector.then(c => c.save(this.sourceUri, action))\n        return true\n    }\n\n    handleRequestPopupModel(action: RequestPopupModelAction): boolean {\n        if (action.elementId === this.currentRoot.id) {\n            this.rootPopupModelProvider.getPopupModel(action, this.currentRoot).then(model => {\n                if (model)\n                    this.actionDispatcher.dispatch(new SetPopupModelAction(model));\n            });\n            return false;\n        } else {\n            return true;\n        }\n    }\n\n    protected handleServerStateAction(status: ServerStatusAction): boolean {\n        this.connector.then(c => c.showStatus(this.clientId, status))\n        return false\n    }\n\n    sendMessage(message: ActionMessage) {\n        this.connector.then(c => c.sendThroughLsp(message))\n    }\n\n    /**\n     * made public\n     */\n    messageReceived(message: ActionMessage) {\n        super.messageReceived(message)\n    }\n}\n\n\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\") you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { inject, injectable } from 'inversify'\nimport { ExportSvgAction } from 'sprotty/lib'\nimport { FileSystem } from '@theia/filesystem/lib/common'\nimport { MessageService } from '@theia/core/lib/common'\n\n@injectable()\nexport class TheiaFileSaver {\n    constructor(@inject(FileSystem) protected readonly fileSystem: FileSystem,\n                @inject(MessageService) protected readonly messageService: MessageService) {\n    }\n\n    save(sourceUri: string, action: ExportSvgAction) {\n        this.getNextFileName(sourceUri).then(fileName =>\n            this.fileSystem.createFile(fileName, { content: action.svg })\n                .then(() =>\n                    this.messageService.info(`Diagram exported to '${fileName}'`)\n                )\n                .catch((error) =>\n                    this.messageService.error(`Error exporting diagram '${error}`)\n                )\n        )\n    }\n\n    getNextFileName(sourceUri: string): Promise<string> {\n        return new Promise<string>(resolve => this.tryNextFileName(sourceUri, 0, resolve))\n    }\n\n    tryNextFileName(sourceURI: string, count: number, resolve: (fileName: string) => void) {\n        const currentName = sourceURI + (count === 0 ? '' : count) + '.svg'\n        this.fileSystem.exists(currentName).then(exists => {\n            if (!exists)\n                resolve(currentName)\n            else\n                this.tryNextFileName(sourceURI, ++count, resolve)\n        })\n    }\n}","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\") you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport {\n    CenterAction,\n    FitToScreenAction,\n    RequestExportSvgAction,\n    UndoAction,\n    RedoAction,\n    SelectAllAction\n} from 'sprotty/lib'\nimport { DiagramWidget } from './diagram-widget'\nimport { DiagramManagerImpl } from './diagram-manager'\nimport { injectable, inject } from 'inversify'\nimport { MAIN_MENU_BAR, MenuContribution, MenuModelRegistry, CommandContribution,\n         CommandHandler, CommandRegistry, MenuPath } from '@theia/core/lib/common'\nimport { ApplicationShell, OpenerService, CommonCommands } from '@theia/core/lib/browser'\nimport { EDITOR_CONTEXT_MENU, EditorManager } from \"@theia/editor/lib/browser\"\n\nexport namespace DiagramCommands {\n    export const CENTER = 'diagram:center'\n    export const FIT = 'diagram:fit'\n    export const EXPORT = 'diagram:export'\n    export const SELECT_ALL = 'diagram.selectAll'\n    export const OPEN_IN_DIAGRAM = 'diagram.open'\n    export const DELETE = 'diagram.delete'\n}\n\nexport namespace DiagramMenus {\n    export const DIAGRAM: MenuPath = MAIN_MENU_BAR.concat(\"3_diagram\")\n}\n\n@injectable()\nexport class DiagramMenuContribution implements MenuContribution {\n\n    registerMenus(registry: MenuModelRegistry) {\n        registry.registerSubmenu(DiagramMenus.DIAGRAM, \"Diagram\")\n\n        registry.registerMenuAction(DiagramMenus.DIAGRAM, {\n            commandId: DiagramCommands.CENTER\n        })\n        registry.registerMenuAction(DiagramMenus.DIAGRAM, {\n            commandId: DiagramCommands.FIT\n        })\n        registry.registerMenuAction(DiagramMenus.DIAGRAM, {\n            commandId: DiagramCommands.EXPORT\n        })\n        registry.registerMenuAction(EDITOR_CONTEXT_MENU, {\n            commandId: DiagramCommands.OPEN_IN_DIAGRAM\n        })\n    }\n}\n\nexport class DiagramCommandHandler implements CommandHandler {\n\n    constructor(protected readonly shell: ApplicationShell,\n                protected readonly doExecute: (diagram: DiagramWidget) => any) {\n    }\n\n    execute(...args: any[]) {\n        return this.isEnabled()\n            ? this.doExecute(this.shell.currentWidget as DiagramWidget)\n            : undefined\n    }\n\n    isEnabled(): boolean {\n        return this.shell.currentWidget instanceof DiagramWidget\n    }\n}\n\nexport class OpenInDiagramHandler implements CommandHandler {\n\n    constructor(protected readonly editorManager: EditorManager,\n                protected readonly openerService: OpenerService) {\n    }\n\n    execute(...args: any[]) {\n        const editor = this.editorManager.currentEditor\n        if (editor !== undefined) {\n            const uri = editor.editor.uri\n            const openers = this.openerService.getOpeners(uri)\n            openers.then(openers => {\n                const opener = openers.find(opener => opener instanceof DiagramManagerImpl)\n                if (opener !== undefined)\n                    opener.open(uri)\n            })\n        }\n    }\n}\n\n@injectable()\nexport class DiagramCommandContribution implements CommandContribution {\n    constructor(@inject(ApplicationShell) protected readonly shell: ApplicationShell,\n                @inject(EditorManager) protected readonly editorManager: EditorManager,\n                @inject(OpenerService) protected readonly openerService: OpenerService) {\n    }\n\n    registerCommands(registry: CommandRegistry): void {\n        registry.registerCommand({\n            id: DiagramCommands.CENTER,\n            label: 'Center'\n        })\n        registry.registerCommand({\n            id: DiagramCommands.FIT,\n            label: 'Fit to screen'\n        })\n        registry.registerCommand({\n            id: DiagramCommands.EXPORT,\n            label: 'Export'\n        })\n        registry.registerCommand({\n            id: DiagramCommands.SELECT_ALL,\n            label: 'Select all'\n        })\n        registry.registerCommand({\n            id: DiagramCommands.OPEN_IN_DIAGRAM,\n            label: 'Open in diagram'\n        })\n\n        registry.registerHandler(\n            DiagramCommands.CENTER,\n            new DiagramCommandHandler(this.shell, widget =>\n                widget.actionDispatcher.dispatch(new CenterAction([]))\n            )\n        )\n        registry.registerHandler(\n            DiagramCommands.FIT,\n            new DiagramCommandHandler(this.shell, widget =>\n                widget.actionDispatcher.dispatch(new FitToScreenAction([]))\n            )\n        )\n        registry.registerHandler(\n            DiagramCommands.EXPORT,\n            new DiagramCommandHandler(this.shell, widget =>\n                widget.actionDispatcher.dispatch(new RequestExportSvgAction())\n            )\n        )\n        registry.registerHandler(\n            DiagramCommands.SELECT_ALL,\n            new DiagramCommandHandler(this.shell, widget => {\n                const action = new SelectAllAction(true)\n                widget.actionDispatcher.dispatch(action)\n            })\n        )\n        registry.registerHandler(\n            DiagramCommands.OPEN_IN_DIAGRAM,\n            new OpenInDiagramHandler(this.editorManager, this.openerService)\n        )\n        registry.registerHandler(\n            CommonCommands.UNDO.id,\n            new DiagramCommandHandler(this.shell, widget =>\n                widget.actionDispatcher.dispatch(new UndoAction())\n            )\n        )\n        registry.registerHandler(\n            CommonCommands.REDO.id,\n            new DiagramCommandHandler(this.shell, widget =>\n                widget.actionDispatcher.dispatch(new RedoAction())\n            )\n        )\n    }\n}","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\") you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { InstanceRegistry } from 'sprotty/lib/utils/registry'\nimport { injectable, Container, multiInject, optional } from \"inversify\"\n\nexport const DiagramConfiguration = Symbol('DiagramConfiguration')\n\nexport interface DiagramConfiguration {\n    createContainer(widgetId: string): Container\n    readonly diagramType: string\n}\n\n@injectable()\nexport class DiagramConfigurationRegistry extends InstanceRegistry<DiagramConfiguration> {\n    constructor(@multiInject(DiagramConfiguration)@optional() diagramConfigs: DiagramConfiguration[]) {\n        super()\n        diagramConfigs.forEach(c => this.register(c.diagramType, c))\n    }\n}","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\") you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { DiagramCommands } from './diagram-commands'\nimport { DiagramWidget } from './diagram-widget'\nimport { injectable, inject } from 'inversify'\nimport { FrontendApplication } from '@theia/core/lib/browser/frontend-application'\nimport { CommonCommands, KeybindingContext, Keybinding, KeybindingContribution, KeybindingRegistry } from '@theia/core/lib/browser'\n\n@injectable()\nexport class DiagramKeybindingContext implements KeybindingContext {\n\n    constructor(@inject(FrontendApplication) protected readonly application: FrontendApplication) {\n    }\n\n    id = 'diagram.keybinding.context'\n\n    isEnabled(arg?: Keybinding) {\n        return this.application.shell.currentWidget instanceof DiagramWidget\n    }\n}\n\n@injectable()\nexport class DiagramKeybindingContribution implements KeybindingContribution {\n\n    constructor(@inject(DiagramKeybindingContext) protected readonly diagramKeybindingContext: DiagramKeybindingContext) { }\n\n    registerKeybindings(registry: KeybindingRegistry): void {\n        [\n            {\n                command: DiagramCommands.CENTER,\n                context: this.diagramKeybindingContext.id,\n                keybinding: 'alt+c'\n            },\n            {\n                command: DiagramCommands.FIT,\n                context: this.diagramKeybindingContext.id,\n                keybinding: 'alt+f'\n            },\n            {\n                command: DiagramCommands.EXPORT,\n                context: this.diagramKeybindingContext.id,\n                keybinding: 'alt+e'\n            },\n            {\n                command: DiagramCommands.SELECT_ALL,\n                context: this.diagramKeybindingContext.id,\n                keybinding: 'ctrlcmd+a'\n            },\n            {\n                command: CommonCommands.UNDO.id,\n                context: this.diagramKeybindingContext.id,\n                keybinding: 'ctrlcmd+z'\n            },\n            {\n                command: CommonCommands.REDO.id,\n                context: this.diagramKeybindingContext.id,\n                keybinding: 'ctrlcmd+shift+z'\n            }\n        ].forEach(binding => {\n            registry.registerKeybinding(binding)\n        })\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\") you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { TheiaDiagramServer } from '../sprotty/theia-diagram-server';\nimport { TheiaSprottyConnector } from '../sprotty/theia-sprotty-connector'\nimport { DiagramConfigurationRegistry } from './diagram-configuration'\nimport { injectable, inject } from \"inversify\"\nimport { OpenerOptions, OpenHandler, FrontendApplicationContribution, ApplicationShell } from \"@theia/core/lib/browser\"\nimport URI from \"@theia/core/lib/common/uri\"\nimport { DiagramWidget, DiagramWidgetFactory } from \"./diagram-widget\"\nimport { DiagramWidgetRegistry } from \"./diagram-widget-registry\"\nimport { Emitter, Event, SelectionService } from '@theia/core/lib/common'\nimport { TYPES, ModelSource, IActionDispatcher, DiagramServer } from 'sprotty/lib'\nimport { EditorManager } from '@theia/editor/lib/browser';\n\nexport const DiagramManagerProvider = Symbol('DiagramManagerProvider')\n\nexport type DiagramManagerProvider = () => Promise<DiagramManager>\n\nexport interface DiagramManager extends OpenHandler, FrontendApplicationContribution {\n    readonly diagramType: string\n    readonly onDiagramOpened: Event<URI>\n}\n\n@injectable()\nexport abstract class DiagramManagerImpl implements DiagramManager {\n\n    @inject(ApplicationShell) protected readonly shell: ApplicationShell\n    @inject(DiagramWidgetRegistry) protected readonly widgetRegistry: DiagramWidgetRegistry\n    @inject(SelectionService) protected readonly selectionService: SelectionService\n    @inject(DiagramConfigurationRegistry) protected diagramConfigurationRegistry: DiagramConfigurationRegistry\n    @inject(EditorManager) protected editorManager: EditorManager\n\n    protected readonly onDiagramOpenedEmitter = new Emitter<URI>()\n\n    abstract get diagramType(): string\n    abstract iconClass: string\n\n    get id() {\n        return this.diagramType + \"-diagram-opener\"\n    }\n\n    get onDiagramOpened(): Event<URI> {\n        return this.onDiagramOpenedEmitter.event\n    }\n\n    canHandle(uri: URI, options?: OpenerOptions | undefined): number {\n        return 10\n    }\n\n    open(uri: URI, input?: OpenerOptions): Promise<DiagramWidget> {\n        const promiseDiagramWidget = this.getOrCreateDiagramWidget(uri)\n        promiseDiagramWidget.then(diagramWidget => {\n            window.requestAnimationFrame(() => {\n                this.shell.activateWidget(diagramWidget.id)\n                this.onDiagramOpenedEmitter.fire(uri)\n            })\n        })\n        return promiseDiagramWidget\n    }\n\n    protected async getOrCreateDiagramWidget(uri: URI): Promise<DiagramWidget> {\n        const widget = await this.widgetRegistry.getWidget(uri, this.diagramType)\n        if (widget !== undefined)\n            return widget\n        const newWidget = this.createDiagramWidget(uri)\n        this.addToShell(newWidget)\n        return Promise.resolve(newWidget)\n    }\n\n    protected createDiagramWidget(uri: URI): DiagramWidget {\n        const widgetId = this.widgetRegistry.nextId()\n        const svgContainerId = widgetId + '_sprotty'\n        const diagramConfiguration = this.diagramConfigurationRegistry.get(this.diagramType)\n        const diContainer = diagramConfiguration.createContainer(svgContainerId)\n        const modelSource = diContainer.get<ModelSource>(TYPES.ModelSource)\n        if (modelSource instanceof DiagramServer)\n            modelSource.clientId = widgetId\n        if (modelSource instanceof TheiaDiagramServer && this.diagramConnector)\n            this.diagramConnector.connect(modelSource)\n        const newWidget = this.diagramWidgetFactory({\n            id: widgetId, svgContainerId, uri, diagramType: this.diagramType, modelSource,\n            actionDispatcher: diContainer.get<IActionDispatcher>(TYPES.IActionDispatcher)\n        })\n        newWidget.title.closable = true\n        newWidget.title.label = uri.path.base\n        newWidget.title.icon = this.iconClass\n        this.widgetRegistry.addWidget(uri, this.diagramType, newWidget)\n        newWidget.disposed.connect(() => {\n            this.widgetRegistry.removeWidget(uri, this.diagramType)\n            if (modelSource instanceof TheiaDiagramServer && this.diagramConnector)\n                this.diagramConnector.disconnect(modelSource)\n        })\n        return newWidget\n    }\n\n    protected addToShell(widget: DiagramWidget): void {\n        const currentEditor = this.editorManager.currentEditor\n        const options: ApplicationShell.WidgetOptions = {\n            area: 'main'\n        }\n        if (!!currentEditor && currentEditor.editor.uri.toString(true) === widget.uri.toString(true)) {\n            options.ref = currentEditor\n            options.mode = 'split-right'\n        }\n        this.shell.addWidget(widget, options)\n    }\n\n    protected get diagramWidgetFactory(): DiagramWidgetFactory {\n        return options => new DiagramWidget(options)\n    }\n\n    get diagramConnector(): TheiaSprottyConnector | undefined {\n        return undefined\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\") you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { ContainerModule } from 'inversify'\nimport { DiagramWidgetRegistry } from \"./diagram-widget-registry\"\nimport { DiagramConfigurationRegistry } from \"./diagram-configuration\"\nimport { TheiaFileSaver } from \"../sprotty/theia-file-saver\"\nimport { DiagramCommandContribution, DiagramMenuContribution } from './diagram-commands'\nimport { CommandContribution, MenuContribution } from '@theia/core/lib/common'\nimport { DiagramKeybindingContext, DiagramKeybindingContribution } from './diagram-keybinding'\nimport { KeybindingContext, KeybindingContribution } from '@theia/core/lib/browser';\n\nexport default new ContainerModule(bind => {\n    bind(DiagramWidgetRegistry).toSelf().inSingletonScope()\n    bind(DiagramConfigurationRegistry).toSelf().inSingletonScope()\n    bind(TheiaFileSaver).toSelf().inSingletonScope()\n    bind(CommandContribution).to(DiagramCommandContribution).inSingletonScope()\n    bind(MenuContribution).to(DiagramMenuContribution).inSingletonScope()\n    bind(DiagramKeybindingContext).toSelf().inSingletonScope()\n    bind(KeybindingContext).to(DiagramKeybindingContext).inSingletonScope()\n    bind(KeybindingContribution).to(DiagramKeybindingContribution).inSingletonScope()\n})\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\") you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { injectable } from \"inversify\"\nimport URI from \"@theia/core/lib/common/uri\"\nimport { Emitter, Event, MaybePromise } from \"@theia/core/lib/common\"\nimport { Widget } from \"@phosphor/widgets\"\nimport { DiagramWidget } from './diagram-widget'\n\n@injectable()\nexport class DiagramWidgetRegistry {\n    protected idSequence = 0\n    protected readonly widgets = new Map<string, MaybePromise<DiagramWidget>>()\n    protected readonly widgetsById = new Map<string, DiagramWidget>()\n    protected readonly onWidgetsChangedEmitter = new Emitter<void>()\n\n    onWidgetsChanged(): Event<void> {\n        return this.onWidgetsChangedEmitter.event\n    }\n\n    getWidgetCount(): number {\n        return this.widgets.size\n    }\n\n    getOpenedWidgets(): Widget[] {\n        return Array.from(this.widgets.values()).filter(widget => widget instanceof Widget) as Widget[]\n    }\n\n    getWidget(uri: URI, diagramType: string): Promise<DiagramWidget | undefined> {\n        const widget = this.widgets.get(this.getKey(uri, diagramType))\n        if (widget)\n            return Promise.resolve(widget || undefined)\n        else\n            return Promise.resolve(undefined)\n    }\n\n    getWidgetById(widgetId: string): DiagramWidget | undefined {\n        return this.widgetsById.get(widgetId)\n    }\n\n    addWidget(uri: URI, diagramType: string, widget: DiagramWidget): void {\n        this.widgets.set(this.getKey(uri, diagramType), widget)\n        this.widgetsById.set(widget.id, widget)\n        this.onWidgetsChangedEmitter.fire(undefined)\n    }\n\n    removeWidget(uri: URI, diagramType: string): void {\n        if (this.widgets.delete(this.getKey(uri, diagramType))) {\n            this.onWidgetsChangedEmitter.fire(undefined)\n        }\n    }\n\n    protected getKey(uri: URI, diagramType: string): string {\n        return uri.toString(true) + '#' + diagramType\n    }\n\n    public nextId(): string {\n        return `widget-${this.idSequence++}`\n    }\n}\n","/*\n * Copyright (C) 2017 TypeFox and others.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\") you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\n */\n\nimport { RequestModelAction, CenterAction, InitializeCanvasBoundsAction, ModelSource, ServerStatusAction, IActionDispatcher } from 'sprotty/lib';\nimport { Widget } from \"@phosphor/widgets\"\nimport { Message } from \"@phosphor/messaging/lib\"\nimport URI from \"@theia/core/lib/common/uri\"\nimport { BaseWidget } from '@theia/core/lib/browser/widgets/widget'\n\nexport interface DiagramWidgetOptions {\n    id: string\n    svgContainerId: string\n    uri: URI\n    diagramType: string\n    modelSource: ModelSource\n    actionDispatcher: IActionDispatcher\n}\n\nexport type DiagramWidgetFactory = (options: DiagramWidgetOptions) => DiagramWidget\nexport const DiagramWidgetFactory = Symbol('DiagramWidgetFactory')\n\nexport class DiagramWidget extends BaseWidget {\n\n    private statusIconDiv: HTMLDivElement\n    private statusMessageDiv: HTMLDivElement\n\n    public readonly id: string\n    public readonly svgContainerId: string\n    public readonly uri: URI\n    public readonly diagramType: string\n    public readonly modelSource: ModelSource\n    public readonly actionDispatcher: IActionDispatcher\n\n    constructor(options: DiagramWidgetOptions) {\n        super()\n        this.id = options.id\n        this.svgContainerId = options.svgContainerId\n        this.uri = options.uri\n        this.diagramType = options.diagramType\n        this.modelSource = options.modelSource\n        this.actionDispatcher = options.actionDispatcher\n    }\n\n    protected onAfterAttach(msg: Message): void {\n        super.onAfterAttach(msg)\n        const svgContainer = document.createElement(\"div\")\n        svgContainer.id = this.svgContainerId\n        this.node.appendChild(svgContainer)\n\n        const statusDiv = document.createElement(\"div\")\n        statusDiv.setAttribute('class', 'sprotty-status')\n        this.node.appendChild(statusDiv)\n\n        this.statusIconDiv = document.createElement(\"div\")\n        this.statusIconDiv.setAttribute('class', 'fa')\n        statusDiv.appendChild(this.statusIconDiv)\n\n        this.statusMessageDiv = document.createElement(\"div\")\n        this.statusMessageDiv.setAttribute('class', 'sprotty-status-message')\n        statusDiv.appendChild(this.statusMessageDiv)\n\n        this.modelSource.handle(new RequestModelAction({\n            sourceUri: this.uri.toString(true),\n            diagramType: this.diagramType\n        }))\n    }\n\n    protected getBoundsInPage(element: Element) {\n        const bounds = element.getBoundingClientRect()\n        return {\n            x: bounds.left,\n            y: bounds.top,\n            width: bounds.width,\n            height: bounds.height\n        }\n    }\n\n    protected onResize(msg: Widget.ResizeMessage): void {\n        super.onResize(msg)\n        const newBounds = this.getBoundsInPage(this.node as Element)\n        this.actionDispatcher.dispatch(new InitializeCanvasBoundsAction(newBounds))\n        this.actionDispatcher.dispatch(new CenterAction([], false))\n    }\n\n    protected onActivateRequest(msg: Message): void {\n        super.onActivateRequest(msg)\n        const svgElement = this.node.querySelector(`#${this.svgContainerId} svg`) as HTMLElement\n        if (svgElement !== null)\n            svgElement.focus()\n    }\n\n    setStatus(status: ServerStatusAction): void {\n        this.statusMessageDiv.textContent = status.message\n        this.removeClasses(this.statusMessageDiv, 1)\n        this.statusMessageDiv.classList.add(status.severity.toLowerCase())\n        this.removeClasses(this.statusIconDiv, 1)\n        const classes = this.statusIconDiv.classList\n        classes.add(status.severity.toLowerCase())\n        switch (status.severity) {\n            case 'ERROR': classes.add('fa-exclamation-circle')\n                break\n            case 'WARNING': classes.add('fa-warning')\n                break\n            case 'INFO': classes.add('fa-info-circle')\n                break\n        }\n    }\n\n    protected removeClasses(element: Element, keep: number) {\n        const classes = element.classList\n        while (classes.length > keep) {\n            const item = classes.item(classes.length - 1)\n            if (item)\n                classes.remove(item)\n        }\n    }\n}"],"sourceRoot":""}